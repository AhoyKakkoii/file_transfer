(this.webpackJsonpdelit=this.webpackJsonpdelit||[]).push([[0],{10:function(e,t){e.exports={UNDO:"UNDO",REDO:"REDO",UPLOAD:"UPLOAD",DOWNLOAD:"DOWNLOAD",EXPORT_JSON:"EXPORT_JSON",SAVE:"SAVE",COPY:"COPY",PASTE:"PASTE",PENCIL:"PENCIL",STAMP:"STAMP",ERASER:"ERASER",FILL:"FILL",CROP:"CROP",LINE:"LINE",SQUARE:"SQUARE",CIRCLE:"CIRCLE",ZOOM_IN:"ZOOM_IN",ZOOM_OUT:"ZOOM_OUT"}},102:function(e,t,n){},118:function(e){e.exports=JSON.parse('{"users":[{"_id":"5e53f06e905f950017b5c953","email":"123@123.com","password":123123},{"_id":"5e549434097acb0017c6fc1a","email":"jie.dai@stonybrook.edu","password":123456}],"projects":[{"name":"Down to the Sea","owner":"5e9fa3908dead93aa46f6a6d","editors":["5ea262a9e4a7b520c829163b","5ea33ec1a8a9b4504485aa28"],"mapId":"map1","tilesetId":["tileset1"],"tilesetFirstgid":[1],"layerId":["layer1","layer11"],"imageId":"5eabe075e9da110b6896405a"},{"name":"The long Destiny","owner":"5ea0e25872182f00242b848a","editors":["5e9fa3908dead93aa46f6a6d","5ea262a9e4a7b520c829163b","5ea33ec1a8a9b4504485aa28"],"mapId":"map2","tilesetId":["tileset2"],"tilesetFirstgid":[1],"layerId":["layer2","layer3"],"imageId":"5eabde4998bf8c7fc8ef0307"},{"name":"Pain in Brain","owner":"5ea33ec1a8a9b4504485aa28","editors":["5e9fa3908dead93aa46f6a6d","5ea0e25872182f00242b848a","5ea262a9e4a7b520c829163b"],"mapId":"map3","tilesetId":["tileset2","tileset3","tileset1"],"tilesetFirstgid":[1,151,301],"layerId":["layer3"],"imageId":"5eabe0b7e9da110b6896405b"}],"maps":[{"_id":"map1","width":5,"height":5,"infinite":false,"nextlayerid":2,"nextobjectid":1,"orientation":"orthogonal","renderorder":"right-down","tiledversion":"2020.05.08","tileHeight":40,"tileWidth":40,"type":"map","version":1.2},{"_id":"map2","width":4,"height":4,"infinite":false,"nextlayerid":2,"nextobjectid":1,"orientation":"orthogonal","renderorder":"right-down","tiledversion":"2020.05.08","tileHeight":40,"tileWidth":40,"type":"map","version":1.2},{"_id":"map3","width":3,"height":3,"infinite":false,"nextlayerid":2,"nextobjectid":1,"orientation":"orthogonal","renderorder":"right-down","tiledversion":"2020.05.08","tileHeight":40,"tileWidth":40,"type":"map","version":1.2}],"tilesets":[{"_id":"tileset1","name":"Fair Bear","owner":"5e9fa3908dead93aa46f6a6d","editors":["5ea0e25872182f00242b848a","5ea262a9e4a7b520c829163b"],"imageId":"5eabdf04f064a7553cb9dd41","tileWidth":40,"tileHeight":40,"width":600,"height":400,"columns":15,"margin":0,"spacing":0,"tilecount":150,"published":true},{"_id":"tileset2","name":"Simon Demon","owner":"5ea0e25872182f00242b848a","editors":["5e9fa3908dead93aa46f6a6d","5ea33ec1a8a9b4504485aa28"],"imageId":"5eabe0b7e9da110b6896405b","tileWidth":40,"tileHeight":40,"width":600,"height":600,"columns":15,"margin":0,"spacing":0,"tilecount":150,"published":true},{"_id":"tileset3","name":"High Sky","owner":"5ea262a9e4a7b520c829163b","editors":["5ea33ec1a8a9b4504485aa28"],"imageId":"5eabde7398bf8c7fc8ef0308","tileWidth":40,"tileHeight":40,"width":600,"height":600,"columns":15,"margin":0,"spacing":0,"tilecount":150,"published":false},{"_id":"tileset4","name":"Long Island Story","owner":"5e9fa3908dead93aa46f6a6d","editors":["5ea0e25872182f00242b848a","5ea33ec1a8a9b4504485aa28"],"imageId":"5eabdf04f064a7553cb9dd41","tileWidth":40,"tileHeight":40,"width":600,"height":400,"columns":15,"margin":0,"spacing":0,"tilecount":150,"published":false}],"layers":[{"_id":"layer1","data":[6,0,3,0,5,0,7,0,9,0,43,0,0,0,53,0,0,12,0,0,5,0,3,0,1],"height":5,"width":5,"name":"backgroudLayer","opacity":1,"type":"tilelayer","visible":true,"x":0,"y":0},{"_id":"layer2","data":[1,2,3,4,5,6,7,8,9,0,0,0,0,0,0,0],"height":4,"width":4,"name":"backgroudLayer","opacity":1,"type":"tilelayer","visible":true,"x":0,"y":0},{"_id":"layer3","data":[0,7,0,0,2,0,5,0,0],"height":3,"width":3,"name":"backgroudLayer","opacity":1,"type":"tilelayer","visible":true,"x":0,"y":0},{"_id":"layer11","data":[6,33,3,34,34,34,34,34,34,34,34,34,34,34,53,0,34,12,0,34,5,34,3,0,1],"height":5,"width":5,"name":"another layer","opacity":1,"type":"tilelayer","visible":true,"x":0,"y":0}]}')},145:function(e,t,n){},187:function(e,t,n){},301:function(e,t,n){e.exports=n(649)},306:function(e,t,n){},307:function(e,t,n){},308:function(e,t,n){},336:function(e,t,n){},44:function(e,t){e.exports={triggerLeftControll:function(e){return e.code===n.CONTROLLEFT},triggerLeftShift:function(e){return e.code===n.SHIFTLEFT},triggerLeftCtrlC:function(e){return e.code===n.KEY_C&&e.ctrlKey},triggerLeftCtrlV:function(e){return e.code===n.KEY_V&&e.ctrlKey},triggerLeftCtrlZ:function(e){return e.code===n.KEY_Z&&e.ctrlKey},triggerLeftCtrlY:function(e){return e.code===n.KEY_Y&&e.ctrlKey}};var n={CONTROLLEFT:"ControlLeft",SHIFTLEFT:"ShiftLeft",KEY_C:"KeyC",KEY_V:"KeyV",KEY_Z:"KeyZ",KEY_Y:"KeyY"}},453:function(e,t,n){},616:function(e,t,n){},646:function(e,t){},649:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(23),o=n.n(r),s=(n(306),n(307),n(308),n(309),n(310),n(311),n(4)),l=n(6),c=n(8),d=n(7),h=n(9),u=n(283),p=n(82),m=n(16),g=(n(187),n(683)),f="http://localhost:5000",y=n(32),b=n.n(y),v=function(e){return function(t,n){t({type:"LOGIN_SUCCESS",user:e})}},E=function(e){return function(t,n){t({type:"LOGIN_ERROR",errmsg:e})}},O=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={err:null},n.openPopup=function(e){var t=window.innerWidth/2-450,n=window.innerHeight/2-300,a="".concat(f,"/auth/").concat(e);return window.open(a,"","toolbar=no, location=no, directories=no, status=no, menubar=no, \n        scrollbars=no, resizable=no, copyhistory=no, width=".concat(900,", \n        height=").concat(600,", top=").concat(n,", left=").concat(t))},n.checkPopup=function(){var e=setInterval((function(){n.popup.closed&&clearInterval(e)}),1e3)},n.startAuth=function(e){n.popup=n.openPopup(e),n.checkPopup()},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;console.log(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0})),console.log("running on:",f),this.props.socket.on("authBack",(function(t){var n=t.err,a=t.msg,i=t.auth;!1===n&&e.popup?(e.popup.close(),e.props.handleLoginSuccess(i),e.props.history.push("/dashboard")):(e.popup.close(),e.props.handleLoginError(a),e.setState({err:a}))}))}},{key:"UNSAFE_componentWillMount",value:function(){var e=this.props.socket;e.on("connect",(function(){b.a.get("/auth/init?socketId=".concat(e.id,"&type=login")).then((function(e){console.log("set socket id:",e.data)}))}))}},{key:"render",value:function(){var e=this.state.err;return i.a.createElement("div",{className:"home-page"},i.a.createElement("div",{className:"login-form"},i.a.createElement(g.a,{container:!0,direction:"column"},i.a.createElement(g.a,null,i.a.createElement("div",{className:"grey-text text-darken-3"},i.a.createElement("div",{className:"loginHeader1"},"Delit")),i.a.createElement("div",{className:"loginHeader2"},"Account Login")),i.a.createElement(g.a,null,i.a.createElement("div",{className:"login-btn-box google-enabled-btn",onClick:this.startAuth.bind(this,"google")},i.a.createElement("div",{className:"login-btn-img"},i.a.createElement("i",{className:"fab fa-google-plus-square login-btn-icon"})),i.a.createElement("div",{className:"login-btn-context"},"Sign In With Google")),i.a.createElement("div",{className:"login-btn-box facebook-enabled-btn",onClick:this.startAuth.bind(this,"facebook")},i.a.createElement("div",{className:"login-btn-img"},i.a.createElement("i",{className:"fab fa-facebook login-btn-icon"})),i.a.createElement("div",{className:"login-btn-context"},"Sign In With Facebook")),i.a.createElement("p",{className:"login-err"},e)),i.a.createElement(g.a,{container:!0,justify:"center",alignItems:"center"},i.a.createElement("a",{href:"/register",className:"login-register-switch-text"},"New to Delit? Sign Up")))))}}]),t}(i.a.Component),C=Object(m.b)((function(e,t){return{history:t.history,auth:e.auth,socket:e.backend.socket}}),(function(e){return{handleLoginSuccess:function(t){return e(v(t))},handleLoginError:function(t){return e(E(t))}}}))(O),S=n(693),w=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={err:null,username:"",inputErr:!0,inputErrMsg:""},n.handleChange=function(e){n.setState({username:e.target.value}),n.props.socket.emit("username_register",e.target.value)},n.openPopup=function(e){var t=window.innerWidth/2-450,a=window.innerHeight/2-300,i=n.state.username,r="".concat(f,"/auth/").concat(e,"?username=").concat(i);return window.open(r,"","toolbar=no, location=no, directories=no, status=no, menubar=no, \n        scrollbars=no, resizable=no, copyhistory=no, width=".concat(900,", \n        height=").concat(600,", top=").concat(a,", left=").concat(t))},n.checkPopup=function(){var e=setInterval((function(){n.popup.closed&&clearInterval(e)}),1e3)},n.startAuth=function(e){n.popup=n.openPopup(e),n.checkPopup()},n.getError=function(){var e=n.state,t=e.inputErr,a=e.inputErrMsg;return!0===t&&""===a?"":!1===t&&"Good"===a?"\ud83d\udc4d Username Available":!0===t?"\ud83d\udc4e "+a:void 0},n.getSignUpButtonStyle=function(e){var t=n.state.inputErr;return"google"===e?t?"disabled-btn":"google-enabled-btn":t?"disabled-btn":"facebook-enabled-btn"},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.socket.on("authBack",(function(t){var n=t.err,a=t.msg,i=t.auth;!1===n&&e.popup?(e.popup.close(),e.props.handleLoginSuccess(i),e.props.history.push("/dashboard")):(e.popup.close(),e.props.handleLoginError(a),e.setState({err:a}))})),this.props.socket.on("username_register_back",(function(t){var n=t.err,a=t.msg;e.setState({inputErr:n,inputErrMsg:a})}))}},{key:"UNSAFE_componentWillMount",value:function(){var e=this.props.socket;e.on("connect",(function(){b.a.get("/auth/init?socketId=".concat(e.id,"&type=register"))}))}},{key:"render",value:function(){var e=this.state,t=e.err,n=e.username,a=e.inputErr;return i.a.createElement("div",{className:"home-page"},i.a.createElement("div",{className:"login-form"},i.a.createElement(g.a,{container:!0,direction:"column"},i.a.createElement(g.a,null,i.a.createElement("div",{className:"grey-text text-darken-3"},i.a.createElement("div",{className:"loginHeader1"},"Delit")),i.a.createElement("div",{className:"loginHeader2"},"Account Sign Up"),i.a.createElement(S.a,{error:a,id:"outlined-basic",className:"username-entry-input",label:"Enter Your Prefered Username",variant:"outlined",size:"small",helperText:this.getError(),value:n,onChange:this.handleChange})),i.a.createElement(g.a,{style:{marginTop:32}},i.a.createElement("div",{className:"login-btn-box "+this.getSignUpButtonStyle("google"),onClick:a?null:this.startAuth.bind(this,"google")},i.a.createElement("div",{className:"login-btn-img"},i.a.createElement("i",{className:"fab fa-google-plus-square login-btn-icon"})),i.a.createElement("div",{className:"login-btn-context"},"Sign Up With Google")),i.a.createElement("div",{className:"login-btn-box "+this.getSignUpButtonStyle("facebook"),onClick:a?null:this.startAuth.bind(this,"facebook")},i.a.createElement("div",{className:"login-btn-img"},i.a.createElement("i",{className:"fab fa-facebook login-btn-icon"})),i.a.createElement("div",{className:"login-btn-context"},"Sign Up With Facebook")),i.a.createElement("p",{className:"login-err"},t)),i.a.createElement(g.a,{container:!0,justify:"center",alignItems:"center"},i.a.createElement("a",{href:"/",className:"login-register-switch-text"},"Already Signed Up? Login")))))}}]),t}(i.a.Component),T=Object(m.b)((function(e,t){return{history:t.history,socket:e.backend.socket}}),(function(e){return{handleLoginSuccess:function(t){return e(v(t))},handleLoginError:function(t){return e(E(t))}}}))(w),k=n(21),x=n(694),j=n(695),I=(n(102),function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleMouseEnter=function(e){e.target===n.refs.wrapper&&n.props.handleCloseDropDown(n.props.title.toLowerCase())},n.handleClick=function(e){n.setState({show:!0})},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.props.childRef(this.refs.wrapper)}},{key:"render",value:function(){var e=this.props,t=e.title,n=e.items,a=e.width,r=e.open,o={maxHeight:32*n.length,outline:"2px solid gray"},s={outline:"2px solid gray",width:a};return i.a.createElement("div",{className:"dropdown-wrapper",style:s,ref:"wrapper",onMouseEnter:this.handleMouseEnter},t," ",i.a.createElement("i",{className:"fas fa-chevron-down dropdown-icon"}),i.a.createElement("div",{className:"dropdown-item-box",style:r?o:null},n&&n.map((function(e){return e}))))}}]),t}(i.a.Component)),D=n(700),N=n(698),L=n(135),P=n.n(L),R=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={username:"",picture:"",file:!1,edit:!1,view:!1},n.file=i.a.createRef(),n.edit=i.a.createRef(),n.view=i.a.createRef(),n.handleCloseDropDown=function(e){var t=n.state,a=t.file,i=t.edit,r=t.view;if("all"===e)n.setState({file:!1,edit:!1,view:!1});else{if(!a&&!i&&!r)return;n.setState(Object(k.a)({file:!1,edit:!1,view:!1},e,!0))}},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;b.a.get("/auth/current").then((function(t){var n=t.data,a=n.username,i=n.picture;a&&i?(e.setState({username:a,picture:i}),e.props.handleLoginSuccess(t.data)):e.props.history.push("/")})),window.onclick=function(t){var n=t.target,a=e.state,i=a.file,r=a.edit,o=a.view;i||r||o?e.handleCloseDropDown("all"):n===e.file?e.setState({file:!0}):n===e.edit?e.setState({edit:!0}):n===e.view&&e.setState({view:!0})}}},{key:"UNSAFE_componentWillMount",value:function(){"#_=_"===this.props.history.location.hash&&this.props.history.push("/dashboard")}},{key:"render",value:function(){var e=this,t=this.props,n=t.site,a=t.propertyOpen,r=t.layerOpen,o=t.mapOpen,s=t.tilesetOpen,l=t.handleWindowOpen,c=this.state,d=c.username,h=c.picture,u=c.file,p=c.edit,m=c.view;return i.a.createElement("div",null,i.a.createElement(x.a,{className:"dashboard-top-navbar",bg:"white",expand:"lg"},"dashboard"===n?i.a.createElement(x.a.Brand,{onClick:this.props.handleSidebarOpen,style:{cursor:"pointer"}},i.a.createElement("i",{className:"fas fa-list"})):null,i.a.createElement(x.a.Brand,{href:"/dashboard"}," ",i.a.createElement("div",{className:"logo"},"Delit")),"workspace"===n||"tileset"===n?i.a.createElement(i.a.Fragment,null,i.a.createElement(I,{title:"FILE",width:96,childRef:function(t){return e.file=t},open:u,handleCloseDropDown:this.handleCloseDropDown,items:["workspace"===n?null:i.a.createElement(P.a,{fileTypes:[".jpeg"],key:"o",ref:"fileUploader",handleFiles:this.props.handleImport,base64:!0},i.a.createElement("div",{className:"better-dropdown-item"},"Import")),i.a.createElement("div",{className:"better-dropdown-item",key:Object(D.a)(),onClick:this.props.handleExport},"Export"),i.a.createElement("div",{className:"better-dropdown-item",key:Object(D.a)(),onClick:this.props.handleSave},"Save"),"workspace"===n?null:i.a.createElement("div",{className:"better-dropdown-item",key:Object(D.a)(),onClick:this.props.handleDuplicate},"Duplicate")]}),i.a.createElement(I,{title:"EDIT",width:128,childRef:function(t){return e.edit=t},open:p,handleCloseDropDown:this.handleCloseDropDown,items:[i.a.createElement("div",{className:"better-dropdown-item",key:Object(D.a)(),onClick:this.props.handleUndoTransaction},"Undo   CTRL+Z"),i.a.createElement("div",{className:"better-dropdown-item",key:Object(D.a)(),onClick:this.props.handleDoTransaction},"Redo   CTRL+Y"),"workspace"===n?null:i.a.createElement("div",{className:"better-dropdown-item",key:Object(D.a)(),onClick:this.props.handleCopy},"Copy   CTRL+C"),"workspace"===n?null:i.a.createElement("div",{className:"better-dropdown-item",key:Object(D.a)(),onClick:this.props.handlePaste},"Paste  CTRL+V")]}),"workspace"===n?i.a.createElement(I,{title:"VIEW",width:196,childRef:function(t){return e.view=t},open:m,handleCloseDropDown:this.handleCloseDropDown,items:[i.a.createElement("div",{className:"better-dropdown-item",key:Object(D.a)(),style:{paddingLeft:0},onClick:function(e){return l(e,"mapOpen")}},i.a.createElement(N.a,{checked:o,inputProps:{"aria-label":"primary checkbox"}}),"Show Map Window"),i.a.createElement("div",{className:"better-dropdown-item",key:Object(D.a)(),style:{paddingLeft:0},onClick:function(e){return l(e,"propertyOpen")}},i.a.createElement(N.a,{checked:a,inputProps:{"aria-label":"primary checkbox"}}),"Show Property Window"),i.a.createElement("div",{className:"better-dropdown-item",key:Object(D.a)(),style:{paddingLeft:0},onClick:function(e){return l(e,"layerOpen")}},i.a.createElement(N.a,{checked:r,inputProps:{"aria-label":"primary checkbox"}}),"Show Layer Window"),i.a.createElement("div",{className:"better-dropdown-item",key:Object(D.a)(),style:{paddingLeft:0},onClick:function(e){return l(e,"tilesetOpen")}},i.a.createElement(N.a,{checked:s,inputProps:{"aria-label":"primary checkbox"}}),"Show Tileset Window")]}):null):null,i.a.createElement(x.a.Collapse,{id:"basic-navbar-nav"},i.a.createElement(j.a,{className:"mr-auto"}),i.a.createElement(x.a.Brand,null,i.a.createElement("img",{src:h,className:"profile-img",alt:"logo"})),i.a.createElement(x.a.Brand,null,d),i.a.createElement(x.a.Brand,{href:"".concat(f,"/auth/logout")},"Log Out"))))}}]),t}(i.a.Component),_=Object(m.b)((function(e){return{}}),(function(e){return{handleLoginSuccess:function(t){return e(v(t))},handleLoginError:function(t){return e(E(t))}}}))(R),G=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.onChange,n=e.value;return i.a.createElement("div",null,i.a.createElement("div",{className:"dashboard-search"},i.a.createElement(S.a,{id:"outlined-basic",className:"dashboard-input",label:"Enter Item Name to Search",variant:"outlined",size:"small",value:n,onChange:t})))}}]),t}(i.a.Component),M=n(688),A=function e(t,n,a,i,r,o,l){var c=this;Object(s.a)(this,e),this.initHelper=function(e,t){c.helper.width=e,c.helper.height=t,c.helperctx=c.helper.getContext("2d")},this.drawToGrid=function(e,t,n){c.drawImageHelper(e,(function(){for(var e=c.getImageDataFromHelper(),a=0;a<t.length;a++)c.ctx.putImageData(e,t[a].dx,t[a].dy,t[a].sx,t[a].sy,c.gridWidth,c.gridHeight);n&&n()}))},this.drawImage=function(e,t){var n=new Image;n.src=e,n.onload=function(){c.ctx.drawImage(n,0,0),t&&t()}},this.drawImageHelper=function(e,t){var n=new Image;n.src=e,n.onload=function(){c.helperctx.drawImage(n,0,0),c.helperImageData=c.helperctx.getImageData(0,0,n.width,n.height),t&&t()}},this.getImageDataFromHelper=function(){return c.helperImageData},this.handleHorizontalFlip=function(e){var t=c.ctx.canvas.toDataURL("image/jpeg",1);c.ctx.scale(-1,1),c.ctx.translate(-c.width,0),c.drawImage(t,(function(){c.ctx.scale(-1,1),c.ctx.translate(-c.width,0),e&&e()}))},this.handleVerticalFlip=function(e){var t=c.ctx.canvas.toDataURL("image/jpeg",1);c.ctx.scale(1,-1),c.ctx.translate(0,-c.height),c.drawImage(t,(function(){c.ctx.scale(1,-1),c.ctx.translate(0,-c.height),e&&e()}))},this.handleSelectedHorizontalFlip=function(e,t){var n=e.left,a=e.top,i=e.width,r=e.height;c.initHelper(i,r);var o=c.ctx.getImageData(n,a,i,r);c.helperctx.putImageData(o,0,0);var s=c.helperctx.canvas.toDataURL("image/jpeg",1);c.helperctx.scale(-1,1),c.helperctx.translate(-i,0),c.drawImageHelper(s,(function(){c.helperctx.scale(-1,1),c.helperctx.translate(-i,0),c.ctx.putImageData(c.helperImageData,n,a),t&&t()}))},this.handleSelectedVerticalFlip=function(e,t){var n=e.left,a=e.top,i=e.width,r=e.height;c.initHelper(i,r);var o=c.ctx.getImageData(n,a,i,r);c.helperctx.putImageData(o,0,0);var s=c.helperctx.canvas.toDataURL("image/jpeg",1);c.helperctx.scale(1,-1),c.helperctx.translate(0,-r),c.drawImageHelper(s,(function(){c.helperctx.scale(1,-1),c.helperctx.translate(0,-r),c.ctx.putImageData(c.helperImageData,n,a),t&&t()}))},this.GetDataFromGrids=function(e){for(var t=0;t<e.length;t++){var n=e[t],a=n.x,i=n.y,r=c.ctx.getImageData(a,i,c.gridWidth,c.gridHeight);e[t].imgData=r}return e},this.getImageFromGrid=function(e,t){var n=c.ctx.getImageData(0,0,c.width,c.height);c.initHelper(t.width,t.height);for(var a=0;a<e.length;a++)c.helperctx.putImageData(n,-e[a].dx,-e[a].dy,e[a].x,e[a].y,c.gridWidth,c.gridHeight);return c.helperctx.canvas.toDataURL("image/jpeg",1)},this.drawImageFromGrid=function(e,t){var n=c.ctx.getImageData(0,0,c.width,c.height);c.initHelper(t.width,t.height);for(var a=0;a<e.length;a++)c.helperctx.putImageData(n,-e[a].dx,-e[a].dy,e[a].x,e[a].y,c.gridWidth,c.gridHeight);var i=c.helperctx.canvas.toDataURL("image/jpeg",1);c.drawImage(i)},this.ctx=t,this.width=n,this.height=a,this.gridWidth=i,this.gridHeight=r,this.helper=document.createElement("CANVAS"),this.initHelper(o,l)},W=function(e){for(var t="",n=new Uint8Array(e),a=n.byteLength,i=0;i<a;i++)t+=String.fromCharCode(n[i]);return window.btoa(t)},z=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={imageData:""},n.handleOpen=function(e,t,a){n.props.handleSetItem(t,a),n.props.handleOpen(e)},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.item.imageId;""!==t&&b.a.get("/data/image?imageId=".concat(t)).then((function(t){var n=t.data,a=n.err,i=n.msg,r=n.data;if(a)console.log(i);else if(r){var o=W(r.data);e.setState({imageData:"data:image/jpeg;base64,"+o})}else b.a.get("/data/image?imageId=5ec6f35e3e2ef01724dd7c3b").then((function(t){var n=t.data,a=n.err,i=n.msg,r=n.data;if(a)console.log(i);else{var o=W(r.data);e.setState({imageData:"data:image/jpeg;base64,"+o})}}))}))}},{key:"render",value:function(){var e=this.state.imageData,t=this.props,n=t.className,a=t.style,r=t.onClick,o=t.item,s=t.refetch,l=t.showEditeBts,c=t.handleCheckboxClick,d=t.showPublishBt,h=t.downloadBtn,u=o.name,p=o.ownerInfo.username;return i.a.createElement("div",null,i.a.createElement("div",{className:n,style:a,onClick:r.bind(this,o)},""===e?i.a.createElement("div",{className:"card-preview-img"},i.a.createElement(M.a,{className:"image-loading"})):i.a.createElement("img",{src:e,className:"card-preview-img",alt:"Loading"}),i.a.createElement("div",{className:"card-info-box"},i.a.createElement("span",{className:"card-info-name"},i.a.createElement("b",null,"Name:")," ",u),i.a.createElement("span",{className:"card-owner"},i.a.createElement("b",null,"Owner:")," ",p))),l?i.a.createElement("div",{className:"card-check-box-group",style:a},i.a.createElement("input",{type:"checkbox",className:"card-check-box",id:o._id,onChange:c.bind(this,o)})):d?i.a.createElement("div",{className:"card-info-btn-box",style:a},i.a.createElement("div",{className:"card-info-btn-tl card-info-btn",onClick:this.handleOpen.bind(this,"rename",o,s)},"Rename"),i.a.createElement("div",{className:"card-info-btn-tr card-info-btn",onClick:this.handleOpen.bind(this,"duplicate",o,s)},"Duplicate"),i.a.createElement("div",{className:"card-info-btn-bl card-info-btn",onClick:this.handleOpen.bind(this,"team",o,s)},"Team"),i.a.createElement("div",{className:"card-info-btn-br card-info-btn",onClick:this.handleOpen.bind(this,"remove",o,s)},"Delete"),i.a.createElement("div",{className:"card-info-btn-center card-info-btn",onClick:this.handleOpen.bind(this,"publish",o,s)},i.a.createElement("span",{className:"card-info-edit-btn-center"},"Edit"),i.a.createElement("span",{className:"card-info-publish-btn-center"},"Publish"))):h?i.a.createElement("div",{className:"card-info-btn-box",style:a},i.a.createElement("div",{className:"card-info-btn-tl card-info-btn",onClick:this.handleOpen.bind(this,"rename",o,s)},"Rename"),i.a.createElement("div",{className:"card-info-btn-tr card-info-btn",onClick:this.handleOpen.bind(this,"duplicate",o,s)},"Duplicate"),i.a.createElement("div",{className:"card-info-btn-bl card-info-btn",onClick:this.handleOpen.bind(this,"team",o,s)},"Team"),i.a.createElement("div",{className:"card-info-btn-br card-info-btn",onClick:this.handleOpen.bind(this,"remove",o,s)},"Delete"),i.a.createElement("div",{className:"card-info-btn-center card-info-btn",onClick:this.handleOpen.bind(this,"download",o,s)},i.a.createElement("span",{className:"card-info-edit-btn-center"},"Edit"),i.a.createElement("span",{className:"card-info-download-btn-center"},"Download"))):i.a.createElement("div",{className:"card-info-btn-box",style:a},i.a.createElement("div",{className:"card-info-btn-tl card-info-btn",onClick:this.handleOpen.bind(this,"rename",o,s)},"Rename"),i.a.createElement("div",{className:"card-info-btn-tr card-info-btn",onClick:this.handleOpen.bind(this,"duplicate",o,s)},"Duplicate"),i.a.createElement("div",{className:"card-info-btn-bl card-info-btn",onClick:this.handleOpen.bind(this,"team",o,s)},"Team"),i.a.createElement("div",{className:"card-info-btn-br card-info-btn",onClick:this.handleOpen.bind(this,"remove",o,s)},"Delete"),i.a.createElement("div",{className:"card-info-btn-center card-info-btn"},"Edit")))}}]),t}(i.a.Component),$=Object(m.b)((function(e,t){return{socket:e.backend.socket}}),(function(e){return{}}))(z),H=n(701),B=n(690),F=n(689),Y=n(703),U=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.open,n=e.maxWidth,a=e.fullWidth,r=e.style,o=e.header,s=e.content,l=e.actions;return i.a.createElement(H.a,{open:t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",maxWidth:n,fullWidth:a,style:r},i.a.createElement(Y.a,{id:"alert-dialog-title"},o),i.a.createElement(F.a,null,s),i.a.createElement(B.a,null,l&&l.map((function(e){return e}))))}}]),t}(i.a.Component),Z=n(691),V=n(702),X=n(20),J=n(19),q=n.n(J);function K(){var e=Object(X.a)(["\n    mutation publishTileset(\n        $id:String!\n        $published: Boolean!\n    ){\n        publishTileset(\n            id:$id\n            published:$published\n        ){\n            _id\n            name\n            owner\n            editors\n            ownerInfo{\n                username\n            }\n        }\n    }\n    "]);return K=function(){return e},e}function Q(){var e=Object(X.a)(["\n    mutation removeProjectPack(\n        $id:String!\n    ){\n        removeProjectPack(\n            id:$id\n        )\n    }\n    "]);return Q=function(){return e},e}function ee(){var e=Object(X.a)(["\n    mutation createProjectPack(\n        $name: String!\n        $owner: String!\n        $editors: [String]\n        $imageId: String!\n        $width: Int!\n        $height: Int!\n        $tileWidth: Int!\n        $tileHeight: Int!\n    ){\n        createProjectPack(\n            name:$name\n            owner:$owner\n            editors:$editors\n            imageId:$imageId\n            width:$width\n            height:$height\n            tileWidth:$tileWidth\n            tileHeight:$tileHeight\n        )\n    }\n    "]);return ee=function(){return e},e}function te(){var e=Object(X.a)(["\n    mutation clearLayers{\n        clearLayers\n    }\n    "]);return te=function(){return e},e}function ne(){var e=Object(X.a)(["\n    mutation addLayer(\n        $_id: String\n        $data: [Int]\n        $width: Int!\n        $height: Int!\n        $name: String!,\n        $opacity: Int!,\n        $type: String,\n        $visible: Boolean,\n        $x: Int,\n        $y: Int,\n    ){\n        addLayer(\n            _id:$_id\n            data: $data\n            width: $width\n            height: $height\n            name: $name\n            opacity: $opacity\n            type: $type\n            visible: $visible\n            x: $x\n            y: $y\n        ){\n            _id\n            data\n            height\n            name\n            opacity\n            type\n            visible\n            width\n            x\n            y\n        }\n    }\n    "]);return ne=function(){return e},e}function ae(){var e=Object(X.a)(["\n    mutation clearMaps{\n        clearMaps\n    }\n    "]);return ae=function(){return e},e}function ie(){var e=Object(X.a)(["\n    mutation addMap(\n        $id: String\n        $width: Int!\n        $height: Int!\n        $infinite: Boolean\n        $nextlayerid: Int\n        $nextobjectid: Int\n        $orientation: String\n        $renderorder: String\n        $tiledversion: String\n        $tileHeight: Int!\n        $tileWidth: Int!\n        $type: String\n        $version: Float\n    ){\n        addMap(\n            _id:$id\n            width: $width\n            height: $height\n            infinite: $infinite\n            nextlayerid: $nextlayerid\n            nextobjectid: $nextobjectid\n            orientation: $orientation\n            renderorder: $renderorder\n            tiledversion: $tiledversion\n            tileHeight: $tileHeight\n            tileWidth: $tileWidth\n            type: $type\n            version: $version\n        ){\n            _id\n            width\n            height\n            tileWidth\n            tileHeight\n        }\n    }"]);return ie=function(){return e},e}function re(){var e=Object(X.a)(["\n    mutation duplicateTileset(\n        $id:String!\n        $name:String!\n        $owner:String!\n    ){\n        duplicateTileset(id: $id, name:$name, owner:$owner){\n            name\n            owner\n            editors\n            ownerInfo{\n                username\n            }\n        }\n    }\n    "]);return re=function(){return e},e}function oe(){var e=Object(X.a)(["\n    mutation updateTileset(\n        $id: String!,\n        $name: String!,\n    ){\n        updateTileset(id: $id, name: $name){\n            name\n            owner\n            editors\n            ownerInfo{\n                username\n            }\n        }\n    \n    }"]);return oe=function(){return e},e}function se(){var e=Object(X.a)(["\n    mutation invite2Tileset(\n        $id:String!\n        $users:[String]!,\n    ){\n        invite2Tileset(id: $id, invites:$users){\n            name\n            owner\n            editors\n            ownerInfo{\n                username\n            }\n        }\n    }\n    "]);return se=function(){return e},e}function le(){var e=Object(X.a)(["\n    mutation removeTileset(\n            $id: String!\n        ){\n            removeTileset(id: $id){\n                name\n                owner\n                editors\n                ownerInfo{\n                    username\n                }\n            }\n        }\n    "]);return le=function(){return e},e}function ce(){var e=Object(X.a)(["\n    mutation {\n        clearTilesets\n    }\n    "]);return ce=function(){return e},e}function de(){var e=Object(X.a)(["\n    mutation addTileset(\n        $id:String\n        $name:String!\n        $owner:String!\n        $editors:[String]\n        $imageId:String!\n        $tileWidth:Int!\n        $tileHeight:Int!\n        $width: Int!\n        $height:Int!\n        \n        $columns:Int\n        $margin:Int\n        $spacing:Int\n        $tilecount:Int\n        $published: Boolean\n    ){\n        addTileset(\n            _id:$id\n            name:$name\n            owner:$owner\n            editors:$editors\n            imageId:$imageId\n            tileWidth:$tileWidth\n            tileHeight:$tileHeight\n            width:$width\n            height:$height\n            \n            columns:$columns\n            margin:$margin\n            spacing:$spacing\n            tilecount:$tilecount\n            published: $published   \n        ){\n            _id\n            name\n            owner\n        }\n    }"]);return de=function(){return e},e}function he(){var e=Object(X.a)(["\n    mutation duplicateProject(\n        $id:String!\n        $name:String!\n        $owner:String!\n    ){\n        duplicateProject(id: $id, name:$name, owner:$owner){\n            name\n            owner\n            editors\n            ownerInfo{\n                username\n            }\n        }\n    }\n    "]);return he=function(){return e},e}function ue(){var e=Object(X.a)(["\n    mutation invite2Project(\n        $id:String!\n        $users:[String]!,\n    ){\n        invite2Project(id: $id, invites:$users){\n            name\n            owner\n            editors\n            ownerInfo{\n                username\n            }\n        }\n    }\n    "]);return ue=function(){return e},e}function pe(){var e=Object(X.a)(["\n    mutation {\n        clearProjects\n    }\n    "]);return pe=function(){return e},e}function me(){var e=Object(X.a)(["\n    mutation updateProject(\n            $id: String!,\n            $name: String!,\n        ){\n            updateProject(id: $id, name: $name){\n                name\n                owner\n                editors\n                ownerInfo{\n                    username\n                }\n            }\n        \n        }\n    "]);return me=function(){return e},e}function ge(){var e=Object(X.a)(["\n    mutation removeProject(\n            $id: String!\n        ){\n            removeProject(id: $id){\n                name\n                owner\n                editors\n                ownerInfo{\n                    username\n                }\n            }\n        }\n    "]);return ge=function(){return e},e}function fe(){var e=Object(X.a)(["\n    mutation addProject(\n            $name: String!,\n            $owner: String!,\n            $editors: [String],\n            $imageId: String!,\n            $mapId:String!,\n            $tilesetId:[String],\n            $tilesetFirstgid:[Int],\n            $layerId:[String]\n        ){\n            addProject(\n                name: $name,\n                owner: $owner,\n                editors: $editors\n                imageId: $imageId\n                mapId:$mapId\n                tilesetId:$tilesetId\n                tilesetFirstgid:$tilesetFirstgid\n                layerId:$layerId\n                ){\n                name\n                owner\n                editors\n            }\n        }\n    "]);return fe=function(){return e},e}var ye={ADD_PROJECT:q()(fe()),REMOVE_PROJECT:q()(ge()),UPDATE_PROJECT:q()(me()),CLEAR_PROJECTS:q()(pe()),INVITE_2PROJECT:q()(ue()),DUPLICATE_PROJECT:q()(he()),ADD_TILESET:q()(de()),CLEAR_TILESETS:q()(ce()),REMOVE_TILESET:q()(le()),INVITE_2TILESET:q()(se()),UPDATE_TILESET:q()(oe()),DUPLICATE_TILESET:q()(re()),ADD_MAP:q()(ie()),CLEAR_MAPS:q()(ae()),ADD_LAYER:q()(ne()),CLEAR_LAYERS:q()(te()),CREATE_PROJECT_PACK:q()(ee()),REMOVE_PROJECT_PACK:q()(Q()),PUBLISH_TILESET:q()(K())},be=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={name:""},n.handleOnChange=function(e){n.setState({name:e.target.value})},n.handleSubmit=function(e){e({variables:{id:n.props.item._id,name:""===n.state.name?n.props.item.name:n.state.name}}),n.props.handleClose("rename")},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.open,a=t.item,r=t.user,o=t.refetch,s=t.handleClose,l=t.type;if(!a)return null;var c="tileset"===l?"Rename Tileset":"Rename Project",d="tileset"===l?"Enter Tileset Name":"Enter Project Name",h=a.ownerInfo.username!==r.username,u="tileset"===l?ye.UPDATE_TILESET:ye.UPDATE_PROJECT;return i.a.createElement(V.a,{mutation:u,refetchQueries:[o]},(function(t,r){return i.a.createElement(U,{header:c,open:n,actions:[i.a.createElement(Z.a,{key:"1",onClick:e.handleSubmit.bind(e,t),disabled:h},"Enter"),i.a.createElement(Z.a,{key:"2",onClick:s.bind(e,"rename")},"Cancel")],content:i.a.createElement(i.a.Fragment,null,h?i.a.createElement("p",{className:"red"},"You are not the Owner, You cannot Rename"):null,i.a.createElement(S.a,{className:"form-control",label:d,type:"name",variant:"outlined",size:"small",defaultValue:a.name,onChange:e.handleOnChange}))})}))}}]),t}(i.a.Component),ve=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleOpen=function(e,t,a){n.props.handleSetItem(t,a),n.props.handleOpen(e)},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.open,n=e.handleClose,a=e.item,r=e.refetch;if(!a)return null;var o=a.teamInfo;return i.a.createElement(U,{header:a.name,open:t,fullWidth:!0,maxWidth:"xs",actions:[i.a.createElement(Z.a,{key:"1",waves:"orange",onClick:this.handleOpen.bind(this,"invite",a,r)},"invite"),i.a.createElement(Z.a,{key:"2",waves:"orange",onClick:n.bind(this,"team")},"Close")],content:i.a.createElement("div",{className:"teamlist-wrapper"},o&&o.map((function(e){var t=e.username,n=e.picture;return i.a.createElement("div",{className:"member-box",key:Object(D.a)()},i.a.createElement("img",{src:n,className:"member-picture",alt:"member"}),i.a.createElement("div",{className:"member-name"},t))})))})}}]),t}(i.a.Component),Ee=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleClose=function(){n.props.handleClose("remove")},n.handleSubmit=function(e){e({variables:{id:n.props.item._id}}),n.handleClose()},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.open,a=t.item,r=t.user,o=t.refetch,s=t.type;if(!a)return null;var l="tileset"===s?ye.REMOVE_TILESET:ye.REMOVE_PROJECT_PACK,c="tileset"===s?"Delete Tileset":"Delete Project",d="tileset"===s?"Tileset":"Project",h=a.ownerInfo.username!==r.username;return i.a.createElement(V.a,{mutation:l,refetchQueries:[o]},(function(t,a){return i.a.createElement(U,{header:c,open:n,actions:[i.a.createElement(Z.a,{key:"1",disabled:h,onClick:e.handleSubmit.bind(e,t)},"Confirm"),i.a.createElement(Z.a,{key:"2",onClick:e.handleClose},"Cancel")],var:!0,totalTextbox:"1",content:i.a.createElement("section",{className:"dialog_content",id:"textBoxes"},i.a.createElement("h3",null,"Are You Sure to Delete This ",d,"?"),i.a.createElement("h3",null,"This Can not be Undo, No Backup!"),h?i.a.createElement("p",{className:"red"},"You Are not the Owner. You cannot delete it!"):null)})}))}}]),t}(i.a.Component),Oe=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={input1:{text:"",able:!0,err:!1,msg:"",id:""},input2:{text:"",able:!1,err:!1,msg:"",id:""},input3:{text:"",able:!1,err:!1,msg:"",id:""},input4:{text:"",able:!1,err:!1,msg:"",id:""},input5:{text:"",able:!1,err:!1,msg:"",id:""}},n.handleClose=function(){n.props.handleClose("invite")},n.handleOnChange=function(e,t){var a=n.state[t];a.text=e.target.value,n.setState(Object(k.a)({},t,a)),n.props.socket.emit("invite",{name:t,data:a})},n.getMore=function(){var e=n.state,t=e.input1,a=e.input2,i=e.input3,r=e.input4,o=e.input5;return!!(t.able&&a.able&&i.able&&r.able&&o.able)},n.handleDelete=function(e){var t=n.state[e];t.text="",t.able=!1,n.setState(Object(k.a)({},e,t))},n.getTextField=function(e){var t=e.able,a=e.text,r=e.msg,o=e.err;return t?i.a.createElement("div",{className:"input-wrapper"},i.a.createElement(S.a,{error:o,className:"team-input",label:"Enter Username of Your Teamate",name:"projectName",variant:"outlined",size:"small",value:a,helperText:r,onChange:function(e){return n.handleOnChange(e,"input1")}}),i.a.createElement("i",{className:"team-input-delete fas fa-trash-alt",onClick:function(e){return n.handleDelete("input1")}})):null},n.getTextFields=function(){var e=n.state,t=e.input1,a=e.input2,r=e.input3,o=e.input4,s=e.input5,l=n.props,c=l.item,d=l.user;return c.ownerInfo.username!==d.username?null:i.a.createElement("div",{className:"inputs-wrapper"},n.getTextField(t),n.getTextField(a),n.getTextField(r),n.getTextField(o),n.getTextField(s))},n.handleAddMore=function(){var e=n.state,t=e.input1,a=e.input2,i=e.input3,r=e.input4,o=e.input5;return t.able?a.able?i.able?r.able?o.able?void 0:(o.able=!0,void n.setState({input5:o})):(r.able=!0,void n.setState({input4:r})):(i.able=!0,void n.setState({input3:i})):(a.able=!0,void n.setState({input2:a})):(t.able=!0,void n.setState({input1:t}))},n.handleSubmit=function(e){var t=n.state,a=t.input1,i=t.input2,r=t.input3,o=t.input4,s=t.input5,l=n.props.item._id,c=[];n.getSingleSubmit(a)&&c.push(n.getSingleSubmit(a)),n.getSingleSubmit(i)&&c.push(n.getSingleSubmit(i)),n.getSingleSubmit(r)&&c.push(n.getSingleSubmit(r)),n.getSingleSubmit(o)&&c.push(n.getSingleSubmit(o)),n.getSingleSubmit(s)&&c.push(n.getSingleSubmit(s)),e({variables:{id:l,users:c}}),n.handleClose(),n.props.handleClose("team")},n.getSingleSubmit=function(e){var t=e.id;return""===t?null:t},n.getMutation=function(){var e=n.props.selected;return"all"===e||"create"===e||"share"===e?ye.INVITE_2PROJECT:"tilesets"===e||"tilesetsOwned"===e||"tilesetsShared"===e?ye.INVITE_2TILESET:ye.INVITE_2PROJECT},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.user.username;this.props.socket.on("inviteBack",(function(n){var a=n.name,i=n.err,r=n.msg,o=n.req,s=n.id,l=e.state[a],c=e.props.item.teamInfo,d=[];c.forEach((function(e){d.push(e.username)})),d.includes(o)?(l.err=!0,l.msg="\ud83d\udc4e This User is already Your teammate",e.setState(Object(k.a)({},a,l))):t===o?(l.err=!0,l.msg="\ud83d\udc4e You can not invite Yourself",e.setState(Object(k.a)({},a,l))):(l.err=i,l.msg=r,l.id=s,e.setState(Object(k.a)({},a,l)))}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.open,a=t.item,r=t.user,o=t.refetch;if(!a)return null;var s=a.ownerInfo.username!==r.username,l=this.getMore(),c=this.getMutation();return i.a.createElement(V.a,{mutation:c,refetchQueries:[o]},(function(t,a){return i.a.createElement(U,{header:"Invite Teammate",open:n,actions:[i.a.createElement(Z.a,{key:"1",disabled:s,onClick:e.handleSubmit.bind(e,t)},"Submit"),i.a.createElement(Z.a,{key:"2",disabled:l||s,onClick:e.handleAddMore},"Add More"),i.a.createElement(Z.a,{key:"3",onClick:e.handleClose},"Close")],content:i.a.createElement("section",{className:"dialog_content",id:"textBoxes"},i.a.createElement("p",null,i.a.createElement("strong",null,"Invite Your friend to work together")),i.a.createElement("p",null,"they can view and edit, but not delete"),s?i.a.createElement("p",{className:"err-msg"},"You are not the Owner, You cannot invite"):null,e.getTextFields())})}))}}]),t}(i.a.Component),Ce=Object(m.b)((function(e,t){return{socket:e.backend.socket}}),(function(e){return{}}))(Oe),Se=n(5);function we(){var e=Object(X.a)(["\n    query user(\n        $userId: String!\n        $pageSkip: Int!\n        $search: String!\n        $sortBy: String!\n        $sortOrder: Int!\n    ){\n        user(\n            id:$userId\n        ){\n            publishedTilesets(\n                searchName: $search\n                skip: $pageSkip\n                sortBy: $sortBy\n                sortOrder: $sortOrder\n            ){\n                _id\n                name\n                owner\n                editors\n                ownerInfo{\n                    username\n                    _id\n                }\n                teamInfo{\n                    username\n                    _id\n                }\n                columns\n                imageId\n                width\n                height\n                margin\n                spacing\n                tilecount\n                tileHeight\n                tileWidth\n                published\n            }\n            tilesetsAmount(searchName: $search)\n        }\n    }\n    "]);return we=function(){return e},e}function Te(){var e=Object(X.a)(["\n    query project(\n        $id: String!\n        $searchId: String!\n    ){\n        project(\n            id:$id\n            ){\n            getLayer(\n                searchId: $searchId\n            ){\n                _id\n                idNumber\n                data\n                height\n                name\n                opacity\n                type\n                visible\n                width\n                x\n                y\n            }\n        }\n    }\n    "]);return Te=function(){return e},e}function ke(){var e=Object(X.a)(["\n    query project($id: String!){\n        project(id:$id){\n            _id\n            name\n            owner\n            editors\n            imageId\n            mapId\n            tilesetId\n            tilesetFirstgid\n            layerId\n            editors\n            customPropertyName\n            customPropertyValue\n            lastUpdate\n            ownerInfo{\n                username\n                _id\n            }\n            teamInfo{\n                username\n                _id\n            }\n            layersInfo{\n                _id\n                data\n                width\n                height\n                name\n                opacity\n                type\n                visible\n                x\n                y\n            }\n            tilesetsInfo{\n                _id\n                name\n                owner\n                editors\n                ownerInfo{\n                    username\n                    _id\n                }\n                teamInfo{\n                    username\n                    _id\n                }\n                columns\n                imageId\n                width\n                height\n                margin\n                spacing\n                tilecount\n                tileHeight\n                tileWidth\n                published\n            }\n            mapInfo{\n                _id\n                width\n                height\n                infinite\n                nextlayerid\n                nextobjectid\n                orientation\n                renderorder\n                tiledversion\n                tileHeight\n                tileWidth\n                type\n                version\n            }\n        }\n    }\n    "]);return ke=function(){return e},e}function xe(){var e=Object(X.a)(["\n    query layer($id: String!){\n        layer(id:$id){\n            _id\n            idNumber\n            data\n            height\n            name\n            opacity\n            type\n            visible\n            width\n            x\n            y\n        }\n    }\n    "]);return xe=function(){return e},e}function je(){var e=Object(X.a)(["\n    {\n        layers{\n            _id\n            data\n            height\n            name\n            opacity\n            type\n            visible\n            width\n            x\n            y\n        }\n    }\n    "]);return je=function(){return e},e}function Ie(){var e=Object(X.a)(["\n    query map($id: String!){\n        map(id:$id){\n            _id\n            width\n            height\n            infinite\n            nextlayerid\n            nextobjectid\n            orientation\n            renderorder\n            tiledversion\n            tileHeight\n            tileWidth\n            type\n            version\n        }\n    }\n    "]);return Ie=function(){return e},e}function De(){var e=Object(X.a)(["\n    {\n        maps{\n            _id\n            width\n            height\n            infinite\n            nextlayerid\n            nextobjectid\n            orientation\n            renderorder\n            tiledversion\n            tileHeight\n            tileWidth\n            type\n            version\n        }\n    }"]);return De=function(){return e},e}function Ne(){var e=Object(X.a)(["\n    query user(\n        $userId: String!\n        $pageSkip: Int!\n        $search: String!\n        $sortBy: String!\n        $sortOrder: Int!\n    ){\n        user(\n            id:$userId\n        ){\n            tilesetsSelectable(\n                searchName: $search\n                skip: $pageSkip\n                sortBy: $sortBy\n                sortOrder: $sortOrder\n                ){\n               _id\n                name\n                owner\n                editors\n                ownerInfo{\n                    username\n                    _id\n                }\n                teamInfo{\n                    username\n                    _id\n                }\n                columns\n                imageId\n                width\n                height\n                margin\n                spacing\n                tilecount\n                tileHeight\n                tileWidth\n                published\n            }\n            tilesetsSelectableAmount(\n                searchName: $search\n            )\n        }\n    }"]);return Ne=function(){return e},e}function Le(){var e=Object(X.a)(["\n    query user(\n        $userId: String!\n        $pageSkip: Int!\n        $search: String!\n        $sortBy: String!\n        $sortOrder: Int!\n    ){\n        user(\n            id:$userId\n        ){\n            tilesetsShared(\n                searchName: $search\n                skip: $pageSkip\n                sortBy: $sortBy\n                sortOrder: $sortOrder\n                ){\n                name\n                _id\n                imageId\n                ownerInfo{\n                    username\n                }\n                teamInfo{\n                    _id\n                    username\n                    picture\n                }\n                published\n            }\n            tilesetsSharedAmount(searchName: $search)\n        }\n    }"]);return Le=function(){return e},e}function Pe(){var e=Object(X.a)(["\n    query user(\n        $userId: String!\n        $pageSkip: Int!\n        $search: String!\n        $sortBy: String!\n        $sortOrder: Int!\n    ){\n        user(\n            id:$userId\n        ){\n            tilesetsOwned(\n                searchName: $search\n                skip: $pageSkip\n                sortBy: $sortBy\n                sortOrder: $sortOrder\n                ){\n                name\n                _id\n                imageId\n                ownerInfo{\n                    username\n                }\n                teamInfo{\n                    _id\n                    username\n                    picture\n                }\n                published\n            }\n            tilesetsOwnedAmount(searchName: $search)\n        }\n    }"]);return Pe=function(){return e},e}function Re(){var e=Object(X.a)(["\n    query user(\n        $userId: String!\n        $pageSkip: Int!\n        $search: String!\n        $sortBy: String!\n        $sortOrder: Int!\n    ){\n        user(\n            id:$userId\n        ){\n            tilesets(\n                searchName: $search\n                skip: $pageSkip\n                sortBy: $sortBy\n                sortOrder: $sortOrder\n            ){\n                name\n                _id\n                imageId\n                ownerInfo{\n                    username\n                }\n                teamInfo{\n                    _id\n                    username\n                    picture\n                }\n                published\n            }\n            tilesetsAmount(searchName: $search)\n        }\n    }\n    "]);return Re=function(){return e},e}function _e(){var e=Object(X.a)(["\n    query tileset($id: String!){\n        tileset(id:$id){\n            _id\n            name\n            ownerInfo{\n                username\n            }\n            teamInfo{\n                _id\n                username\n            }\n            imageId\n            width\n            height\n            tileWidth\n            tileHeight\n            columns\n            margin\n            spacing\n            tilecount\n            published\n        }\n    }\n    "]);return _e=function(){return e},e}function Ge(){var e=Object(X.a)(["\n    {\n        tilesets{\n            _id\n            name\n            owner\n            imageId\n            width\n            height\n            tileWidth\n            tileHeight\n            columns\n            margin\n            spacing\n            tilecount\n        }\n    }\n    "]);return Ge=function(){return e},e}function Me(){var e=Object(X.a)(["\n    query user(\n        $userId: String!\n        $pageSkip: Int!\n        $search: String!\n        $sortBy: String!\n        $sortOrder: Int!\n    ){\n        user(\n            id:$userId\n        ){\n            projectsShared(\n                searchName: $search\n                skip: $pageSkip\n                sortBy: $sortBy\n                sortOrder: $sortOrder\n                ){\n                name\n                _id\n                imageId\n                ownerInfo{\n                    username\n                }\n                teamInfo{\n                    _id\n                    username\n                    picture\n                }\n            }\n            projectsSharedAmount(searchName: $search)\n        }\n    }"]);return Me=function(){return e},e}function Ae(){var e=Object(X.a)(["\n    query user(\n        $userId: String!\n        $pageSkip: Int!\n        $search: String!\n        $sortBy: String!\n        $sortOrder: Int!\n    ){\n        user(\n            id:$userId\n        ){\n            projectsRelated(\n                searchName: $search\n                skip: $pageSkip\n                sortBy: $sortBy\n                sortOrder: $sortOrder\n                ){\n                name\n                _id\n                imageId\n                ownerInfo{\n                    username\n                }\n                teamInfo{\n                    _id\n                    username\n                    picture\n                }\n            }\n            projectsRelatedAmount(searchName: $search)\n        }\n    }"]);return Ae=function(){return e},e}function We(){var e=Object(X.a)(["\n    query user(\n        $userId: String!\n        $pageSkip: Int!\n        $search: String!\n        $sortBy: String!\n        $sortOrder: Int!\n    ){\n        user(\n            id:$userId\n        ){\n            projectsOwned(\n                searchName: $search\n                skip: $pageSkip\n                sortBy: $sortBy\n                sortOrder: $sortOrder\n                ){\n                name\n                _id\n                imageId\n                ownerInfo{\n                    username\n                }\n                teamInfo{\n                    _id\n                    username\n                    picture\n                }\n            }\n            projectsOwnedAmount(searchName: $search)\n        }\n    }"]);return We=function(){return e},e}function ze(){var e=Object(X.a)(["\n    {\n        projects{\n            _id\n            name\n            editors\n            owner\n            ownerInfo{\n                username\n            }\n        }\n    }"]);return ze=function(){return e},e}function $e(){var e=Object(X.a)(["{\n        empty\n    }"]);return $e=function(){return e},e}var He={EMPTY_QUERY:q()($e()),GET_PROJECTS:q()(ze()),GET_MY_OWNED_PROJECTS:q()(We()),GET_MY_RELATED_PROJECTS:q()(Ae()),GET_MY_SHARED_PROJECTS:q()(Me()),GET_ALL_TILESETS:q()(Ge()),GET_TILESET:q()(_e()),GET_TILESETS:q()(Re()),GET_MY_OWNED_TILESETS:q()(Pe()),GET_MY_SHARED_TILESETS:q()(Le()),GET_SELECTABLE_TILESETS:q()(Ne()),GET_ALL_MAPS:q()(De()),GET_MAP:q()(Ie()),GET_ALL_LAYERS:q()(je()),GET_LAYER:q()(xe()),GET_PROJECT:q()(ke()),GET_LAYER_FROM_PROJECT:q()(Te()),GET_PUBLISHED_TILESETS:q()(we())},Be=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={name:n.props.item.name},n.handleOnChange=function(e){n.setState({name:e.target.value})},n.handleSubmit=function(e){e({variables:{id:n.props.item._id,name:n.state.name,owner:n.props.user._id}})},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.open,a=t.item,r=t.refetch,o=t.handleClose,s=t.type;if(!a)return null;var l="tileset"===s?ye.DUPLICATE_TILESET:ye.DUPLICATE_PROJECT,c="tileset"===s?"Enter Tileset Name":"Enter Project Name",d=Object(Se.a)({},r,{query:"tileset"===s?He.GET_MY_OWNED_TILESETS:He.GET_MY_OWNED_PROJECTS});return i.a.createElement(V.a,{mutation:l,refetchQueries:[d],onCompleted:function(){setTimeout((function(){e.props.handleClose("duplicate")}),200),setTimeout((function(){e.props.handleSelectSide("tileset"===s?"tilesetsOwned":"create")}),200)}},(function(t,r){return i.a.createElement(U,{header:"Duplicate Project",open:n,actions:[i.a.createElement(Z.a,{key:"1",onClick:e.handleSubmit.bind(e,t)},"Enter"),i.a.createElement(Z.a,{key:"2",onClick:o.bind(e,"duplicate")},"Cancel")],content:i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"Everything will be copied"),i.a.createElement(S.a,{className:"form-control",label:c,type:"name",variant:"outlined",size:"small",defaultValue:a.name,onChange:e.handleOnChange}))})}))}}]),t}(i.a.Component),Fe=Be,Ye=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={checked:n.props.item.published},n.handleOnChange=function(e){n.setState({checked:e.target.checked})},n.handleSubmit=function(e){e({variables:{id:n.props.item._id,published:n.state.checked}}),n.props.handleClose("publish")},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.open,a=t.item,r=t.user,o=t.refetch,s=t.handleClose,l=this.state.checked;if(!a)return null;var c=a.ownerInfo.username!==r.username,d=ye.PUBLISH_TILESET;return i.a.createElement(V.a,{mutation:d,refetchQueries:[o]},(function(t,r){return i.a.createElement(U,{header:i.a.createElement(i.a.Fragment,null,"Publish ",i.a.createElement("span",{className:"header-item-name"},a.name)," Tileset"),open:n,maxWidth:"xl",actions:[i.a.createElement(Z.a,{key:"1",onClick:e.handleSubmit.bind(e,t),disabled:c},"Enter"),i.a.createElement(Z.a,{key:"2",onClick:s.bind(e,"publish")},"Cancel")],content:i.a.createElement(i.a.Fragment,null,i.a.createElement("label",{className:"switch-btn-wrapper"},l?i.a.createElement("label",{htmlFor:"switch-btn",className:"switch-btn-label publish"},"Yes"):i.a.createElement("label",{htmlFor:"switch-btn",className:"switch-btn-label not-to-publish"},"No"),i.a.createElement("input",{type:"checkbox",className:"switch-btn",id:"switch-btn",defaultChecked:a.published,onChange:e.handleOnChange}),i.a.createElement("span",{className:"switch-btn-slider round"})))})}))}}]),t}(i.a.Component),Ue=Ye,Ze=function(e){function t(){var e,a;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(a=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={checked:!0},a.handleOnChange=function(e){a.setState({checked:e.target.checked})},a.handleDownload=function(e){var t={firstgid:1,image:"./tileset@DELIT.jpeg"};t.imageheight=e.height,t.imagewidth=e.width,t.margin=e.margin,t.name=e.name,t.properties={},t.spacing=e.spacing,t.tileheight=e.tileHeight,t.tilewidth=e.tileWidth,t.tilecount=e.tilecount,n(103)(JSON.stringify(t).toLowerCase(),"".concat(t.name,".json"),"json")},a.handleSubmit=function(e){a.handleDownload(e),a.props.handleClose("download")},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.open,a=t.item,r=t.handleClose;if(!a)return null;var o=a._id;return i.a.createElement(V.b,{query:He.GET_TILESET,variables:{id:o},fetchPolicy:"network-only"},(function(t){var o=t.loading,s=t.error,l=t.data;if(o)return"loading";if(s)return"error";if(!l)return"error";var c=l.tileset;return i.a.createElement(U,{header:i.a.createElement(i.a.Fragment,null,"Download"),open:n,maxWidth:"xl",actions:[i.a.createElement(Z.a,{key:"1",onClick:e.handleSubmit.bind(e,c)},"Download Now!"),i.a.createElement(Z.a,{key:"2",onClick:r.bind(e,"download")},"Nah!")],content:i.a.createElement("p",null,"Do you want to download ",i.a.createElement("span",{className:"header-item-name"},a.name)," e.")})}))}}]),t}(i.a.Component),Ve=Ze,Xe=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.team,n=e.invite,a=e.rename,r=e.remove,o=e.duplicate,s=e.publish,l=e.download;return i.a.createElement(i.a.Fragment,null,i.a.createElement(ve,Object.assign({},this.props,{open:t})),i.a.createElement(Ce,Object.assign({},this.props,{open:n})),i.a.createElement(be,Object.assign({},this.props,{open:a})),i.a.createElement(Fe,Object.assign({},this.props,{open:o})),i.a.createElement(Ee,Object.assign({},this.props,{open:r})),i.a.createElement(Ue,Object.assign({},this.props,{open:s})),i.a.createElement(Ve,Object.assign({},this.props,{open:l})))}}]),t}(i.a.Component),Je=Xe,qe=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={rename:!1,delete:!1,team:!1,invite:!1,duplicate:!1,remove:!1,publish:!1,item:null,refetch:null,download:!1},n.handleSetItem=function(e,t){n.setState({item:e,refetch:t})},n.handleDialogsOpen=function(e){n.setState(Object(k.a)({},e,!0))},n.handleDialogsClose=function(e){var t;n.setState((t={},Object(k.a)(t,e,!1),Object(k.a)(t,"item",null),Object(k.a)(t,"refetch",null),t))},n.handleGoEdit=function(e){if(e&&n.props.type){var t=e._id,a="project"===n.props.type?"project":e.published?"tilesetviewer":"tileseteditor";n.props.history.push("/".concat(a,"/").concat(t))}},n.handleDelete=function(e,t){e({variables:{id:t}})},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.items,a=t.refetch,r=t.user,o=t.type,s=t.selected,l=n.length,c={height:l>3?600:300},d="tilesetsOwned"===s,h="tilesets"===s;return i.a.createElement("div",{className:"dashboard-itemlist"},i.a.createElement("div",{className:"dashboard-itemlist-wrapper",style:c},n&&n.map((function(t,n){var r=n%3,o=Math.floor(n/3),s={top:l>3?0===o?200/3:200/3*2+200:50,left:0===r?"calc(25% - 135px)":1===r?"calc(50% - 90px)":"calc(75% - 45px)"},c=t._id;return i.a.createElement($,{className:"item-card",item:t,style:s,handleOpen:e.handleDialogsOpen,onClick:e.handleGoEdit,key:c,handleSetItem:e.handleSetItem,refetch:a,showPublishBt:d,downloadBtn:h})}))),this.state.item?i.a.createElement(Je,Object.assign({},this.state,{handleOpen:this.handleDialogsOpen,handleClose:this.handleDialogsClose,handleSetItem:this.handleSetItem,handleSelectSide:this.props.handleSelectSide,selected:s,user:r,type:o})):null)}}]),t}(i.a.Component),Ke=Object(m.b)((function(e){return{user:e.auth.user}}),(function(e){return{}}))(qe),Qe=(n(336),n(696)),et=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(){var e=this.refs.pagination.getBoundingClientRect().width;this.refs.pagination.style.marginLeft="calc(50% - ".concat(e/2,"px)")}},{key:"componentDidMount",value:function(){var e=this.refs.pagination.getBoundingClientRect().width;this.refs.pagination.style.marginLeft="calc(50% - ".concat(e/2,"px)")}},{key:"UNSAFE_componentWillMount",value:function(){this.defaultPage=this.props.defaultPage}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.color,a=e.size,r=e.handlePagination,o=e.count;return i.a.createElement("div",{className:t,ref:"pagination"},i.a.createElement(Qe.a,{count:o,color:n,size:a,siblingCount:0,onChange:r,defaultPage:this.defaultPage}))}}]),t}(i.a.Component),tt=et,nt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).getClassName=function(e){return n.props.selected===e?"dashboard-sidebar-selected":""},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.showSidebar,n=e.handleSelect,a=t?17:0;return i.a.createElement("div",{className:"dashboard-sidebar",style:{width:a+"%",whiteSpace:"nowrap"}},i.a.createElement("div",{className:"sidebar-wrapper"},i.a.createElement("div",{className:"sidebar-item sidebar-add",onClick:this.props.handleProjectDialogOpen},i.a.createElement("div",{className:"item-text"},"Create New Project")),i.a.createElement("div",{className:"sidebar-item "+this.getClassName("all"),onClick:n.bind(this,"all")},i.a.createElement("div",{className:"item-text"},"All Projects")),i.a.createElement("div",{className:"sidebar-item "+this.getClassName("create"),onClick:n.bind(this,"create")},i.a.createElement("div",{className:"item-text"},"Project Created By Me")),i.a.createElement("div",{className:"sidebar-item "+this.getClassName("share"),onClick:n.bind(this,"share")},i.a.createElement("div",{className:"item-text"},"Project Shared With Me")),i.a.createElement("div",{className:"sidebar-item sidebar-add",onClick:this.props.handleTilesetDialogOpen},i.a.createElement("div",{className:"item-text"},"Create New Tileset")),i.a.createElement("div",{className:"sidebar-item "+this.getClassName("tilesets"),onClick:n.bind(this,"tilesets")},i.a.createElement("div",{className:"item-text"},"Published Tilesets")),i.a.createElement("div",{className:"sidebar-item "+this.getClassName("tilesetsOwned"),onClick:n.bind(this,"tilesetsOwned")},i.a.createElement("div",{className:"item-text"},"Tilesets Created By Me")),i.a.createElement("div",{className:"sidebar-item "+this.getClassName("tilesetsShared"),onClick:n.bind(this,"tilesetsShared")},i.a.createElement("div",{className:"item-text"},"Tilesets Shared With Me"))))}}]),t}(i.a.Component),at=nt,it=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleOnChange=function(e){var t,a=e.target,i=a.name,r=a.value;r="itemName"===i?r:parseInt(r)?parseInt(r):0,n.state[i]=r;var o,s=n.state,l=s.itemName,c=s.tileWidth,d=s.tileHeight,h=s.width,u=s.height;o=!(""!==l&&c&&d&&h&&u&&0!==c&&0!==d&&0!==h&&0!==u),n.setState((t={},Object(k.a)(t,i,r),Object(k.a)(t,"disableBt",o),t))},n.handleAddProject=function(e){var t=n.props.userId,a=n.state;e({variables:{name:a.itemName,owner:t,imageId:"5ec6f35e3e2ef01724dd7c3b",width:a.width,height:a.height,tileWidth:a.tileWidth,tileHeight:a.tileHeight}}),n.props.handleClose()},n.state={itemName:"",tileWidth:0,tileHeight:0,width:0,height:0,disableBt:!0},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.open,a=t.handleClose,r=t.refetch,o=this.state,s=o.itemName,l=o.width,c=o.height,d=o.tileWidth,h=o.tileHeight,u=o.disableBt,p=ye.CREATE_PROJECT_PACK,m=Object(Se.a)({},r,{query:He.GET_MY_OWNED_PROJECTS});return i.a.createElement(V.a,{mutation:p,refetchQueries:[m],awaitRefetchQueries:!1,onCompleted:function(){setTimeout((function(){e.props.handleSelectSide("create")}),500)}},(function(t,r){return i.a.createElement(U,{header:"Create New Dialog",open:n,fullWidth:!0,maxWidth:"xs",actions:[i.a.createElement(Z.a,{variant:"primary",size:"sm",onClick:e.handleAddProject.bind(e,t),key:"1",disabled:u},"Add"),i.a.createElement(Z.a,{variant:"primary",size:"sm",key:"2",onClick:a.bind(e,"cancel")},"Cancel")],content:i.a.createElement(i.a.Fragment,null,i.a.createElement(S.a,{className:"add-project-dialog-input",label:"Enter New Project Name",name:"itemName",variant:"outlined",size:"small",value:s,onChange:e.handleOnChange}),i.a.createElement("div",{className:"br"}),i.a.createElement(S.a,{className:"project-property-input",label:"Enter Tile Width",name:"tileWidth",type:"number",variant:"outlined",size:"small",value:d.toString(),onChange:e.handleOnChange}),i.a.createElement(S.a,{className:"project-property-input",label:"Enter Tile Height",name:"tileHeight",type:"number",variant:"outlined",size:"small",value:h.toString(),onChange:e.handleOnChange}),i.a.createElement("div",{className:"br"}),i.a.createElement(S.a,{className:"project-property-input",label:"Enter Map Width (tiles)",name:"width",type:"number",variant:"outlined",size:"small",value:l.toString(),onChange:e.handleOnChange,helperText:"".concat(l*d," x ").concat(l*d," px")}),i.a.createElement(S.a,{className:"project-property-input",label:"Enter Map Height (tiles)",name:"height",type:"number",variant:"outlined",size:"small",value:c.toString(),onChange:e.handleOnChange,helperText:"".concat(c*h," x ").concat(c*h," px")}),r.loading?"loading":r.error?r.error.message:null)})}))}}]),t}(i.a.Component),rt=Object(m.b)((function(e){return{}}))(it),ot=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleOnChange=function(e){var t,a=e.target,i=a.name,r=a.value;r="itemName"===i?r:parseInt(r)?parseInt(r):0,n.state[i]=r;var o,s=n.state,l=s.itemName,c=s.tileWidth,d=s.tileHeight,h=s.width,u=s.height;o=!(""!==l&&c&&d&&h&&u&&0!==c&&0!==d&&0!==h&&0!==u),n.setState((t={},Object(k.a)(t,i,r),Object(k.a)(t,"disableBt",o),t))},n.handleAddProject=function(e){var t=n.props.userId,a=n.state,i=a.itemName,r=a.width,o=a.height,s=a.tileWidth,l=a.tileHeight;e({variables:{name:i,owner:t,width:parseInt(r),height:parseInt(o),tileWidth:parseInt(s),tileHeight:parseInt(l),imageId:"5ec6f35e3e2ef01724dd7c3b"}}),n.props.handleClose()},n.state={itemName:"",tileWidth:0,tileHeight:0,width:0,height:0,disableBt:!0},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.open,a=t.handleClose,r=t.refetch,o=this.state,s=o.itemName,l=o.width,c=o.height,d=o.tileWidth,h=o.tileHeight,u=o.disableBt,p=ye.ADD_TILESET,m=Object(Se.a)({},r,{query:He.GET_MY_OWNED_TILESETS});return i.a.createElement(V.a,{mutation:p,refetchQueries:[m],onCompleted:function(){e.props.handleSelectSide("tilesetsOwned")}},(function(t,r){return i.a.createElement(U,{header:"Create New Dialog",open:n,fullWidth:!0,maxWidth:"xs",actions:[i.a.createElement(Z.a,{variant:"primary",size:"sm",onClick:e.handleAddProject.bind(e,t),key:"1",disabled:u},"Add"),i.a.createElement(Z.a,{variant:"primary",size:"sm",key:"2",onClick:a.bind(e,"cancel")},"Cancel")],content:i.a.createElement(i.a.Fragment,null,i.a.createElement(S.a,{className:"add-project-dialog-input",label:"Enter New Tileset Name",name:"itemName",variant:"outlined",size:"small",value:s,onChange:e.handleOnChange}),i.a.createElement("div",{className:"br"}),i.a.createElement(S.a,{className:"project-property-input",label:"Enter Tile Width",name:"tileWidth",type:"number",variant:"outlined",size:"small",value:d.toString(),onChange:e.handleOnChange}),i.a.createElement(S.a,{className:"project-property-input",label:"Enter Tile Height",name:"tileHeight",type:"number",variant:"outlined",size:"small",value:h.toString(),onChange:e.handleOnChange}),i.a.createElement("div",{className:"br"}),i.a.createElement(S.a,{className:"project-property-input",label:"Enter Image Width",name:"width",type:"number",variant:"outlined",size:"small",value:l.toString(),onChange:e.handleOnChange}),i.a.createElement(S.a,{className:"project-property-input",label:"Enter Image Height",name:"height",type:"number",variant:"outlined",size:"small",value:c.toString(),onChange:e.handleOnChange}),r.loading?"loading":r.error?r.error.message:null)})}))}}]),t}(i.a.Component),st=Object(m.b)((function(e){return{}}))(ot),lt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showSidebar:!0,projectDialogOpen:!1,tilesetDialogOpen:!1,selected:"all",page:1,search:"",sortBy:"lastUpdate",lastUpdate:-1,name:-1},n.handleSearchChange=function(e){n.setState({search:e.target.value})},n.handleSortBy=function(e,t){n.setState({sortBy:t})},n.handleSortOrder=function(e,t){var a=n.state[t];n.setState(Object(k.a)({},t,1===a?-1:1))},n.handleSelectSide=function(e){n.setState({selected:e})},n.handleProjectDialogOpen=function(){n.setState({projectDialogOpen:!0})},n.handleProjectDialogClose=function(){n.setState({projectDialogOpen:!1})},n.handleTilesetDialogOpen=function(){n.setState({tilesetDialogOpen:!0})},n.handleTilesetDialogClose=function(){n.setState({tilesetDialogOpen:!1})},n.handleSidebarOpen=function(){var e=n.state.showSidebar;e=!e,n.setState({showSidebar:e})},n.getQuery=function(){var e=n.state.selected;return"all"===e?He.GET_MY_RELATED_PROJECTS:"create"===e?He.GET_MY_OWNED_PROJECTS:"share"===e?He.GET_MY_SHARED_PROJECTS:"tilesets"===e?He.GET_TILESETS:"tilesetsOwned"===e?He.GET_MY_OWNED_TILESETS:"tilesetsShared"===e?He.GET_MY_SHARED_TILESETS:He.EMPTY_QUERY},n.getProjects=function(e){var t=n.state.selected;return"all"===t?{items:e.user.projectsRelated,amount:e.user.projectsRelatedAmount,type:"project"}:"create"===t?{items:e.user.projectsOwned,amount:e.user.projectsOwnedAmount,type:"project"}:"share"===t?{items:e.user.projectsShared,amount:e.user.projectsSharedAmount,type:"project"}:"tilesets"===t?{items:e.user.tilesets,amount:e.user.tilesetsAmount,type:"tileset"}:"tilesetsOwned"===t?{items:e.user.tilesetsOwned,amount:e.user.tilesetsOwnedAmount,type:"tileset"}:"tilesetsShared"===t?{items:e.user.tilesetsShared,amount:e.user.tilesetsSharedAmount,type:"tileset"}:null},n.handlePagination=function(e,t){n.setState({page:t})},n.getSelected=function(e){return n.state.sortBy===e?"dashboard-sort-btn-selected":""},n.getSortOrder=function(e){return-1===n.state[e]?"fa-arrow-down":"fa-arrow-up"},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;b.a.get("/auth/current").then((function(t){t.data?(e.setState({user:t.data}),e.props.handleLoginSuccess(t.data)):e.props.history.push("/")}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.showSidebar,a=t.selected,r=t.user,o=t.page,s=t.search,l=t.projectDialogOpen,c=t.tilesetDialogOpen,d=t.sortBy,h=this.props.history,u=n?19:0,p=n?81:100;if(!r)return"loading";var m=this.getQuery(),g={marginLeft:u+"%",width:p+"%",height:"calc(100% - 88px)"},f=6*(o-1),y=this.state[d];return i.a.createElement("div",null,i.a.createElement(_,{handleSidebarOpen:this.handleSidebarOpen,site:"dashboard",history:h}),i.a.createElement(at,{showSidebar:n,handleProjectDialogOpen:this.handleProjectDialogOpen,handleTilesetDialogOpen:this.handleTilesetDialogOpen,handleSelect:this.handleSelectSide,selected:a}),i.a.createElement("div",{className:"dashboard-display",style:g},i.a.createElement(G,{value:s,onChange:this.handleSearchChange}),i.a.createElement("div",{className:"dashboard-sort-btn-group"},i.a.createElement("button",{className:"dashboard-sort-btn "+this.getSelected("name"),onClick:function(t){return e.handleSortBy(t,"name")}},"Name "),i.a.createElement("i",{className:"fa dashboard-sort-icon "+this.getSortOrder("name"),onClick:function(t){return e.handleSortOrder(t,"name")}}),i.a.createElement("button",{className:"dashboard-sort-btn "+this.getSelected("lastUpdate"),onClick:function(t){return e.handleSortBy(t,"lastUpdate")}},"Last Modified "),i.a.createElement("i",{className:"fa dashboard-sort-icon "+this.getSortOrder("lastUpdate"),onClick:function(t){return e.handleSortOrder(t,"lastUpdate")}})),i.a.createElement(V.b,{query:m,variables:{userId:r._id,pageSkip:f,search:s,sortBy:d,sortOrder:y},fetchPolicy:"network-only"},(function(t){var n=t.loading,u=t.error,p=t.data;if(n)return i.a.createElement(M.a,{className:"dashboard-loading"});if(u)return"error";if(m===He.EMPTY_QUERY)return"Wrong Sidebar Selection or needs to be developed";if(!p)return"error";var g=e.getProjects(p),b=g.items,v=g.amount,E=g.type,O=v%6===0?v/6:Math.floor(v/6)+1,C={query:m,variables:{userId:r._id,pageSkip:f,search:s,sortBy:d,sortOrder:y}};return i.a.createElement(i.a.Fragment,null,i.a.createElement(Ke,{history:h,items:b,refetch:C,type:E,selected:a,handleSelectSide:e.handleSelectSide}),i.a.createElement(tt,{className:"dashboard-pagination center",size:"large",color:"secondary",count:O,handlePagination:e.handlePagination,defaultPage:o}),i.a.createElement(rt,{open:l,handleClose:e.handleProjectDialogClose,refetch:C,userId:r._id,handleSelectSide:e.handleSelectSide}),i.a.createElement(st,{open:c,handleClose:e.handleTilesetDialogClose,refetch:C,userId:r._id,handleSelectSide:e.handleSelectSide}))}))))}}]),t}(i.a.Component),ct=Object(m.b)((function(e,t){return{history:t.history,user:e.auth.user}}),(function(e){return{handleLoginSuccess:function(t){return e(v(t))},handleLoginError:function(t){return e(E(t))}}}))(lt),dt=n(57),ht=n(66),ut=function(e,t){return function(n,a){n({type:"SELECT_PROPERTY_WINDOW",window:e,index:t})}},pt=function(e){return function(t,n){t({type:"LAYER_RESTORE",layerList:e})}},mt=function(e){return function(t,n){t({type:"TILESETS_UPDATE",tilesets:e})}},gt=function(e){return function(t,n){t({type:"PASS_SELECTED_TILESET",selectedItem:e})}},ft=function(e){return function(t,n){t({type:"TILESET_RESTORE",tilesets:e})}},yt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={open:[]},n.handleClick=function(e,t,a){var i=n.state.open;(i=i.map((function(t,n){return n===e&&t})))[e]=!i[e],n.setState({open:i},(function(){"tileset"===a?n.props.passSelectedTileset(t):n.props.passSelectedTileset(null)}))},n.handleAddProperty=function(){var e=n.state.open.map((function(e,t){return 1===t}));n.setState({open:e})},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){for(var e=this.props.data,t=[],n=0;n<e.length;n++)t.push(e[n].open);this.setState({open:t})}},{key:"UNSAFE_componentWillMount",value:function(){this.props.childRef&&this.props.childRef(this)}},{key:"render",value:function(){var e=this,t=this.props,n=t.data,a=t.maxHeight,r=t.resizing,o=this.state.open;return i.a.createElement("div",{className:"collapsible-wrapper"},n&&n.map((function(t,n){var s={maxHeight:o[n]?a:"0px",transition:r?"none":o[n]?"ease-in-out 0.4s":"ease-in-out 0.3s"};return i.a.createElement("div",{key:n,tabIndex:"0",className:"collapsible-wrapper"},i.a.createElement("div",{className:"collapsible-title",onClick:function(){return e.handleClick(n,t.item,t.type)},onMouseDown:function(e){return e.stopPropagation()}},i.a.createElement("i",{className:o[n]?"collapsible-title-icon fas fa-chevron-right":"collapsible-title-icon fas fa-chevron-down"}),t.title),i.a.createElement("div",{className:"collapsible-content ",style:s},t.content))})))}}]),t}(i.a.Component),bt=Object(m.b)((function(e){return{}}),(function(e){return{passSelectedTileset:function(t){return e(gt(t))}}}))(yt),vt=n(692),Et=(n(145),n(116)),Ot=n.n(Et),Ct=n(56),St=function e(t,n,a,i,r,o){var l=this;Object(s.a)(this,e),this.doTransaction=function(){void 0!==l.index?l.doCallback(l.index,l.name,l.value):l.doCallback()},this.undoTransaction=function(){void 0!==l.custom?l.undoCallback(l.custom):l.undoCallback()},this.index=t,this.name=n,this.value=a,this.custom=Object(Ct.a)(i),this.doCallback=r,this.undoCallback=o},wt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={},n.handleChange=function(e,t,a){n.props.data&&n.props.transactions.addTransaction(new St(e,t,a.target.value,n.props.data,n.props.handleChange,n.props.restoreCustomProperty))},n.handleSelect=function(e,t){var a=n.props.window;n.setState({nothing:"nothing"},(function(){n.props.handleSelect(a,e)}))},n.getClassName=function(e){var t=n.props,a=t.selected,i=t.window;return a?a.window!==i||a.index!==e?"table-row":"table-row table-row-selected":"table-row"},n.getRows=function(){var e=n.props,t=e.data;if("custom"===e.type)return t;for(var a=Object.keys(t),i=[],r=a.length-1;r>=0;r--)"_id"!==a[r]&&i.push({name:a[r]+"",value:t[a[r]]+""});return i},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.width,a=t.type,r={maxWidth:n/2-10,width:n/2-10,flexShrink:0},o=this.getRows();return i.a.createElement(i.a.Fragment,null,i.a.createElement(vt.a,{striped:!0,bordered:!0,hover:!0,size:"sm",className:"property-table"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,"Name"),i.a.createElement("th",null,"Value"))),i.a.createElement("tbody",null,o&&o.map((function(t,n){return i.a.createElement("tr",{key:n,onClick:function(){return e.handleSelect(n)},className:e.getClassName(n)},i.a.createElement("td",{style:r},"custom"!==a?i.a.createElement("div",{className:"property-input",style:r},t.name):i.a.createElement(Ot.a,{innerRef:t.nref,onChange:e.handleChange.bind(e,n,"name"),onMouseDown:function(e){return e.stopPropagation()},html:t.name,disabled:!1,className:"property-input",style:r})),i.a.createElement("td",{style:r},"custom"!==a?i.a.createElement("div",{className:"property-input",style:r},t.value):i.a.createElement(Ot.a,{innerRef:t.nref,onChange:e.handleChange.bind(e,n,"value"),onMouseDown:function(e){return e.stopPropagation()},html:t.value,disabled:!1,className:"property-input",style:r})))})))),i.a.createElement(tt,{className:"property-list-pagination",size:"small",color:"secondary"}))}}]),t}(i.a.Component),Tt=Object(m.b)((function(e){return{selected:e.property.selected}}),(function(e){return{handleSelect:function(t,n){return e(function(e,t){return function(n,a){n({type:"PROPERTY_SELECT",window:e,index:t})}}(t,n))},handleChange:function(t,n,a){return e(function(e,t,n){return function(a,i){a({type:"PROPERTY_CHANGE",index:e,name:t,value:n})}}(t,n,a))},restoreCustomProperty:function(t){return e(function(e){return function(t,n){t({type:"RESTORE_CUSTOM_PROPERTY",custom:e})}}(t))}}}))(wt),kt=n(78),xt=function e(t){Object(s.a)(this,e),this.buildTilesets=function(){},this.buildLayers=function(){},this.buildMap=function(){},this.buildProperties=function(){},this.map=t},jt=function e(t,n){var a=this;Object(s.a)(this,e),this.setTilesets=function(e){a.tilesets=e},this.getMapNumGrids=function(){return a.numColumn*a.numRow},this.getCanvasDimension=function(){return{canvasWidth:a.canvasWidth,canvasHeight:a.canvasHeight}},this.drawBackGround=function(){a.ctx.save(),a.ctx.fillStyle=a.backgroundColor,a.ctx.fillRect(0,0,a.canvasWidth,a.canvasHeight),a.ctx.restore(),a.drawGridBorder()},this.drawGridBorder=function(){a.ctx.save(),a.ctx.fillStyle=a.gridColor;for(var e=0;e<a.numRow+1;e++){var t=e*(a.gridThickness+a.tileHeight);a.ctx.fillRect(0,t,a.canvasWidth,a.gridThickness)}for(var n=0;n<a.numColumn+1;n++){var i=n*(a.gridThickness+a.tileWidth);a.ctx.fillRect(i,0,a.gridThickness,a.canvasHeight)}a.ctx.restore()},this.buildGridPositions=function(){for(var e=0,t=0;t<a.numRow;t++)for(var n=0;n<a.numColumn;n++)a.gridPositions.push({index:e,x:a.gridThickness+n*(a.tileWidth+a.gridThickness),y:a.gridThickness+t*(a.tileHeight+a.gridThickness),col:n,row:t}),e+=1},this.getGridPositions=function(){return a.gridPositions},this.setBackgroundColor=function(e){a.backgroundColor=e},this.getTilesetByGridId=function(e){for(var t=0;t<a.tilesets.length;t++)if(e>=a.tilesets[t].firstgid&&e<a.tilesets[t].firstgid+a.tilesets[t].tilecount)return a.tilesets[t]},this.getTilesetIdByGridId=function(e){for(var t=0;t<a.tilesets.length;t++)if(e>=a.tilesets[t].firstgid&&e<a.tilesets[t].firstgid+a.tilesets[t].tilecount)return a.tilesets[t].canvasId},this.getTilesetIndexByGridId=function(e){for(var t=0;t<a.tilesets.length;t++)if(e>=a.tilesets[t].firstgid&&e<a.tilesets[t].firstgid+a.tilesets[t].tilecount)return e-a.tilesets[t].firstgid+1},this.getGridPositionByGridIndex=function(e){for(var t=0;t<a.gridPositions.length;t++)if(a.gridPositions[t].index===e)return a.gridPositions[t]},this.drawLayerGridByGridIndex=function(e,t,n){var i=a.getGridPositionByGridIndex(e);n.getContext("2d").putImageData(t.imageData,i.x,i.y,0,0,t.width,t.height)},this.clearLayerCanvas=function(e){var t=e.getContext("2d"),n=e.width,a=e.height;t.clearRect(0,0,n,a)},this.getGridPositionFromMouseXY=function(e,t){for(var n in a.gridPositions)if(e>=a.gridPositions[n].x&&e<a.gridPositions[n].x+a.tileWidth+a.gridThickness&&t>=a.gridPositions[n].y&&t<a.gridPositions[n].y+a.tileHeight+a.gridThickness)return a.gridPositions[n];return null},this.getMoveSelectedTileData=function(e,t){if(null!==t){var n=Object(Ct.a)(e);n.sort((function(e,t){return e.gid-t.gid}));var i=a.getTilesetByGridId(n[0].gid).columns,r=n.map((function(e){return{col:e.index%i,row:Math.floor(e.index/i)}})),o=r.map((function(e){return{col:e.col-r[0].col+t.col,row:e.row-r[0].row+t.row}}));return a.gridPositions.map((function(e){for(var t in o)if(o[t].col===e.col&&o[t].row===e.row)return n[t].gid;return 0}))}},this.storeLayerState=function(e){var t=e.getContext("2d");a.storedImageData=t.getImageData(0,0,a.canvasWidth,a.canvasHeight)},this.restoreLayerState=function(e){if(e){var t=e.getContext("2d");a.storedImageData&&t.putImageData(a.storedImageData,0,0)}},this.getIndexByColRow=function(e,t){for(var n in a.gridPositions)if(a.gridPositions[n].col===e&&a.gridPositions[n].row===t)return a.gridPositions[n].index},this.changeSameAdjacentData=function(e,t,n){if(e[t]===n){if(e[t]="to be changed",!a.gridPositions[t])return;var i=a.gridPositions[t],r=i.col,o=i.row;return a.changeSameAdjacentData(e,a.getIndexByColRow(r-1,o),n),a.changeSameAdjacentData(e,a.getIndexByColRow(r-1,o-1),n),a.changeSameAdjacentData(e,a.getIndexByColRow(r+1,o),n),a.changeSameAdjacentData(e,a.getIndexByColRow(r+1,o+1),n),e}},this.getMoveFillData=function(e,t,n){var i=Object(Ct.a)(n),r=i[t.index];for(var o in i=a.changeSameAdjacentData(i,t.index,r))"to be changed"===i[o]&&(i[o]=e[0].gid);return i},this.getMoveEraserData=function(e,t){var n=Object(Ct.a)(t);if(e)return n[e.index]=0,n},this.map=n,this.canvas=t,this.ctx=t.getContext("2d"),this.numColumn=n.width,this.numRow=n.height,this.tileWidth=n.tileWidth,this.tileHeight=n.tileHeight,this.gridThickness=2,this.canvasWidth=this.gridThickness+this.numColumn*(this.gridThickness+this.tileWidth),this.canvasHeight=this.gridThickness+this.numRow*(this.gridThickness+this.tileHeight),this.gridColor="#000000",this.backgroundColor="rgba(211,211,211,1)",this.gridPositions=[],this.buildGridPositions()},It=function e(t,n){var a=this;Object(s.a)(this,e),this.initHelper=function(e,t){a.helper.width=e,a.helper.height=t,a.helperctx=a.helper.getContext("2d")},this.drawImage=function(e,t){a.drawImageHelper(e,(function(){for(var e=a.getImageDataFromHelper(),n=0;n<a.gridPositions.length;n++)a.ctx.putImageData(e,a.gridPositions[n].dx,a.gridPositions[n].dy,a.gridPositions[n].sx,a.gridPositions[n].sy,a.tileWidth,a.tileHeight);t&&t()}))},this.drawImageHelper=function(e,t){var n=new Image;n.src=e,n.onload=function(){a.helperctx.drawImage(n,0,0),a.helperImageData=a.helperctx.getImageData(0,0,n.width,n.height),t&&t()}},this.getImageDataFromHelper=function(){return a.helperImageData},this.drawBackGround=function(){a.ctx.save(),a.ctx.fillStyle=a.backgroundColor,a.ctx.fillRect(0,0,a.canvasWidth,a.canvasHeight),a.ctx.restore(),a.drawGridBorder()},this.drawGridBorder=function(){a.ctx.save(),a.ctx.fillStyle=a.gridColor;for(var e=0;e<a.numRow+1;e++){var t=e*(a.gridThickness+a.tileHeight);a.ctx.fillRect(0,t,a.canvasWidth,a.gridThickness)}for(var n=0;n<a.numColumn+1;n++){var i=n*(a.gridThickness+a.tileWidth);a.ctx.fillRect(i,0,a.gridThickness,a.canvasHeight)}a.ctx.restore()},this.getCanvasDimension=function(){return{canvasWidth:a.canvasWidth,canvasHeight:a.canvasHeight}},this.buildGridPositions=function(){for(var e=0,t=0;t<a.numRow;t++)for(var n=0;n<a.numColumn;n++)a.gridPositions.push({index:e,x:a.gridThickness+n*(a.tileWidth+a.gridThickness),y:a.gridThickness+t*(a.tileHeight+a.gridThickness),dx:a.gridThickness+n*(a.tileWidth+a.gridThickness)-n*a.tileWidth,dy:a.gridThickness+t*(a.tileHeight+a.gridThickness)-t*a.tileHeight,sx:n*a.tileWidth,sy:t*a.tileHeight}),e+=1},this.getGridPositionByGridIndex=function(e){for(var t=0;t<a.gridPositions.length;t++)if(a.gridPositions[t].index===e)return a.gridPositions[t]},this.getGridIndexByGridId=function(e){return e-a.tileset.firstgid},this.getTileDataByGridId=function(e){var t=a.getGridIndexByGridId(e),n=a.getGridPositionByGridIndex(t);a.initHelper(a.tileWidth,a.tileHeight);var i=a.ctx.getImageData(0,0,a.canvasWidth,a.canvasHeight);return a.helperctx.putImageData(i,-n.x,-n.y,n.x,n.y,a.tileWidth,a.tileHeight),{imageData:a.helperctx.getImageData(0,0,a.tileWidth,a.tileHeight),width:a.tileWidth,height:a.tileHeight}},this.getGridPositionFromMouseXY=function(e,t){for(var n in a.gridPositions)if(e>=a.gridPositions[n].x&&e<a.gridPositions[n].x+a.tileWidth+a.gridThickness&&t>=a.gridPositions[n].y&&t<a.gridPositions[n].y+a.tileHeight+a.gridThickness)return{x:a.gridPositions[n].x,y:a.gridPositions[n].y,index:a.gridPositions[n].index};return null},this.getMinMaxGridPositionsFromGridPositions=function(e){var t=1/0,n=-1/0,a=1/0,i=-1/0;for(var r in e)t=Math.min(t,e[r].x),a=Math.min(a,e[r].y),n=Math.max(n,e[r].x),i=Math.max(i,e[r].y);return{minX:t,minY:a,maxX:n,maxY:i}},this.getBoxedGridPositionsFromGridPositions=function(e,t){var n=a.getMinMaxGridPositionsFromGridPositions(e),i=n.minX,r=n.minY,o=n.maxX,s=n.maxY;i=Math.min(i,t.x),r=Math.min(r,t.y),o=Math.max(i,t.x+a.tileWidth+a.gridThickness),s=Math.max(r,t.y+a.tileHeight+a.gridThickness);var l=[];for(var c in a.gridPositions)a.gridPositions[c].x>=i&&a.gridPositions[c].x<o&&a.gridPositions[c].y>=r&&a.gridPositions[c].y<s&&l.push(a.gridPositions[c]);return l},this.handleConvertIndexToGID=function(e){return e.map((function(e){return e.gid=e.index+a.tileset.firstgid,e}))},this.canvas=n,this.tileset=t,this.ctx=n.getContext("2d"),this.gridThickness=2,this.imageWidth=t.width,this.imageHeight=t.height,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight,this.numColumn=Math.floor(this.imageWidth/this.tileWidth),this.numRow=Math.floor(this.imageHeight/this.tileHeight),this.canvasWidth=this.gridThickness+this.numColumn*(this.gridThickness+this.tileWidth),this.canvasHeight=this.gridThickness+this.numRow*(this.gridThickness+this.tileHeight),this.gridColor="#000000",this.backgroundColor="rgba(211,211,211,1)",this.gridPositions=[],this.buildGridPositions(),this.helper=document.createElement("CANVAS"),this.initHelper(this.imageWidth,this.imageHeight)},Dt=n(10),Nt=n.n(Dt),Lt=function e(t,n,a,i){var r=this;Object(s.a)(this,e),this.doTransaction=function(){void 0!==r.id?r.doCallback(r.id):r.doCallback()},this.undoTransaction=function(){void 0!==r.layerList?r.undoCallback(r.layerList):r.undoCallback()},this.id=t,this.doCallback=a,this.undoCallback=i,this.layerList=Object(Ct.a)(n)},Pt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={scale:1,canvasWidth:0,canvasHeight:0},n.scrollbar=i.a.createRef(),n.mouseGridPosition=null,n.mouseDown=!1,n.layerRefs={},n.layerList={},n.getToolName=function(){var e=n.props.selectedTool;return e===Nt.a.ZOOM_IN?"display-zoom-in":e===Nt.a.ZOOM_OUT?"display-zoom-out":e===Nt.a.PENCIL?"display-pencil":e===Nt.a.ERASER?"display-eraser":e===Nt.a.FILL?"display-fill":e?"display-cross-cursor":""},n.handleZoomEffect=function(e){e.stopPropagation();var t=n.props.selectedTool;if(t===Nt.a.ZOOM_IN||t===Nt.a.ZOOM_OUT){var a=n.state.scale,i=t===Nt.a.ZOOM_IN?1.25:t===Nt.a.ZOOM_OUT?.8:1,r=a*i;n.setState({scale:r});var o=document.getElementById("map-display"),s=o.getBoundingClientRect(),l=e.clientX,c=e.clientY,d=l-s.left,h=c-s.top,u=h*i-h,p=d*i-d;o.style.transform="scale("+r+")";var m=n.refs.scrollbar.getScrollLeft(),g=n.refs.scrollbar.getScrollTop();r>=1&&(n.refs.scrollbar.scrollLeft(p+m),n.refs.scrollbar.scrollTop(u+g))}},n.getSelectedTools=function(){var e=n.props.selectedTool;return e===Nt.a.ZOOM_IN?"display-zoom-in":e===Nt.a.ZOOM_OUT?"display-zoom-out":""},n.handleDrawLayers=function(){var e=n.props,t=e.layerList,a=e.tilesets;n.imageController.setTilesets(a);for(var i=[],r=0;r<t.length;r++){var o="layer"+t[r]._id;n.layerRefs[o]=n.refs[o],n.layerList[o]=t[r],i.push(o),n.imageController.clearLayerCanvas(n.layerRefs[o]),n.handleDrawLayerByLayerData(t[r].data,n.layerRefs[o])}},n.handleMouseDown=function(e){e.stopPropagation();var t=n.props,a=t.selectedGrids,i=t.selectedLayer;if(t.selectedTool===Nt.a.ERASER){if(null===i)return;var r="layer"+i,o=n.layerRefs[r];if(n.layerList[r].locked)return;n.imageController.storeLayerState(o),n.mouseDown=!0}null!==i&&0!==a.length&&(n.mouseDown=!0)},n.handleMouseMove=function(e){var t=n.props,a=t.selectedGrids,i=t.selectedLayer,r=t.selectedTool;if(null!==i){var o=e.clientX,s=e.clientY,l=n.handleFixPosition(o,s),c=l.x,d=l.y,h=n.imageController.getGridPositionFromMouseXY(c,d);if(null!==h&&n.layerRefs){var u="layer"+i,p=n.layerRefs[u],m=n.layerList[u];if(!m.locked)return n.mouseGridPosition?void(n.mouseGridPosition.index!==h.index&&(n.mouseDown||r===Nt.a.ERASER||n.imageController.restoreLayerState(p),n.handleMouseMoveDrawLayer(p,m,a,h))):(n.imageController.storeLayerState(p),void n.handleMouseMoveDrawLayer(p,m,a,h))}}},n.handleMouseMoveDrawLayer=function(e,t,a,i){var r=n.props.selectedTool;if(n.mouseGridPosition=i,r===Nt.a.ERASER&&n.mouseDown){var o=n.imageController.getMoveEraserData(i,t.data);return n.imageController.storeLayerState(e),void(o&&n.props.transactions.addTransaction(new Lt(o,n.props.layerList,n.props.mapFillClick,n.props.restoreLayers)))}if(0!==a.length)if(r===Nt.a.STAMP){var s=n.imageController.getMoveSelectedTileData(a,i);if(n.mouseDown)return n.imageController.storeLayerState(e),void(s&&n.props.transactions.addTransaction(new Lt(s,n.props.layerList,n.props.mapStampClick,n.props.restoreLayers)));n.handleDrawLayerByLayerData(s,e)}else if(r===Nt.a.FILL){var l=n.imageController.getMoveFillData(a,i,t.data);if(n.mouseDown)return n.imageController.storeLayerState(e),void(l&&n.props.transactions.addTransaction(new Lt(l,n.props.layerList,n.props.mapFillClick,n.props.restoreLayers)));n.handleDrawLayerByLayerData(l,e)}},n.handleMouseLeave=function(){var e=n.props,t=e.selectedLayer,a=e.selectedGrids,i=e.selectedTool;if(n.mouseGridPosition=null,n.mouseDown=!1,null!==t&&0!==a.length&&i!==Nt.a.ERASER){var r="layer"+t,o=n.layerRefs[r];n.imageController.restoreLayerState(o)}},n.handleMouseClick=function(e){n.mouseDown=!1;var t=n.props,a=t.selectedTool,i=t.selectedGrids,r=t.selectedLayer;if(a!==Nt.a.ZOOM_IN&&a!==Nt.a.ZOOM_OUT)if(null!==r)if(a===Nt.a.STAMP||a===Nt.a.ERASER||a===Nt.a.FILL){e.stopPropagation();var o=e.clientX,s=e.clientY,l=n.handleFixPosition(o,s),c=l.x,d=l.y,h=n.imageController.getGridPositionFromMouseXY(c,d),u="layer"+r,p=n.layerRefs[u],m=n.layerList[u];if(!m.locked){if(n.imageController.storeLayerState(p),a===Nt.a.ERASER){var g=n.imageController.getMoveEraserData(h,m.data);n.props.transactions.addTransaction(new Lt(g,n.props.layerList,n.props.mapFillClick,n.props.restoreLayers))}if(0!==i.length)if(a===Nt.a.STAMP){var f=n.imageController.getMoveSelectedTileData(i,h);n.props.transactions.addTransaction(new Lt(f,n.props.layerList,n.props.mapStampClick,n.props.restoreLayers))}else if(a===Nt.a.FILL){var y=n.imageController.getMoveFillData(i,h,m.data);n.props.transactions.addTransaction(new Lt(y,n.props.layerList,n.props.mapFillClick,n.props.restoreLayers))}}}else n.props.propertySelectDisplay("map");else n.props.propertySelectDisplay("map");else n.handleZoomEffect(e)},n.handleDrawLayerByLayerData=function(e,t){for(var a=0;a<e.length;a++)if(0!==e[a]){var i=n.imageController.getTilesetByGridId(e[a]);if(!i)return;var r=document.getElementById(i.canvasId);if(!r)return;var o=new It(i,r).getTileDataByGridId(e[a]);n.imageController.drawLayerGridByGridIndex(a,o,t)}},n.handleFixPosition=function(e,t){var a=window.scrollX+e,i=window.scrollY+t;a-=n.refs.backgroundCanvas.getBoundingClientRect().left,i-=n.refs.backgroundCanvas.getBoundingClientRect().top;var r=n.state.scale;return{x:a/=r,y:i/=r}},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.map,a=t.tilesets,i=this.refs.backgroundCanvas;this.gridController=new xt(n),this.imageController=new jt(i,n),this.imageController.setTilesets(a);var r=this.imageController.getCanvasDimension(),o=r.canvasWidth,s=r.canvasHeight;this.setState({canvasWidth:o,canvasHeight:s},(function(){e.imageController.drawBackGround()}))}},{key:"componentDidUpdate",value:function(){var e=this.props,t=e.tilesetLoaded,n=e.resizing;t&&!n&&this.handleDrawLayers()}},{key:"render",value:function(){var e=this.props,t=e.style,n=e.width,a=e.height,r=e.layerList,o=this.state,s=o.scale,l=o.canvasWidth,c=o.canvasHeight,d=Object(Se.a)({},t,{marginLeft:l?l*s>=n?"auto":(n-l*s)/2:"auto",marginTop:c?c*s>=a?"auto":(a-c*s)/2:"auto"});return i.a.createElement(kt.Scrollbars,{style:Object(Se.a)({},t,{width:n,height:a}),ref:"scrollbar",renderThumbHorizontal:function(e){return i.a.createElement("div",Object.assign({},e,{className:"thumb"}))},renderThumbVertical:function(e){return i.a.createElement("div",Object.assign({},e,{className:"thumb"}))}},i.a.createElement("div",{id:"map-display",className:"display-place "+this.getToolName(),style:d,onClick:this.handleMouseClick,onMouseDown:this.handleMouseDown,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onMouseUp:this.handleMouseClick},i.a.createElement("canvas",{ref:"backgroundCanvas",width:l,height:c}),r.map((function(e){return i.a.createElement("canvas",{ref:"layer"+e._id,width:l,height:c,className:"layer-canvas "+(e.visible?"":"layer-invisible"),style:{opacity:e.opacity},key:Object(D.a)()})}))))}}]),t}(i.a.Component),Rt=Object(m.b)((function(e){var t=e.toolbar.selected,n=e.map.map,a=e.tileset,i=a.tilesets,r=a.loaded,o=a.selectedGrids;return{selectedTool:t,map:n,tilesets:i,layerList:e.layer.layerList,tilesetLoaded:r,selectedGrids:o,selectedLayer:e.layer.selected}}),(function(e){return{mapStampClick:function(t){return e(function(e){return function(t,n){t({type:"MAP_STAMP_CLICK",data:e})}}(t))},mapFillClick:function(t){return e(function(e){return function(t,n){t({type:"MAP_FILL_CLICK",data:e})}}(t))},propertySelectDisplay:function(t){return e(ut(t))},restoreLayers:function(t){return e(pt(t))}}}))(Pt),_t=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},n.tileMap=i.a.createRef(),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.width,n=e.height,a=e.style,r=e.resizing;return i.a.createElement(Rt,{style:a,width:t,height:n,window:"property",resizing:r})}}]),t}(i.a.Component),Gt=Object(m.b)((function(e){return{}}),(function(e){return{}}))(_t),Mt=n(279),At=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.a.createElement(Mt.TitleBar,{title:this.props.title,controls:!0,onCloseClick:this.props.handleClose,onMinimizeClick:this.props.handleResetWindow,onMaximizeClick:this.props.handleMaxWindow,onResizeClick:this.props.handleMaxWindow})}}]),t}(i.a.Component),Wt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={resizing:!1,propertyOpen:!0,customOpen:!1,mapOpen:!1},n.collapsible=i.a.createRef(),n.handleOnResize=function(e,t,a,i,r){n.setState({resizing:!0},(function(){n.props.handleOnResize(a,r,"property")}))},n.handleStopResize=function(e,t,a,i,r){n.setState({resizing:!1},(function(){n.props.handleOnResize(a,r,"property")}))},n.handleAddProperty=function(){n.collapsible.handleAddProperty(),n.props.handleAddProperty()},n.handleDelete=function(e){e.stopPropagation(),n.props.handleDelete()},n.onlyNumber=function(e){e.value=e.value.replace(/[^\d]/gi,"")},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.display,a=t.selected,r=t.open,o=t.dimension,s=t.custom,l=t.transactions,c=o.size,d=c.width,h=c.height,u=this.state,p=u.propertyOpen,m=u.customOpen,g=u.mapOpen,f={maxWidth:d,maxHeight:h-140},y=this.state.resizing;return i.a.createElement(i.a.Fragment,null,r?i.a.createElement(ht.a,{className:"workscreen-window ",size:o.size,position:o.position,onMouseDown:function(){return e.props.handleToTop("property")},onResizeStart:function(){return e.props.handleToTop("property")},onResize:this.handleOnResize,onResizeStop:this.handleStopResize,onClick:this.props.handleUnselect,minWidth:202,minHeight:391,id:"property",onDragStop:function(t,n){return e.props.handleOnDragStop(t,n,"property")},style:{zIndex:o.zIndex}},i.a.createElement(At,{title:"Property Window",handleClose:this.props.handleClose.bind(this,"propertyOpen"),handleResetWindow:this.props.handleResetWindow,handleMaxWindow:this.props.handleMaxWindow}),i.a.createElement(bt,{data:[{title:"Property",content:i.a.createElement(Tt,{data:n,window:"layer",width:d}),open:p},{title:"Custom Property",content:i.a.createElement(Tt,{data:s,window:"custom",width:d,type:"custom",transactions:l}),open:m},{title:"Show Mini Map",content:i.a.createElement(Gt,{window:"minimap",style:f,width:d,height:h-140,resizing:y}),open:g}],maxHeight:f.maxHeight,resizing:y,childRef:function(t){return e.collapsible=t}}),i.a.createElement("i",{className:"fas fa-trash-alt property-clear-btn better-btn "+(a?"":"btn-disabled"),onClick:this.handleDelete,onMouseDown:function(e){return e.stopPropagation()}}),i.a.createElement("i",{className:"fas fa-plus property-add-btn better-btn",onClick:this.handleAddProperty,onMouseDown:function(e){return e.stopPropagation()}})):null)}}]),t}(i.a.Component),zt=Object(m.b)((function(e){var t=e.property;return{display:t.display,custom:t.custom,selected:t.selected}}),(function(e){return{handleUnselect:function(){return e((function(e,t){e({type:"PROPERTY_UNSELECT"})}))},handleDelete:function(){return e((function(e,t){e({type:"PROPERTY_DELETE"})}))},handleAddProperty:function(){return e((function(e,t){e({type:"ADD_PROPERTY"})}))}}}))(Wt),$t=function e(t,n,a,i,r){var o=this;Object(s.a)(this,e),this.doTransaction=function(){void 0!==o.id?o.doCallback(o.name,o.id):o.doCallback()},this.undoTransaction=function(){void 0!==o.layerList?o.undoCallback(o.layerList):o.undoCallback()},this.id=n,this.name=t,this.doCallback=i,this.undoCallback=r,this.layerList=a.map((function(e){return Object(Se.a)({},e)}))},Ht=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleRename=function(e,t){n.props.transactions.addTransaction(new $t(e.target.value,t,n.props.layerList,n.props.handleRename,n.props.restoreLayers))},n.handleSelect=function(e,t){t.stopPropagation(),n.props.handleSelect(e)},n.handleDelete=function(e,t){t.stopPropagation(),n.props.transactions.addTransaction(new Lt(e,n.props.layerList,n.props.handleDelete,n.props.restoreLayers))},n.handleVisibilityClick=function(e,t){t.stopPropagation(),n.props.transactions.addTransaction(new Lt(e,n.props.layerList,n.props.handleVisibilityClick,n.props.restoreLayers))},n.handleLockClick=function(e,t){t.stopPropagation(),n.props.transactions.addTransaction(new Lt(e,n.props.layerList,n.props.handleLockClick,n.props.restoreLayers))},n.handleMoveUp=function(e,t){t.stopPropagation(),n.props.transactions.addTransaction(new Lt(e,n.props.layerList,n.props.handleMoveUp,n.props.restoreLayers))},n.handleMoveDown=function(e,t){t.stopPropagation(),n.props.transactions.addTransaction(new Lt(e,n.props.layerList,n.props.handleMoveDown,n.props.restoreLayers))},n.handleOnMouseDown=function(e,t){e.stopPropagation(),n.props.handleSelectProperty("layers",t)},n.handleUnselect=function(e){n.props.handleUnselect()},n.getClassName=function(e){var t=n.props.selected;return null===t||t!==e?"layer-list-item":"layer-list-item layer-list-item-selected"},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.layerList,a={maxWidth:t.maxWidth};return i.a.createElement("div",{className:"layer-list",onClick:this.handleUnselect},n&&n.map((function(t,r){return i.a.createElement("div",{key:r},i.a.createElement("div",{className:e.getClassName(t._id),onMouseDown:function(t){return e.handleOnMouseDown(t,r)},onClick:e.handleSelect.bind(e,t._id)},i.a.createElement(Ot.a,{innerRef:t.ref,onChange:function(t){return e.handleRename(t,r)},onMouseDown:function(t){return e.handleOnMouseDown(t,r)},html:t.name,disabled:!1,className:"layer-input",style:a})),i.a.createElement("div",{className:"layer-item-btn-fixedbox"},i.a.createElement("i",{className:"fas better-btn layer-item-btn-eye "+(t.visible?"fa-eye":"fa-eye-slash"),onClick:e.handleVisibilityClick.bind(e,r)}),i.a.createElement("i",{className:"fas better-btn layer-item-btn "+(t.locked?"fa-lock":"fa-unlock"),onClick:e.handleLockClick.bind(e,t._id)})),i.a.createElement("div",{className:"layer-item-btn-box"},i.a.createElement("i",{className:"fas fa-edit better-btn layer-item-btn"}),i.a.createElement("i",{className:"fas fa-trash-alt better-btn layer-item-btn",onClick:e.handleDelete.bind(e,r)}),i.a.createElement("i",{className:"fas fa-arrow-down better-btn layer-item-btn "+(r===n.length-1?"layer-btn-disabled":""),onClick:e.handleMoveDown.bind(e,t._id)}),i.a.createElement("i",{className:"fas fa-arrow-up better-btn layer-item-btn "+(0===r?"layer-btn-disabled":""),onClick:e.handleMoveUp.bind(e,t._id)})))})))}}]),t}(i.a.Component),Bt=Object(m.b)((function(e){var t=e.layer;return{layerList:t.layerList,selected:t.selected}}),(function(e){return{handleRename:function(t,n){return e(function(e,t){return function(n,a){n({type:"LAYER_RENAME",name:e,id:t})}}(t,n))},handleSelect:function(t){return e(function(e){return function(t,n){t({type:"LAYER_SELECT",id:e})}}(t))},handleUnselect:function(){return e((function(e,t){e({type:"LAYER_UNSELECT"})}))},handleDelete:function(t){return e(function(e){return function(t,n){t({type:"LAYER_DELETE",id:e})}}(t))},handleMoveUp:function(t){return e(function(e){return function(t,n){t({type:"LAYER_MOVE_UP",id:e})}}(t))},handleMoveDown:function(t){return e(function(e){return function(t,n){t({type:"LAYER_MOVE_DOWN",id:e})}}(t))},handleSelectProperty:function(t,n){return e(ut(t,n))},handleVisibilityClick:function(t){return e(function(e){return function(t,n){t({type:"LAYER_VISIBILITY_TOGGLE",id:e})}}(t))},handleLockClick:function(t){return e(function(e){return function(t,n){t({type:"LAYER_LOCK_TOGGLE",id:e})}}(t))},restoreLayers:function(t){return e(pt(t))}}}))(Ht),Ft=n(704),Yt=n(280),Ut=n.n(Yt),Zt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).layerList=[],n.handleOnResize=function(e,t,a,i,r){n.props.handleOnResize(a,r,"layer")},n.handleChange=function(e){},n.handleAddLayer=function(e){e.stopPropagation();for(var t={},a=n.props.map.width,i=n.props.map.height,r=[],o=0;o<a*i;o++)r.push(0);t._id=Ut.a.Types.ObjectId(),t.opacity=1,t.name="New Layer Click to Rename",t.locked=!1,t.visible=!0,t.data=r,t.x=0,t.y=0,t.type="tilelayer",t.width=a,t.height=i,n.props.transactions.addTransaction(new Lt(t,n.props.layerList,n.props.handleAddLayer,n.props.restoreLayers))},n.handleMouseDown=function(e){e.stopPropagation(),n.layerList=[];var t=n.props.layerList;for(var a in t)n.layerList.push(Object(Se.a)({},t[a]))},n.handleOnMouseUp=function(e,t){e.stopPropagation(),n.props.transactions.addTransaction(new Lt(t,n.layerList,n.props.handlePassOpacity,n.props.restoreLayers)),n.layerList=[]},n.handleOpacityOnChange=function(e,t){n.props.handlePassOpacity(t)},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.open,a=t.dimension,r=t.selected,o=t.layerList,s=t.transactions,l=a.size.width-142,c=0;if(r)for(var d=0;d<o.length;d++)o[d]._id===r&&(c=Math.floor(100*o[d].opacity));return i.a.createElement(i.a.Fragment,null,n?i.a.createElement(ht.a,{className:"workscreen-window ",size:a.size,position:a.position,onMouseDown:function(){e.props.handleToTop("layer")},onResize:this.handleOnResize,onResizeStop:this.handleOnResize,onResizeStart:function(){return e.props.handleToTop("layer")},id:"layer",onDragStop:function(t,n){return e.props.handleOnDragStop(t,n,"layer")},style:{zIndex:a.zIndex}},i.a.createElement(At,{title:"Layer Window",handleClose:this.props.handleClose.bind(this,"layerOpen"),handleResetWindow:this.props.handleResetWindow,handleMaxWindow:this.props.handleMaxWindow}),i.a.createElement(Bt,{maxWidth:l,transactions:s}),i.a.createElement("i",{className:"fas fa-plus layer-add-btn better-btn",onMouseDown:function(e){return e.stopPropagation()},onClick:this.handleAddLayer}),i.a.createElement("span",{className:"opacity-text"},"OPACITY:"),i.a.createElement("div",{className:"layer-range"},i.a.createElement(Ft.a,{defaultValue:0,value:c,getAriaValueText:function(e){return e+"%"},"aria-labelledby":"discrete-slider",valueLabelDisplay:"auto",marks:!0,min:0,max:100,onMouseDown:this.handleMouseDown,onChange:this.handleOpacityOnChange,onChangeCommitted:this.handleOnMouseUp,disabled:!r}))):null)}}]),t}(i.a.Component),Vt=Object(m.b)((function(e){var t=e.layer,n=t.layerList,a=t.selected;return{layerList:n,map:e.map.map,selected:a}}),(function(e){return{handlePassOpacity:function(t){return e(function(e){return function(t,n){t({type:"LAYER_PASS_OPACITY",value:e})}}(t))},handleAddLayer:function(t){return e(function(e){return function(t,n){t({type:"ADD_LAYER",layer:e})}}(t))},restoreLayers:function(t){return e(pt(t))}}}))(Zt),Xt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleOnClick=function(e){n.props.shiftSelecting||e.stopPropagation()},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.selectedGrids,a=t.width,r=t.height;return i.a.createElement(i.a.Fragment,null,n&&n.map((function(t,n){var o={left:t.x-1,top:t.y-1,width:a+2,height:r+2};return i.a.createElement("div",{onClick:e.handleOnClick,key:n,style:o,className:"selected-grids"})})))}}]),t}(i.a.Component),Jt=n(44),qt=n.n(Jt),Kt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={scale:1,canvasWidth:0,canvasHeight:0,selectedGrids:[],shiftSelecting:!1,ctrlSelecting:!1},n.scrollbar=i.a.createRef(),n.handleZoomEffect=function(e){e.stopPropagation();var t=n.props.selectedTool;if(t===Nt.a.ZOOM_IN||t===Nt.a.ZOOM_OUT){var a=n.state.scale,i=t===Nt.a.ZOOM_IN?1.25:t===Nt.a.ZOOM_OUT?.8:1,r=a*i;n.setState({scale:r});var o=n.refs.display,s=o.getBoundingClientRect(),l=e.clientX,c=e.clientY,d=l-s.left,h=c-s.top,u=h*i-h,p=d*i-d;o.style.transform="scale("+r+")";var m=n.refs.scrollbar.getScrollLeft(),g=n.refs.scrollbar.getScrollTop();r>=1&&(n.refs.scrollbar.scrollLeft(p+m),n.refs.scrollbar.scrollTop(u+g))}},n.getSelectedTools=function(){var e=n.props.selectedTool;return e===Nt.a.ZOOM_IN?"display-zoom-in":e===Nt.a.ZOOM_OUT?"display-zoom-out":""},n.handleDrawImgToGrid=function(e,t){n.imageController.drawImage(e,t)},n.handleOnClick=function(e){var t=n.props.selectedTool;if(t!==Nt.a.ZOOM_IN&&t!==Nt.a.ZOOM_OUT){var a=e.clientX,i=e.clientY,r=n.handleFixPosition(a,i),o=r.x,s=r.y,l=n.imageController.getGridPositionFromMouseXY(o,s);n.handleSelectGrid(l)}else n.handleZoomEffect(e)},n.handleSelectGrid=function(e){var t=n.state,a=t.ctrlSelecting,i=t.shiftSelecting,r=n.state.selectedGrids;return a||i?a?(r.push(e),void n.handleGridStateChange(r)):i?(r=n.imageController.getBoxedGridPositionsFromGridPositions(r,e),void n.handleGridStateChange(r)):void 0:((r=[]).push(e),void n.handleGridStateChange(r))},n.handleGridStateChange=function(e){n.setState({selectedGrids:e},(function(){var t=n.props.index,a=n.imageController.handleConvertIndexToGID(e);n.props.tilesetSelectGrids(a),n.props.propertySelectTile("tilesets",a[0].index,t)}))},n.handleClearGrid=function(){n.setState({selectedGrids:[]})},n.handleFixPosition=function(e,t){var a=window.scrollX+e,i=window.scrollY+t;a-=n.refs.backgroundCanvas.getBoundingClientRect().left,i-=n.refs.backgroundCanvas.getBoundingClientRect().top;var r=n.state.scale;return{x:a/=r,y:i/=r}},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.tileset,n=this.refs.backgroundCanvas;this.props.tilesetIdApplier(n.id),this.imageController=new It(t,n);var a=this.imageController.getCanvasDimension(),i=a.canvasWidth,r=a.canvasHeight;this.setState({canvasWidth:i,canvasHeight:r},(function(){e.imageController.drawBackGround();var n=t.imageId;b.a.get("/data/image?imageId=".concat(n)).then((function(t){var n=t.data,a=n.err,i=n.msg,r=n.data;if(a)console.log(i);else{if(!r)return void e.props.handleTilesetLoaded();var o=W(r.data);e.handleDrawImgToGrid("data:image/jpeg;base64,"+o,(function(){e.props.handleTilesetLoaded()}))}}))})),window.onkeydown=function(t){qt.a.triggerLeftControll(t)?e.setState({ctrlSelecting:!0}):qt.a.triggerLeftShift(t)?e.setState({shiftSelecting:!0}):qt.a.triggerLeftCtrlZ(t)?e.props.transactions.undoTransaction():qt.a.triggerLeftCtrlY(t)&&e.props.transactions.doTransaction()},window.onkeyup=function(t){qt.a.triggerLeftControll(t)?e.setState({ctrlSelecting:!1}):qt.a.triggerLeftShift(t)&&e.setState({shiftSelecting:!1})}}},{key:"render",value:function(){var e=this.props,t=e.style,n=e.width,a=e.height,r=e.index,o=e.tileset,s=o.tileWidth,l=o.tileHeight,c=this.state,d=c.scale,h=c.canvasWidth,u=c.canvasHeight,p=c.selectedGrids,m=c.shiftSelecting,g=Object(Se.a)({},t,{marginLeft:h?h*d>=n?"auto":(n-h*d)/2:"auto",marginTop:u?u*d>=a?"auto":(a-u*d)/2:"auto"});return i.a.createElement(kt.Scrollbars,{style:Object(Se.a)({},t,{width:n,height:a}),ref:"scrollbar",renderThumbHorizontal:function(e){return i.a.createElement("div",Object.assign({},e,{className:"thumb"}))},renderThumbVertical:function(e){return i.a.createElement("div",Object.assign({},e,{className:"thumb"}))}},i.a.createElement("div",{ref:"display",className:"display-place "+this.getSelectedTools(),style:g,onClick:this.handleOnClick,onMouseDown:function(e){return e.stopPropagation()}},i.a.createElement("canvas",{ref:"backgroundCanvas",id:"tileset"+r,width:h,height:u}),i.a.createElement(Xt,{selectedGrids:p,width:s,height:l,parent:this,shiftSelecting:m})))}}]),t}(i.a.Component),Qt=Object(m.b)((function(e){return{socket:e.backend.socket}}),(function(e){return{tilesetSelectGrids:function(t){return e(function(e){return function(t,n){t({type:"SELECT_TILESET_GRIDS",selectedGrids:e})}}(t))},propertySelectTile:function(t,n,a){return e(function(e,t,n){return function(a,i){a({type:"SELECT_PROPERTY_TILE",window:e,id:t,index:n})}}(t,n,a))}}}))(Kt),en=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleGoView=function(e){if(e){var t=e._id;n.props.history.push("/".concat("tilesetviewer","/").concat(t)),n.forceUpdate()}},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.items,a=t.handleCheckboxClick,r=n.length,o={height:r>3?600:300};return i.a.createElement("div",{className:"workscreen-tilesetList"},i.a.createElement("div",{className:"workscreen-tilesetList-wrapper",style:o},n&&n.map((function(t,n){var o=n%3,s=Math.floor(n/3),l={top:r>3?0===s?200/3:200/3*2+200:50,left:0===o?"calc(25% - 135px)":1===o?"calc(50% - 90px)":"calc(75% - 45px)"},c=t._id;return i.a.createElement($,{className:"item-card",item:t,style:l,key:c,onClick:e.handleGoView,handleCheckboxClick:a,handleSetItem:e.handleSetItem,showEditeBts:!0})}))))}}]),t}(i.a.Component),tn=Object(m.b)((function(e){return{user:e.auth.user}}),(function(e){return{}}))(en),nn=function e(t,n,a,i){var r=this;Object(s.a)(this,e),this.doTransaction=function(){void 0!==r.oldValue?r.doCallback(r.oldValue):r.doCallback()},this.undoTransaction=function(){void 0!==r.newValue?r.undoCallback(r.newValue):r.undoCallback()},this.oldValue=t,this.doCallback=a,this.undoCallback=i,this.newValue=n},an=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleSearchChange=function(e){n.setState({search:e.target.value})},n.handleSortBy=function(e,t){n.setState({sortBy:t})},n.handleSortOrder=function(e,t){var a=n.state[t];n.setState(Object(k.a)({},t,1===a?-1:1))},n.handlePagination=function(e,t){n.setState({page:t})},n.getSelected=function(e){return n.state.sortBy===e?"tileset-sort-btn-selected":""},n.getSortOrder=function(e){return-1===n.state[e]?"fa-arrow-down":"fa-arrow-up"},n.handleCheckboxClick=function(e,t){t.target.checked?n.selectedTilesets.push(e):n.selectedTilesets=n.selectedTilesets.filter((function(t){return t._id!==e._id})),n.forceUpdate()},n.handleSubmitButton=function(){var e=JSON.parse(JSON.stringify(n.props.tilesets)),t=e.concat(n.selectedTilesets);n.selectedTilesets=[],n.props.transactions.addTransaction(new nn(t,e,n.props.handleUpdateTilesets,n.props.restoreTileset)),n.props.close()},n.state={page:1,search:"",sortBy:"lastUpdate",lastUpdate:-1,name:-1},n.selectedTilesets=[],n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.open,a=t.close,r=t.user,o=t.history,s=this.state,l=s.page,c=s.search,d=s.sortBy,h=He.GET_PUBLISHED_TILESETS,u=6*(l-1),p=this.state[d],m=Object(Ct.a)(new Set(this.props.tilesets.map((function(e){return e._id})))),g=0===this.selectedTilesets.length;return i.a.createElement(i.a.Fragment,null,i.a.createElement(U,{header:"Select Your Tilesets",open:n,fullWidth:!0,maxWidth:"lg",actions:[i.a.createElement(Z.a,{variant:"primary",size:"sm",key:"1",disabled:g,onClick:this.handleSubmitButton},"Confirm"),i.a.createElement(Z.a,{variant:"primary",size:"sm",key:"2",onClick:a},"Cancel")],content:i.a.createElement(i.a.Fragment,null,i.a.createElement(G,{value:c,onChange:this.handleSearchChange}),i.a.createElement("div",{className:"tileset-sort-btn-group"},i.a.createElement("button",{className:"tileset-sort-btn "+this.getSelected("name"),onClick:function(t){return e.handleSortBy(t,"name")}},"Name "),i.a.createElement("i",{className:"fa tileset-sort-icon "+this.getSortOrder("name"),onClick:function(t){return e.handleSortOrder(t,"name")}}),i.a.createElement("button",{className:"tileset-sort-btn "+this.getSelected("lastUpdate"),onClick:function(t){return e.handleSortBy(t,"lastUpdate")}},"Last Modified "),i.a.createElement("i",{className:"fa tileset-sort-icon "+this.getSortOrder("lastUpdate"),onClick:function(t){return e.handleSortOrder(t,"lastUpdate")}})),i.a.createElement(V.b,{query:h,variables:{userId:r._id,pageSkip:u,search:c,sortBy:d,sortOrder:p},fetchPolicy:"no-cache"},(function(t){var n=t.loading,a=t.error,r=t.data;if(n)return i.a.createElement(M.a,{className:"tileset-loading",size:220});if(a)return"error";if(h!==He.EMPTY_QUERY){if(!r)return"error";var s=r.user.publishedTilesets,c=(s=s.filter((function(e){for(var t=0;t<m.length;t++)if(m[t]===e._id)return!1;return!0}))).length,d=c%6===0?c/6:Math.floor(c/6)+1;return i.a.createElement("div",{className:"tileset-container"},i.a.createElement(tn,{items:s,history:o,handleCheckboxClick:e.handleCheckboxClick}),i.a.createElement(tt,{className:"tileset-pagination center",size:"large",color:"secondary",count:d,handlePagination:e.handlePagination,defaultPage:l}))}})))}))}}]),t}(i.a.Component),rn=Object(m.b)((function(e){return{user:e.auth.user}}),(function(e){return{handleUpdateTilesets:function(t){return e(mt(t))},restoreTileset:function(t){return e(ft(t))}}}))(an),on=function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleZoomIn=function(){n.setState({selectedTool:n.state.selectedTool===Nt.a.ZOOM_IN?"":Nt.a.ZOOM_IN})},n.handleZoomOut=function(){n.setState({selectedTool:n.state.selectedTool===Nt.a.ZOOM_OUT?"":Nt.a.ZOOM_OUT})},n.handleUnselectZoom=function(){n.setState({selectedTool:""})},n.handleOpenSelectTilesetDialog=function(){n.setState({selectTilesetDialogOpen:!0})},n.handleCloseSelectTilesetDialog=function(){n.setState({selectTilesetDialogOpen:!1})},n.tileMap=i.a.createRef(),n.handleTilesetLoaded=function(e){var t=Object(Ct.a)(n.state.loaded);t[e]=!0,n.setState({loaded:t},(function(){n.handleCheckAllTilesetLoaded()}))},n.handleCheckAllTilesetLoaded=function(){var e=n.state.loaded,t=!0;e.forEach((function(e){e||(t=!1)})),t&&n.props.handleTilesetLoaded()},n.handleSelect=function(){n.props.handleUnselect(),n.props.handleToTop("tileset")},n.handleOnResize=function(e,t,a,i,r){n.setState({resizing:!0},(function(){n.props.handleOnResize(a,r,"tileset")}))},n.handleStopResize=function(e,t,a,i,r){n.setState({resizing:!1},(function(){n.props.handleOnResize(a,"tileset")}))},n.handleOnDeleteTileset=function(){var e=n.props,t=e.tilesets,a=e.selectedItem;null!==a&&n.props.transactions.addTransaction(new nn(a._id,t,n.props.handleDeleteTileset,n.props.restoreTileset))},n.getCollapsibleList=function(){var e=n.props,t=e.dimension,a=e.tilesets,r=e.transactions;a=n.updateFirstgid(a);for(var o=n.state.selectedTool,s=t.size,l=s.width,c=s.height-86-24*a.length,d={maxWidth:l,maxHeight:c},h=[],u=function(e){h.push({type:"tileset",title:a[e].name,item:a[e],content:i.a.createElement(Qt,{handleTilesetLoaded:function(){return n.handleTilesetLoaded(e)},tilesetIdApplier:function(t){return n.props.tilesetIdApplier(t,e)},index:e,style:d,width:l,tileset:a[e],height:c,window:"tileset",childRef:function(e){return n.tileMap=e},selectedTool:o,transactions:r}),open:0===e})},p=0;p<a.length;p++)u(p);return h},n.handleOnClick=function(e){n.props.passSelectedTileset(null),e.target!==n.refs.zoom_in_btn&&e.target!==n.refs.zoom_out_btn&&n.handleUnselectZoom()};for(var a=[],r=0;r<n.props.tilesets.length;r++)a.push(!1);return n.state={resizing:!1,loaded:a,selectTilesetDialogOpen:!1,selectedTool:""},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"updateFirstgid",value:function(e){if(e&&e[0]){e[0].firstgid=1;for(var t=1;t<e.length;t++){var n=e[t-1],a=n.firstgid,i=n.tilecount;e[t].firstgid=a+i}}return e}},{key:"render",value:function(){var e=this,t=this.state,n=t.resizing,a=t.selectTilesetDialogOpen,r=t.selectedTool,o=this.props,s=o.open,l=o.dimension,c=o.tilesets,d=o.history,h=o.selectedItem,u=l.size,p={maxWidth:u.width,maxHeight:u.height-(110-24*c.length)};return i.a.createElement(i.a.Fragment,null,i.a.createElement(ht.a,{className:"workscreen-window "+(s?"":"invisible"),position:l.position,size:l.size,onMouseDown:this.handleSelect,onResizeStart:function(){return e.props.handleToTop("tileset")},onResize:this.handleOnResize,onResizeStop:this.handleStopResize,onClick:this.handleOnClick,id:"tileset",onDragStop:function(t,n){return e.props.handleOnDragStop(t,n,"tileset")},style:{zIndex:l.zIndex}},i.a.createElement(At,{title:"Tileset Window",handleClose:this.props.handleClose.bind(this,"tilesetOpen"),handleResetWindow:this.props.handleResetWindow,handleMaxWindow:this.props.handleMaxWindow}),i.a.createElement(bt,{data:this.getCollapsibleList(),maxHeight:p.maxHeight,resizing:n}),i.a.createElement("i",{className:"fas fa-plus tileset-add-btn better-btn ",onMouseDown:function(e){return e.stopPropagation()},onClick:this.handleOpenSelectTilesetDialog}),i.a.createElement("i",{ref:"zoom_in_btn",className:"fas fa-search-plus tileset-zoomin-btn better-btn "+(r===Nt.a.ZOOM_IN?"tool-selected":""),onMouseDown:function(e){return e.stopPropagation()},onClick:this.handleZoomIn}),i.a.createElement("i",{ref:"zoom_out_btn",className:"fas fa-search-minus tileset-zoomout-btn better-btn "+(r===Nt.a.ZOOM_OUT?"tool-selected":""),onMouseDown:function(e){return e.stopPropagation()},onClick:this.handleZoomOut}),i.a.createElement("i",{className:"fas fa-trash-alt tileset-delete-icon better-btn "+(h?"":"btn-disabled"),onClick:this.handleOnDeleteTileset,onMouseDown:function(e){return e.stopPropagation()}})),i.a.createElement(rn,{open:a,close:this.handleCloseSelectTilesetDialog,history:d,tilesets:c,transactions:this.props.transactions}))}}]),t}(i.a.Component),sn=Object(m.b)((function(e){var t=e.tileset;return{tilesets:t.tilesets,selectedItem:t.selectedItem}}),(function(e){return{handleUnselect:function(){return e((function(e,t){e({type:"TILESET_UNSELECT"})}))},handleTilesetLoaded:function(){return e((function(e,t){e({type:"TILESET_LOADED"})}))},tilesetIdApplier:function(t,n){return e(function(e,t){return function(n,a){n({type:"TILESET_ID_APPLIER",id:e,index:t})}}(t,n))},handleUpdateTilesets:function(t){return e(mt(t))},handleDeleteTileset:function(t){return e(function(e){return function(t,n){t({type:"TILESET_DELETE",id:e})}}(t))},restoreTileset:function(t){return e(ft(t))},passSelectedTileset:function(t){return e(gt(t))}}}))(on),ln=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).stopPropagation=function(e){e.stopPropagation()},n.handleSelect=function(e,t){(t.stopPropagation(),!0!==e.disable)&&(n.props.selectCallback&&n.props.selectCallback(),n.props.handleUnselect(),n.props.selected!==e.name&&n.props.handleSelect(e.name))},n.handleClick=function(e){var t=e.target;1===t.childElementCount?t.firstChild.click():(t=t.parentNode,setTimeout((function(){t.classList.remove("toolbar-cell-clicked")}),150))},n.handleMouseDown=function(e){e.stopPropagation();var t=e.target;0===t.childElementCount&&(t=t.parentNode),t.classList.add("toolbar-cell-clicked")},n.getSelected=function(e){return!0===e.disable?"toolbar-cell-disable":n.props.selected===e.name?"map-tool-selected":""},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.content,a=t.secondaryContent,r=t.rightContent,o=t.className;return i.a.createElement("div",{className:o},n&&n.map((function(t,n){return i.a.createElement("div",{className:"toolbar-cell "+e.getSelected(t),key:n,onMouseDown:e.handleMouseDown,onClick:e.handleClick},t.item)})),i.a.createElement("div",{className:"toolbar-sec-cellbox"},a&&a.map((function(t,n){var a={left:40*n};return i.a.createElement("div",{className:"toolbar-cell "+e.getSelected(t),key:n,onMouseDown:function(e){return e.stopPropagation()},style:a,onClick:e.handleSelect.bind(e,t)},t.item)}))),r&&r.map((function(t,n){return i.a.createElement("div",{className:"toolbar-right-cell "+e.getSelected(t),key:n,onMouseDown:e.stopPropagation,onClick:e.handleSelect.bind(e,t)},t.item)})))}}]),t}(i.a.Component),cn=Object(m.b)((function(e){return{selected:e.toolbar.selected}}),(function(e){return{handleSelect:function(t){return e(function(e){return function(t,n){t({type:"TOOLBAR_SELECT",name:e})}}(t))},handleUnselect:function(){return e((window,function(e,t){e({type:"TOOLBAR_UNSELECT"})}))}}}))(ln),dn=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={resizing:!1},n.tileMap=i.a.createRef(),n.handleOnResize=function(e,t,a,i,r){n.setState({resizing:!0},(function(){n.props.handleOnResize(a,r,"map")}))},n.handleOnResizeStop=function(e,t,a,i,r){n.setState({resizing:!1},(function(){n.props.handleOnResize(a,r,"map")}))},n.doTransaction=function(e){n.props.transactions.doTransaction()},n.undoTransaction=function(e){n.props.transactions.undoTransaction()},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state.resizing,n=this.props,a=n.dimension,r=n.selectedTool,o=n.transactions,s=n.open,l=a.size,c=l.width,d=l.height,h={maxWidth:c,maxHeight:d-90,marginTop:"20px"};return i.a.createElement(i.a.Fragment,null,s?i.a.createElement(ht.a,{className:"workscreen-window ",id:"map",size:a.size,position:a.position,onMouseDown:function(){e.props.handleToTop("map")},onClick:this.props.handleUnselect,onResizeStart:function(){return e.props.handleToTop("map")},onResize:this.handleOnResize,onResizeStop:this.handleOnResizeStop,onDragStop:function(t,n){return e.props.handleOnDragStop(t,n,"map")},style:{zIndex:a.zIndex}},i.a.createElement(At,{title:"Map Window",handleClose:this.props.handleClose.bind(this,"mapOpen"),handleResetWindow:this.props.handleResetWindow,handleMaxWindow:this.props.handleMaxWindow}),i.a.createElement(cn,{className:"map-toolbar",selected:r,content:[{name:Nt.a.UNDO,item:i.a.createElement("i",{className:"fas fa-undo",style:{fontSize:"24px"},onClick:this.undoTransaction})},{name:Nt.a.REDO,item:i.a.createElement("i",{className:"fas fa-redo",style:{fontSize:"24px"},onClick:this.doTransaction})},{name:Nt.a.DOWNLOAD,item:i.a.createElement("i",{className:"fas fa-download",style:{fontSize:"24px"},onClick:this.props.handleExport})},{name:Nt.a.SAVE,item:i.a.createElement("i",{className:"fas fa-save",style:{fontSize:"24px"},onClick:this.props.handleSave})}],secondaryContent:[{name:Nt.a.STAMP,item:i.a.createElement("i",{className:"fas fa-stamp",style:{fontSize:"24px"}})},{name:Nt.a.ERASER,item:i.a.createElement("i",{className:"fas fa-eraser",style:{fontSize:"24px"}})},{name:Nt.a.FILL,item:i.a.createElement("i",{className:"fas fa-fill",style:{fontSize:"24px"},onClick:function(){return e.props.handleTest()}})}],rightContent:[{name:Nt.a.ZOOM_OUT,item:i.a.createElement("i",{className:"fas fa-search-minus",style:{fontSize:"24px"}})},{name:Nt.a.ZOOM_IN,item:i.a.createElement("i",{className:"fas fa-search-plus",style:{fontSize:"24px"}})}]}),i.a.createElement(Rt,{style:h,width:c,height:d-70,window:"map",resizing:t,transactions:o})):null)}}]),t}(i.a.Component),hn=Object(m.b)((function(e){return{}}),(function(e){return{handleTest:function(){return e({type:"test",test:"hi"})},handleUnselect:function(){return e((function(e,t){e({type:"TOOLBAR_UNSELECT"})}))}}}))(dn),un=n(71),pn=function e(){var t=this;Object(s.a)(this,e),this.isPerformingDo=function(){return t.performingDo},this.isPerformingUndo=function(){return t.performingUndo},this.addTransaction=function(e){if(t.mostRecentTransaction<0||t.mostRecentTransaction<t.transactions.length-1)for(var n=t.transactions.length-1;n>t.mostRecentTransaction;n--)t.transactions.splice(n,1);t.transactions.push(e),t.doTransaction()},this.doTransaction=function(){t.hasTransactionToRedo()&&(t.performingDo=!0,t.transactions[t.mostRecentTransaction+1].doTransaction(),t.mostRecentTransaction++,t.performingDo=!1)},this.peekDo=function(){return t.hasTransactionToUndo()?t.transactions[t.mostRecentTransaction+1]:null},this.undoTransaction=function(){t.hasTransactionToUndo()&&(t.performingUndo=!0,t.transactions[t.mostRecentTransaction].undoTransaction(),t.mostRecentTransaction--,t.performingUndo=!1)},this.peekUndo=function(){return t.hasTransactionToUndo()?t.transactions[t.mostRecentTransaction]:null},this.clearAllTransactions=function(){t.transactions=[],t.mostRecentTransaction=-1},this.getSize=function(){return t.transactions.length},this.getRedoSize=function(){return t.getSize()-t.mostRecentTransaction-1},this.getUndoSize=function(){return t.mostRecentTransaction+1},this.hasTransactionToUndo=function(){return t.mostRecentTransaction>=0},this.hasTransactionToRedo=function(){return t.mostRecentTransaction<t.transactions.length-1},this.toString=function(){var e="--Number of Transactions: "+t.transactions.length+"\n";e+="--Current Index on Stack: "+t.mostRecentTransaction+"\n",e+="--Current Transaction Stack:\n";for(var n=0;n<=t.mostRecentTransaction;n++){e+="----"+t.transactions[n].toString()+"\n"}return e},this.transactions=[],this.mostRecentTransaction=-1,this.performingDo=!1,this.performingUndo=!1},mn=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.open,n=e.parent,a=e.saving,r=e.savemsg,o=e.saveConfirmed;return i.a.createElement(U,{header:"Save Project",open:t,actions:[i.a.createElement(Z.a,{key:"1",disabled:a,onClick:n.handleSave},"Confirm"),i.a.createElement(Z.a,{key:"2",onClick:n.handleSaveDialogClose},"Cancel")],content:[i.a.createElement("h3",{key:"e"},"Are You Sure to Save Project"),!1===o&&a?i.a.createElement(M.a,{key:"w",className:"wait-saving"}):null,i.a.createElement("p",{key:"q"},r)]})}}]),t}(i.a.Component),gn=n(281),fn=n.n(gn),yn=function(e){function t(){var e,a;Object(s.a)(this,t);for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return(a=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={propertyOpen:!0,layerOpen:!0,tilesetOpen:!0,mapOpen:!0,property:{size:{width:0,height:0},position:{x:0,y:0},zIndex:1},map:{size:{width:0,height:0},position:{x:0,y:0},zIndex:2},tileset:{size:{width:0,height:0},position:{x:0,y:0},zIndex:3},layer:{size:{width:0,height:0},position:{x:0,y:0},zIndex:4},saveDialogOpen:!1,saving:!1,saveConfirmed:!1,savemsg:""},a.transactions=new pn,a.handleToTop=function(e){var t=a.state[e].zIndex;if(4!==t){var n=a.state,i=n.property,r=n.map,o=n.tileset,s=n.layer,l=i.zIndex===t?4:i.zIndex<t?i.zIndex:i.zIndex-1,c=r.zIndex===t?4:r.zIndex<t?r.zIndex:r.zIndex-1,d=o.zIndex===t?4:o.zIndex<t?o.zIndex:o.zIndex-1,h=s.zIndex===t?4:s.zIndex<t?s.zIndex:s.zIndex-1;a.setState({property:Object(Se.a)({},i,{zIndex:l}),map:Object(Se.a)({},r,{zIndex:c}),tileset:Object(Se.a)({},o,{zIndex:d}),layer:Object(Se.a)({},s,{zIndex:h})})}},a.getScreen=function(){var e=a.state,t=e.propertyOpen,n=e.layerOpen,r=e.tilesetOpen,o=e.property,s=e.map,l=e.layer,c=e.tileset,d=e.mapOpen,h=a.props.history;return i.a.createElement(i.a.Fragment,null,i.a.createElement(hn,{key:"map",open:d,handleToTop:a.handleToTop,dimension:s,handleOnDragStop:a.handleOnDragStop,handleOnResize:a.handleOnResize,transactions:a.transactions,handleSave:a.handleSaveDialogOpen,handleExport:a.handleExport,handleClose:a.handleClose,handleResetWindow:a.handleResetWindow.bind(Object(dt.a)(a),"map"),handleMaxWindow:a.handleMaxWindow.bind(Object(dt.a)(a),"map")}),i.a.createElement(zt,{key:"property",open:t,handleToTop:a.handleToTop,dimension:o,handleOnDragStop:a.handleOnDragStop,handleOnResize:a.handleOnResize,transactions:a.transactions,handleClose:a.handleClose,handleResetWindow:a.handleResetWindow.bind(Object(dt.a)(a),"property"),handleMaxWindow:a.handleMaxWindow.bind(Object(dt.a)(a),"property")}),i.a.createElement(Vt,{key:"layer",open:n,handleToTop:a.handleToTop,dimension:l,handleOnDragStop:a.handleOnDragStop,handleOnResize:a.handleOnResize,transactions:a.transactions,handleClose:a.handleClose,handleResetWindow:a.handleResetWindow.bind(Object(dt.a)(a),"layer"),handleMaxWindow:a.handleMaxWindow.bind(Object(dt.a)(a),"layer")}),i.a.createElement(sn,{key:"tileset",open:r,dimension:c,history:h,handleToTop:a.handleToTop,handleOnDragStop:a.handleOnDragStop,handleOnResize:a.handleOnResize,transactions:a.transactions,handleClose:a.handleClose,handleResetWindow:a.handleResetWindow.bind(Object(dt.a)(a),"tileset"),handleMaxWindow:a.handleMaxWindow.bind(Object(dt.a)(a),"tileset")}))},a.handleWindowOpen=function(e,t){e.stopPropagation(),a.setState(Object(k.a)({},t,!a.state[t]))},a.handleOnDragStop=function(e,t,n){a.setState(Object(k.a)({},n,Object(Se.a)({},a.state[n],{position:{x:t.x,y:t.y}})))},a.doTransaction=function(){a.transactions.doTransaction()},a.undoTransaction=function(){a.transactions.undoTransaction()},a.handleOnResize=function(e,t,n){a.setState(Object(k.a)({},n,Object(Se.a)({},a.state[n],{size:{width:parseInt(e.style.width),height:parseInt(e.style.height)},position:{x:parseInt(t.x),y:parseInt(t.y)}})))},a.handleFormatMapJson=function(){var e=a.props,t=e.layers,n=e.map,i=e.tilesets,r=e.custom,o=Object(Se.a)({},n,{tiledversion:"1.3.2",compressionlevel:-1});delete o._id;var s=t.map((function(e,t){return delete e.locked,e.id=t+1,delete e._id,e}));o.layers=s;var l=i.map((function(e){return{name:e.name,columns:e.columns,tilewidth:e.tileWidth,tileheight:e.tileHeight,tilecount:e.tilecount,margin:e.margin,firstgid:e.firstgid,image:"".concat(e.name,".jpeg"),imagewidth:e.width,imageheight:e.height,spacing:e.spacing}}));return o.tilesets=l,o.properties=r,o},a.handleExport=function(){var e=a.props.project,t=a.handleFormatMapJson();n(103)(JSON.stringify(t).toLowerCase(),"".concat(e.name,".json"),"text/plain")},a.handleSaveDialogOpen=function(){a.setState({saveDialogOpen:!0})},a.handleSave=function(){var e=a.props,t=e.layers,n=e.map,i=e.tilesets,r=e.custom,o=e.project;fn()(document.getElementById("map-display")).then((function(e){var s=e.toDataURL("image/jpeg",1);a.setState({saving:!0},(function(){a.props.socket.emit("project-save",{layers:t,map:n,tilesets:i,custom:r,project:o,imgData:s})}))}))},a.handleSaveDialogClose=function(){a.setState({saveDialogOpen:!1,saving:!1,saveConfirmed:!1,savemsg:""})},a.handleClose=function(e){a.setState(Object(k.a)({},e,!1))},a.handleResetWindow=function(e){var t=document.body.getBoundingClientRect(),n=t.width,i=t.height;"property"===e?a.setState({property:Object(Se.a)({},a.state.property,{size:{width:.2*n,height:.88*i},position:{x:0,y:0}})}):"map"===e?a.setState({map:Object(Se.a)({},a.state.map,{size:{width:.6*n,height:.88*i},position:{x:.2*n,y:0}})}):"layer"===e?a.setState({layer:Object(Se.a)({},a.state.layer,{size:{width:.2*n,height:.32*i},position:{x:.8*n,y:0}})}):"tileset"===e&&a.setState({tileset:Object(Se.a)({},a.state.tileset,{size:{width:.2*n,height:.56*i},position:{x:.8*n,y:.32*i}})})},a.handleMaxWindow=function(e){var t=document.body.getBoundingClientRect(),n=t.width,i=t.height;console.log(e),a.setState(Object(k.a)({},e,Object(Se.a)({},a.state[e],{size:{width:n,height:.88*i},position:{x:0,y:0}})))},a.render=function(){var e=a.state,t=e.propertyOpen,n=e.layerOpen,r=e.tilesetOpen,o=e.mapOpen,s=e.saveDialogOpen,l=e.saving,c=e.savemsg,d=e.saveConfirmed,h=a.props,u=h.history,p=h.loaded,m=a.props.match.params.key;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{onClick:a.handleUnselect},i.a.createElement(_,{site:"workspace",handleWindowOpen:a.handleWindowOpen,propertyOpen:t,layerOpen:n,tilesetOpen:r,mapOpen:o,history:u,handleDoTransaction:a.doTransaction,handleUndoTransaction:a.undoTransaction,handleSave:a.handleSaveDialogOpen,handleExport:a.handleExport}),i.a.createElement("div",null,i.a.createElement(V.b,{query:He.GET_PROJECT,variables:{id:m}},(function(e){return e.loading?"loading":e.error?"error":(p||(e.data.project.tilesetsInfo=e.data.project.tilesetsInfo.filter((function(e){return null!==e})),a.props.formatProjectPack(e.data.project)),a.getScreen())})))),i.a.createElement(mn,{open:s,parent:Object(dt.a)(a),saving:l,savemsg:c,saveConfirmed:d}))},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=document.body.getBoundingClientRect(),n=t.width,a=t.height;this.setState({property:{size:{width:.2*n,height:.88*a},position:{x:0,y:0},zIndex:1},map:{size:{width:.6*n,height:.88*a},position:{x:.2*n,y:0},zIndex:2},layer:{size:{width:.2*n,height:.32*a},position:{x:.8*n,y:0},zIndex:3},tileset:{size:{width:.2*n,height:.56*a},position:{x:.8*n,y:.32*a},zIndex:4}}),window.onresize=function(){var t=document.body.getBoundingClientRect(),n=t.width,a=t.height;e.setState({property:Object(Se.a)({},e.state.property,{size:{width:.2*n,height:.88*a},position:{x:0,y:0}}),map:Object(Se.a)({},e.state.map,{size:{width:.6*n,height:.88*a},position:{x:.2*n,y:0}}),layer:Object(Se.a)({},e.state.layer,{size:{width:.2*n,height:.32*a},position:{x:.8*n,y:0}}),tileset:Object(Se.a)({},e.state.tileset,{size:{width:.2*n,height:.56*a},position:{x:.8*n,y:.32*a}})})}}},{key:"UNSAFE_componentWillMount",value:function(){var e=this;this.props.socket.on("project-save-back",(function(t){var n=t.err,a=t.msg;n?e.setState({savemsg:a,saving:!1}):e.setState({savemsg:a,saveConfirmed:!0,saving:!1})}))}}]),t}(i.a.Component),bn=Object(un.d)(Object(m.b)((function(e,t){return{loaded:e.project.loaded,layers:e.layer.layerList,map:e.map.map,tilesets:e.tileset.tilesets,project:e.project,socket:e.backend.socket,custom:e.property.custom}}),(function(e){return{formatProjectPack:function(t){return e(function(e){return function(t,n){t({type:"FORMAT_PROJECT",project:e})}}(t))},handleUnselect:function(){return e((function(e,t){e({type:"TOOLBAR_UNSELECT"})}))}}})))(yn),vn=(n(453),n(18)),En=n.n(vn),On=n(282),Cn=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={displayColorPicker:!1,color:"#c17de8"},n.handleClick=function(){n.setState({displayColorPicker:!n.state.displayColorPicker})},n.handleClose=function(){n.setState({displayColorPicker:!1})},n.handleChange=function(e){n.setState({color:e.hex})},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=e.onChange,a=En()({default:{color:{width:"36px",height:"14px",borderRadius:"100%",background:"rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(t.a,")")},swatch:{padding:"5px",background:"#fff",borderRadius:"100%",boxShadow:"0 0 0 1px rgba(0,0,0,.1)",display:"inline-block",cursor:"pointer"},popover:{position:"absolute",zIndex:"2",right:"1%"},cover:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}}});return i.a.createElement("div",{className:"color-btn"},i.a.createElement("div",{style:a.swatch,onClick:this.handleClick},i.a.createElement("div",{style:a.color})),this.state.displayColorPicker?i.a.createElement("div",{style:a.popover},i.a.createElement("div",{style:a.cover,onClick:this.handleClose}),i.a.createElement(On.SketchPicker,{color:t,onChange:n,className:"left"})):null)}}]),t}(a.Component),Sn=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.sliderValue,n=e.sliderOnChange,a=e.borderColor,r=e.borderColorOnChange,o=e.fillColor,s=e.fillColorOnChange;return i.a.createElement("div",{className:"propertybar-wrapper"},i.a.createElement("div",{className:"property-box"},i.a.createElement("div",{className:"property-title"},"Border Thickness:"),i.a.createElement("div",{className:"ranger"},i.a.createElement(Ft.a,{"aria-labelledby":"discrete-slider",valueLabelDisplay:"auto",marks:!0,value:t,onChange:n,min:1,max:20,onMouseDown:function(e){return e.stopPropagation()}}))),i.a.createElement("div",{className:"property-box"},i.a.createElement("div",{className:"property-title"},"Border Color:"),i.a.createElement(Cn,{color:a,onChange:r})),i.a.createElement("div",{className:"property-box"},i.a.createElement("div",{className:"property-title"},"Fill Color:"),i.a.createElement(Cn,{color:o,onChange:s})),i.a.createElement("div",{className:"property-box"},i.a.createElement("div",{className:"property-title"},"Flip"),i.a.createElement("div",{className:"property-flip-btn",onClick:this.props.handleHorizontalFlip},"Horizontally"),i.a.createElement("div",{className:"property-flip-btn",onClick:this.props.handleVerticalFlip},"Vertically")),i.a.createElement("div",{className:"property-box"},i.a.createElement("div",{className:"property-center",onClick:this.props.handleClear},"Clear")))}}]),t}(i.a.Component),wn=function e(t){var n=this;Object(s.a)(this,e),this.setDimension=function(e,t){n.width=e,n.height=t},this.initDraw=function(e,t,a,i){n.tool=e,n.ctx.lineWidth=t,n.ctx.fillStyle="rgba(".concat(a.r,", ").concat(a.g,", ").concat(a.b,", ").concat(a.a,")"),n.ctx.strokeStyle="rgba(".concat(i.r,", ").concat(i.g,", ").concat(i.b,", ").concat(i.a,")")},this.startDraw=function(e,t){void 0!==n[n.tool]&&(n.drawing=!0,n.oldImg=n.view.refs.canvas.toDataURL("image/jpeg",1),n[n.tool].startDraw(e,t))},this.onDraw=function(e,t){void 0!==n[n.tool]&&n.drawing&&n[n.tool].onDraw(e,t)},this.endDraw=function(e,t){if(void 0!==n[n.tool]&&(n.drawing||"FILL"===n.tool)){n[n.tool].endDraw(e,t),n.drawing=!1,n.startData=null,n.view.sendSocketNewOperation();var a=n.ctx.canvas.toDataURL("image/jpeg",1);n.view.addNewTransaction(n.oldImg,a),n.oldImg=null}},this.PENCIL={startDraw:function(e,t){n.ctx.beginPath(),n.ctx.moveTo(e,t)},onDraw:function(e,t){n.ctx.lineTo(e,t),n.ctx.lineWidth=n.lineWidth,n.ctx.lineCap="round",n.ctx.stroke()},endDraw:function(){}},this.LINE={startDraw:function(e,t){n.startX=e,n.startY=t,n.startData=n.ctx.getImageData(0,0,n.width,n.height)},onDraw:function(e,t){null!==n.startX&&null!==n.startY&&(n.ctx.putImageData(n.startData,0,0),n.ctx.beginPath(),n.ctx.moveTo(n.startX,n.startY),n.ctx.lineTo(e,t),n.ctx.lineCap="round",n.ctx.stroke())},endDraw:function(){n.startX=null,n.startY=null}},this.SQUARE={startDraw:function(e,t){n.startX=e,n.startY=t,n.startData=n.ctx.getImageData(0,0,n.width,n.height)},onDraw:function(e,t){null!==n.startX&&null!==n.startY&&(n.ctx.putImageData(n.startData,0,0),n.ctx.beginPath(),n.ctx.rect(n.startX,n.startY,e-n.startX,t-n.startY),n.ctx.fill(),n.ctx.stroke())},endDraw:function(){n.startX=null,n.startY=null}},this.CIRCLE={startDraw:function(e,t){n.startX=e,n.startY=t,n.startData=n.ctx.getImageData(0,0,n.width,n.height)},onDraw:function(e,t){if(null!==n.startX&&null!==n.startY){n.ctx.putImageData(n.startData,0,0);var a=(e+n.startX)/2,i=(t+n.startY)/2,r=Math.abs(e-n.startX)/2,o=Math.abs(t-n.startY)/2;n.ctx.beginPath(),n.ctx.ellipse(a,i,r,o,0,0,2*Math.PI),n.ctx.fill(),n.ctx.stroke()}},endDraw:function(){n.startX=null,n.startY=null}},this.ERASER={startDraw:function(e,t){n.ctx.save(),n.ctx.strokeStyle="rgba(211,211,211,1)",n.ctx.beginPath()},onDraw:function(e,t){var a=e-n.ctx.lineWidth/2,i=t-n.ctx.lineWidth/2;n.ctx.rect(a,i,n.ctx.lineWidth,n.ctx.lineWidth),n.ctx.fill(),n.ctx.stroke()},endDraw:function(){n.ctx.restore()}},this.FILL={endDraw:function(e,t){n.view.GridController.fillGridFromMouseXY(e,t)}},this.CROP={startDraw:function(e,t){n.ctx.save(),n.ctx.lineWidth=1,n.ctx.fillStyle="rgba(0,0,0,0)",n.ctx.strokeStyle="rgba({0,0,0,1})",n.startX=e,n.startY=t,n.startData=n.ctx.getImageData(0,0,n.width,n.height)},onDraw:function(e,t){null!==n.startX&&null!==n.startY&&(n.ctx.putImageData(n.startData,0,0),n.ctx.beginPath(),n.ctx.setLineDash([6]),n.ctx.strokeRect(n.startX,n.startY,e-n.startX,t-n.startY))},endDraw:function(){n.ctx.putImageData(n.startData,0,0),n.ctx.restore()}},this.tool=null,this.fillStyle="",this.drawing=!1,this.view=t,this.ctx=t.ctx},Tn=function e(t,n,a){var i=this;Object(s.a)(this,e),this.doTransaction=function(){i.callback(i.new_value)},this.undoTransaction=function(){i.callback(i.old_value)},this.old_value=t,this.new_value=n,this.callback=a},kn=function e(t,n,a,i,r){var o=this;Object(s.a)(this,e),this.getImageData=function(){return o.ctx.getImageData(0,0,o.canvasWidth,o.canvasHeight)},this.drawGrid=function(){o.drawGridBackground(),o.drawGridBorder()},this.drawGridBorder=function(){o.ctx.save(),o.ctx.fillStyle=o.gridColor;for(var e=0;e<o.numRow+1;e++){var t=e*(o.gridThickness+o.tileHeight);o.ctx.fillRect(0,t,o.canvasWidth,o.gridThickness)}for(var n=0;n<o.numColumn+1;n++){var a=n*(o.gridThickness+o.tileWidth);o.ctx.fillRect(a,0,o.gridThickness,o.canvasHeight)}o.ctx.restore()},this.drawCopiedGrid=function(e){o.ctx.save(),o.ctx.fillStyle="rgba({0,0,0,1})",o.ctx.strokeStyle="white",o.ctx.lineWidth=1;for(var t=0;t<e.length;t++)o.ctx.beginPath(),o.ctx.setLineDash([3]),o.ctx.strokeRect(e[t].x-1,e[t].y-1,o.tileWidth+2,o.tileHeight+2);o.ctx.restore()},this.drawGridBackground=function(){o.ctx.save(),o.ctx.fillStyle=o.backgroundColor,o.ctx.fillRect(0,0,o.canvasWidth,o.canvasHeight),o.ctx.restore()},this.DrawGridsByRegion=function(e,t,n){for(var a=0;a<t.length;a++)o.ctx.putImageData(e,t[a].dx,t[a].dy,n[a].x,n[a].y,o.tileWidth,o.tileHeight)},this.clearGridsByRegion=function(e){o.ctx.save(),o.ctx.fillStyle=o.backgroundColor;for(var t=0;t<e.length;t++)o.ctx.fillRect(e[t].x,e[t].y,o.tileWidth,o.tileHeight);o.ctx.restore(),o.drawGridBorder()},this.setGridThickness=function(e){o.gridThickness=e},this.getGridThickness=function(){return o.gridThickness},this.setGridColor=function(e){o.gridColor=e},this.getGridColor=function(){return o.getGridColor},this.setBackgroundColor=function(e){o.backgroundColor=e},this.getBackGroundColor=function(){return o.backgroundColor},this.buildModel=function(){o.numColumn=Math.floor(o.visialWidth/o.tileWidth),o.numRow=Math.floor(o.visialHeight/o.tileHeight);for(var e=0;e<o.numRow;e++)for(var t=0;t<o.numColumn;t++)o.gridPositions.push({x:o.gridThickness+t*(o.tileWidth+o.gridThickness),y:o.gridThickness+e*(o.tileHeight+o.gridThickness),dx:o.gridThickness+t*(o.tileWidth+o.gridThickness)-t*o.tileWidth,dy:o.gridThickness+e*(o.tileHeight+o.gridThickness)-e*o.tileHeight,sx:t*o.tileWidth,sy:e*o.tileHeight})},this.setCanvasDimension=function(){o.canvasWidth=o.visialWidth+(o.numColumn+1)*o.gridThickness,o.canvasHeight=o.visialHeight+(o.numRow+1)*o.gridThickness},this.getCanvasDimension=function(){return{width:o.canvasWidth,height:o.canvasHeight}},this.getGridPositions=function(){return o.gridPositions},this.mouseXYisInGrid=function(e,t,n,a){return e>n&&t>a&&e<n+o.tileWidth&&t<a+o.tileHeight},this.getGridIndexFromMouseXY=function(e,t){for(var n=0;n<o.numRow;n++)for(var a=0;a<o.numColumn;a++){var i=o.gridThickness+a*(o.tileWidth+o.gridThickness),r=o.gridThickness+n*(o.tileHeight+o.gridThickness);if(o.mouseXYisInGrid(e,t,i,r))return{x:a,y:n}}return null},this.getGridIndexFromPosition=function(e,t){return{x:Math.floor((e-o.gridThickness)/(o.gridThickness+o.tileWidth)),y:Math.floor((t-o.gridThickness)/(o.gridThickness+o.tileHeight))}},this.getGridPositionFromIndex=function(e,t){return{x:o.gridThickness+e*(o.tileWidth+o.gridThickness),y:o.gridThickness+t*(o.tileHeight+o.gridThickness)}},this.getGridPositionFromMouseXY=function(e,t){if(e>o.canvasWidth)return o.getGridPositionFromIndex(o.canvasWidth-o.gridThickness-o.tileWidth,t);if(t>o.canvasHeight)return o.getGridPositionFromIndex(e,o.canvasHeight-o.gridThickness-o.tileHeight);var n=o.getGridIndexFromMouseXY(e,t);return n?o.getGridPositionFromIndex(n.x,n.y):o.getGridPositionFromMouseXY(e+o.gridThickness,t+o.gridThickness)},this.fillGridFromMouseXY=function(e,t){var n=o.getGridPositionFromMouseXY(e,t);n&&o.ctx.fillRect(n.x,n.y,o.tileWidth,o.tileHeight)},this.getGridImageDataFromPosition=function(e,t){return o.ctx.getImageData(e,t,o.tileWidth,o.tileHeight)},this.putGridImageDataToPosition=function(e,t,n){o.ctx.putImageData(e,t,n)},this.getHorizontalSymetricalPosition=function(e,t){var n=o.getGridIndexFromPosition(e,t);if(n){var a={x:o.numColumn-1-n.x,y:n.y};return o.getGridPositionFromIndex(a.x,a.y)}},this.getVerticalSymetricalPosition=function(e,t){var n=o.getGridIndexFromPosition(e,t);if(n){var a={x:n.x,y:o.numRow-1-n.y};return o.getGridPositionFromIndex(a.x,a.y)}},this.getGridPositionsFromCropMouse=function(e){var t=o.getGridPositionFromMouseXY(e.start.x,e.start.y),n=o.getGridPositionFromMouseXY(e.end.x,e.end.y);return o.getGridPositionsFromCropPositions(t,n)},this.getGridPositionsFromCropPositions=function(e,t){var n=[],a=Math.min(e.x,t.x),i=Math.min(e.y,t.y),r=Math.max(e.x,t.x),s=Math.max(e.y,t.y);e={x:a,y:i},t={x:r,y:s};for(var l=0;l<o.gridPositions.length;l++)o.gridPositions[l].x>e.x-o.gridThickness-o.tileWidth&&o.gridPositions[l].x<t.x+o.gridThickness+o.tileWidth&&o.gridPositions[l].y>e.y-o.gridThickness-o.tileHeight&&o.gridPositions[l].y<t.y+o.gridThickness+o.tileHeight&&n.push({x:o.gridPositions[l].x,y:o.gridPositions[l].y});return n},this.getCropPositionFromGridPositions=function(e){for(var t=1/0,n=1/0,a=-1/0,i=-1/0,r=0;r<e.length;r++)e[r].x<t&&(t=e[r].x),e[r].x>a&&(a=e[r].x),e[r].y<n&&(n=e[r].y),e[r].y>i&&(i=e[r].y);return{left:t,top:n,leftMax:a,topMax:i,width:a+o.tileWidth-t,height:i+o.tileHeight-n}},this.mouseXYisInGrids=function(e,t,n){for(var a=0;a<n.length;a++)if(e>n[a].x&&t>n[a].y&&e<n[a].x+o.tileWidth&&t<n[a].y+o.tileHeight)return!0;return!1},this.handleShiftSelectedGrids=function(e,t,n){for(var a=0;a<n.length;a++)n[a].x+=e,n[a].y+=t},this.handleShift2Grids=function(e,t,n,a){for(var i=o.getGridPositionFromMouseXY(e,t),r=i.x-a.x,s=i.y-a.y,l=0;l<n.length;l++)n[l].x+=r,n[l].y+=s},this.getGridsPositionFromMouseGrids=function(e,t,n,a){for(var i=[],r=o.getGridPositionFromMouseXY(e,t),s=r.x-a.x,l=r.y-a.y,c=0;c<n.length;c++)i.push({x:n[c].x+s,y:n[c].y+l,dx:s,dy:l});return i},this.getPositionsForNoGridsImage=function(){for(var e=[],t=0;t<o.numRow;t++)for(var n=0;n<o.numColumn;n++)e.push({x:n*o.tileWidth,y:t*o.tileHeight,dx:n*o.tileWidth-(o.gridThickness+n*(o.tileWidth+o.gridThickness)),dy:t*o.tileHeight-(o.gridThickness+t*(o.tileHeight+o.gridThickness))});return e},this.getMinRegionGridPositionsFromGridsAndGrid=function(e,t){var n=o.getCropPositionFromGridPositions(e),a=n.left,i=n.top,r=t.x,s=t.y;return o.getGridPositionsFromCropPositions({x:a,y:i},{x:r,y:s})},this.getGridDiffFrom2Grids=function(e,t){for(var n=o.getCropPositionFromGridPositions(e),a=o.getCropPositionFromGridPositions(t),i=a.left-n.left,r=a.top-n.top,s=[],l=0;l<e.length;l++)s.push({dx:i,dy:r});return s},this.drawGridsByGridsDiff=function(e,t){for(var n=o.ctx.getImageData(0,0,o.canvasWidth,o.canvasHeight),a=0;a<e.length;a++)o.ctx.putImageData(n,t[a].dx,t[a].dy,e[a].x,e[a].y,o.tileWidth+o.gridThickness,o.tileHeight+o.gridThickness);o.drawGridBorder()},this.getGridsFromGridsDiffandGrids=function(e,t){if(e.length!==t.length)throw new Error("error");for(var n=[],a=0;a<e.length;a++)n.push({x:e[a].x+t[a].dx,y:e[a].y+t[a].dy});return n},this.ctx=t,this.visialWidth=n,this.visialHeight=a,this.tileWidth=i,this.tileHeight=r,this.gridPositions=[],this.numColumn=0,this.numRow=0,this.gridColor="#000000",this.backgroundColor="rgba(211,211,211,1)",this.gridThickness=2,this.canvasWidth=0,this.canvasHeight=0,this.buildModel(),this.setCanvasDimension()},xn=function e(t,n){var a=this;Object(s.a)(this,e),this.pastGrids=function(e){console.log(e)},this.getStartGrids=function(){return a.startGrids},this.getStartImageData=function(){return a.startImgData},this.startGrids=JSON.parse(JSON.stringify(t)),this.startImgData=n},jn=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={mouseDown:!1,lastX:null,lastY:null,selectedGrid:null,grid:null,lastGrid:null,startX:null,startY:null,startGrids:null,startImgData:null,startImg:null},n.handleMoveStart=function(e,t){e.stopPropagation();var a=e.clientX,i=e.clientY,r=n.props.parent.handleFixPosition(a,i),o=r.x,s=r.y,l=n.props.selectedGrid,c=n.props.parent.GridController.getImageData(),d=n.props.parent.refs.canvas.toDataURL("image/jpeg",1),h=JSON.parse(JSON.stringify(l)),u=JSON.parse(JSON.stringify(t));n.setState({mouseDown:!0,lastX:o,lastY:s,selectedGrid:l,grid:t,startX:t.x,startY:t.y,startGrids:h,startImgData:c,lastGrid:u,startImg:d},(function(){n.props.parent.handleStopCopying()}))},n.handleMove=function(e,t){var a=n.state,i=a.mouseDown,r=a.lastX,o=a.lastY,s=a.selectedGrid,l=a.startX,c=a.startY,d=a.startGrids,h=a.startImgData,u=a.lastGrid;if(i&&r&&o){var p=e-r,m=t-o;n.props.parent.GridController.handleShiftSelectedGrids(p,m,s);var g=n.props.parent.GridController.getGridsPositionFromMouseGrids(e,t,d,{x:l,y:c});n.props.parent.GridController.clearGridsByRegion(d),u&&n.props.parent.GridController.mouseXYisInGrid(e,t,u.x,u.y)||(n.props.parent.ctx.putImageData(h,0,0),n.props.parent.GridController.clearGridsByRegion(d)),n.props.parent.GridController.DrawGridsByRegion(h,g,d),u=n.props.parent.GridController.getGridPositionFromMouseXY(e,t),n.setState({lastX:e,lastY:t,lastGrid:u})}},n.handleMoveEnd=function(e){n.props.shiftSelecting||e.stopPropagation();var t=e.clientX,a=e.clientY,i=n.state,r=i.selectedGrid,o=i.grid,s=i.startImg,l=n.props.parent.handleFixPosition(t,a),c=l.x,d=l.y;n.props.parent.GridController.handleShift2Grids(c,d,r,o);var h=n.props.parent.refs.canvas.toDataURL("image/jpeg",1);n.props.parent.addNewTransaction(s,h),n.props.parent.sendSocketNewOperation(),n.setState({mouseDown:!1,lastX:null,lastY:null,startGrids:null,startX:null,startY:null,grid:null,startImgData:null,lastGrid:null,startImg:null})},n.handleMoveLeave=function(e){n.state.mouseDown&&n.props.parent.handleToolMove(e)},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.props.childRef(this)}},{key:"render",value:function(){var e=this,t=this.props,n=t.selectedGrid,a=t.width,r=t.height,o=this.state.mouseDown?"rgba(0,0,0,0)":"rgba(0,0,205,0.4)";return i.a.createElement(i.a.Fragment,null,n&&n.map((function(t,n){var s={left:t.x-1,top:t.y-1,width:a+2,height:r+2,backgroundColor:o};return i.a.createElement("div",{onMouseDown:function(n){return e.handleMoveStart(n,t)},onMouseLeave:e.handleMoveLeave,onClick:function(n){return e.handleMoveEnd(n,t)},key:n,style:s,className:"selected-box"})})))}}]),t}(i.a.Component),In=function(e){function t(){var e,a;Object(s.a)(this,t);for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return(a=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={canvasWidth:0,canvasHeight:0,DisplayBoxWidth:0,DisplayBoxHeight:0,mouseDown:!1,selectedGrid:[],ctrlSelecting:!1,shiftSelecting:!1,cropDimension:null,copying:!1,dialogOpen:!1},a.selectedBoxes=i.a.createRef(),a.getSelectedTools=function(){var e=a.props.selectedTool;return e===Nt.a.ZOOM_IN?"display-zoom-in":e===Nt.a.ZOOM_OUT?"display-zoom-out":e===Nt.a.PENCIL?"display-pencil":e===Nt.a.ERASER?"display-eraser":e===Nt.a.FILL?"display-fill":e?"display-cross-cursor":""},a.handleToolStart=function(e){var t=a.props,n=t.selectedTool,i=t.borderThic,r=t.fillColor,o=t.borderColor;if(n&&(!a.state.shiftSelecting&&(a.painter.initDraw(n,i,r,o),n!==Nt.a.FILL))){var s=e.clientX,l=e.clientY,c=a.handleFixPosition(s,l),d=c.x,h=c.y;n===Nt.a.CROP&&a.setState({cropDimension:{start:{x:d,y:h}}}),a.painter.startDraw(d,h),a.setState({mouseDown:!0})}},a.handleToolMove=function(e){var t=a.state,n=t.mouseDown,i=t.selectedGrid,r=e.clientX,o=e.clientY,s=a.handleFixPosition(r,o),l=s.x,c=s.y;0!==i.length&&a.selectedBoxes.state.mouseDown&&a.selectedBoxes.handleMove(l,c),n&&(a.painter.onDraw(l,c),a.GridController.drawGridBorder())},a.handleToolEnd=function(e,t){var n=a.props.selectedTool,i=a.state.shiftSelecting;if(n&&!i||"click"!==t){if((n!==Nt.a.ZOOM_IN&&n!==Nt.a.ZOOM_OUT&&n!==Nt.a.FILL||"out"!==t)&&(!1!==a.state.mouseDown||n===Nt.a.FILL))if(n!==Nt.a.ZOOM_IN&&n!==Nt.a.ZOOM_OUT){e.stopPropagation();var r=e.clientX,o=e.clientY,s=a.handleFixPosition(r,o),l=s.x,c=s.y;if(n===Nt.a.CROP){var d=a.state.cropDimension;d.end={x:l,y:c},a.setState(d,(function(){a.handleCropSelect()}))}a.painter.endDraw(l,c),a.GridController.drawGridBorder(),a.setState({mouseDown:!1})}else a.props.handleZoomEffect(e)}else a.handleSelect(e)},a.handleCropSelect=function(){var e=a.state,t=e.ctrlSelecting,n=e.selectedGrid,i=e.cropDimension,r=a.GridController.getGridPositionsFromCropMouse(i);if(t){for(var o=0;o<r.length;o++){for(var s=!1,l=0;l<n.length;l++)if(r[o].x===n[l].x&&r[o].x===n[l].x){s=!0;break}s||n.push(r[o])}a.setState(n)}else a.setState({selectedGrid:r})},a.handleSelect=function(e){e.stopPropagation();var t=e.clientX,n=e.clientY,i=a.handleFixPosition(t,n),r=i.x,o=i.y,s=a.GridController.getGridPositionFromMouseXY(r,o);if(s){var l=a.state,c=l.ctrlSelecting,d=l.selectedGrid,h=l.shiftSelecting;if(!1===c&&!1===h)return(d=[]).push(s),void a.setState({selectedGrid:d});for(var u=!1,p=0;p<d.length;p++)if(d[p].x===s.x&&d[p].y===s.y){u=!0;break}if(!u&&c)return d.push(s),void a.setState({selectedGrid:d});h&&(0===d.length?(d.push(s),a.setState({selectedGrid:d})):(d=a.GridController.getMinRegionGridPositionsFromGridsAndGrid(d,s),a.setState({selectedGrid:d})))}},a.handleFixPosition=function(e,t){var n=window.scrollX+e,i=window.scrollY+t;n-=a.refs.canvas.getBoundingClientRect().left,i-=a.refs.canvas.getBoundingClientRect().top;var r=a.props.scale;return{x:n/=r,y:i/=r}},a.handleClear=function(){var e=a.refs.canvas.toDataURL("image/jpeg",1);a.GridController.drawGrid();var t=a.refs.canvas.toDataURL("image/jpeg",1);a.addNewTransaction(e,t),a.sendSocketNewOperation()},a.getImageDataWithGrid=function(){return a.refs.canvas.toDataURL("image/jpeg",1)},a.handleHorizontalFlip=function(){var e=a.state.selectedGrid,t=a.getImageDataWithGrid(),n=function(){var e=a.getImageDataWithGrid();a.addNewTransaction(t,e),a.sendSocketNewOperation()};if(0!==e.length){var i=a.GridController.getCropPositionFromGridPositions(e);a.ImageController.handleSelectedHorizontalFlip(i,n)}else a.ImageController.handleHorizontalFlip(n)},a.handleVerticalFlip=function(){var e=a.state.selectedGrid,t=a.getImageDataWithGrid(),n=function(){var e=a.getImageDataWithGrid();a.addNewTransaction(t,e),a.sendSocketNewOperation()};if(0!==e.length){var i=a.GridController.getCropPositionFromGridPositions(e);a.ImageController.handleSelectedVerticalFlip(i,n)}else a.ImageController.handleVerticalFlip(n)},a.handleUnselectGrid=function(){a.setState({selectedGrid:[]})},a.handleGetImageNoGrid=function(){var e=a.props.tileset,t=e.width,n=e.height,i=a.GridController.getGridPositions(),r={width:t,height:n};return a.ImageController.getImageFromGrid(i,r)},a.handleDrawImageNoGrid=function(){var e=a.props.tileset,t=e.width,n=e.height,i=a.GridController.getGridPositions(),r={width:t,height:n};a.ImageController.drawImageFromGrid(i,r)},a.handleDrawImgToGrid=function(e,t){var n=a.GridController.getGridPositions();a.ImageController.drawToGrid(e,n,t)},a.handleStopCopying=function(){a.GridController.drawGridBorder(),a.setState({copying:!1})},a.handleCopy=function(){0!==a.state.selectedGrid.length?a.setState({copying:!0},(function(){a.startCopyGrid()})):a.setState({dialogOpen:!0})},a.startCopyGrid=function(){var e=a.state.selectedGrid,t=a.getImageDataWithGrid();a.CopyController=new xn(e,t);var n=a.CopyController.getStartGrids();a.GridController.drawCopiedGrid(n),a.setState({selectedGrid:[]})},a.getTileset=function(){return a.props.tileset},a.getTilesetId=function(){return a.props.tileset._id},a.getTilesetJson=function(){var e=a.props.tileset,t={firstgid:1,image:"./tileset@DELIT.jpeg"};return t.imageheight=e.height,t.imagewidth=e.width,t.margin=e.margin,t.name=e.name,t.properties={},t.spacing=e.spacing,t.tileheight=e.tileHeight,t.tilewidth=e.tileWidth,t.tilecount=e.tilecount,JSON.stringify(t).toLowerCase()},a.pasteCopiedGrid=function(){var e=a.state,t=e.copying,n=e.selectedGrid;if(0!==n.length&&t){var i=a.CopyController.getStartGrids(),r=a.GridController.getGridDiffFrom2Grids(i,n);a.GridController.drawGridsByGridsDiff(i,r);var o=a.GridController.getGridsFromGridsDiffandGrids(i,r),s=a.CopyController.getStartImageData(),l=a.getImageDataWithGrid();a.addNewTransaction(s,l),a.sendSocketNewOperation(),a.setState({selectedGrid:o,copying:!1})}else a.setState({dialogOpen:!0})},a.handleExport=function(){var e=a.props.tileset.name,t=a.handleGetImageNoGrid();n(103)(t,"".concat(e,".jpeg"),"image/jpeg")},a.userIsTeammember=function(){var e=a.props.username,t=a.props.tileset.teamInfo;for(var n in t)if(t[n].username===e)return!0;return!1},a.sendSocketNewOperation=function(){var e=a.refs.canvas.toDataURL("image/jpeg",1);a.props.socket.emit("draw",{data:e,type:"new",room:a.room})},a.addNewTransaction=function(e,t){a.props.transactions.addTransaction(new Tn(e,t,a.ImageController.drawImage))},a.doTransaction=function(){a.props.socket.emit("draw",{type:"redo",room:a.room}),a.props.transactions.doTransaction(),a.handleUnselectGrid()},a.undoTransaction=function(){a.props.socket.emit("draw",{type:"undo",room:a.room}),a.props.transactions.undoTransaction(),a.handleUnselectGrid()},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;if(this.userIsTeammember()&&(this.room="draw/".concat(this.props.tileset._id),this.props.socket.emit("join-room",this.room),this.props.socket.on("draw-back",(function(t){var n=e.refs.canvas.toDataURL("image/jpeg",1),a=e.props.transactions,i=t.data,r=t.type;"new"===r?e.addNewTransaction(n,i):"redo"===r?a.doTransaction():"undo"===r&&a.undoTransaction()}))),this.props.childRef(this),this.refs.canvas){var t=this.props.tileset,n=t.width,a=t.height,i=t.tileWidth,r=t.tileHeight;this.ctx=this.refs.canvas.getContext("2d"),this.GridController=new kn(this.ctx,n,a,i,r);var o=this.GridController.getCanvasDimension(),s=o.width,l=o.height,c=this.refs.painterBox.getBoundingClientRect(),d=c.width,h=c.height;this.ImageController=new A(this.ctx,s,l,i,r,n,a),this.setState({canvasWidth:s,canvasHeight:l,DisplayBoxWidth:d,DisplayBoxHeight:h},(function(){e.GridController.getPositionsForNoGridsImage(),e.GridController.drawGrid(),e.painter.setDimension(s,l);var t=e.props.tileset.imageId;""!==t&&b.a.get("/data/image?imageId=".concat(t)).then((function(t){var n=t.data,a=n.err,i=n.msg,r=n.data;if(a)console.log(i);else{if(!r)return;var o=W(r.data);e.handleDrawImgToGrid("data:image/jpeg;base64,"+o)}}))})),this.painter=new wn(this),window.onresize=function(){var t=e.refs.painterBox.getBoundingClientRect(),n=t.width,a=t.height;e.setState({DisplayBoxWidth:n,DisplayBoxHeight:a})},window.onkeydown=function(t){if(qt.a.triggerLeftControll(t))e.setState({ctrlSelecting:!0});else if(qt.a.triggerLeftShift(t))e.setState({shiftSelecting:!0});else if(qt.a.triggerLeftCtrlC(t)){if(0===e.state.selectedGrid.length)return;e.handleCopy()}else if(qt.a.triggerLeftCtrlV(t)){if(!1===e.state.copying)return;e.pasteCopiedGrid()}else qt.a.triggerLeftCtrlZ(t)?e.undoTransaction():qt.a.triggerLeftCtrlY(t)&&e.doTransaction()},window.onkeyup=function(t){qt.a.triggerLeftControll(t)?e.setState({ctrlSelecting:!1}):qt.a.triggerLeftShift(t)&&e.setState({shiftSelecting:!1})}}}},{key:"UNSAFE_componentWillMount",value:function(){this.props.socket.on("join-back",(function(e){console.log(e)}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.canvasWidth,a=t.canvasHeight,r=t.DisplayBoxWidth,o=t.DisplayBoxHeight,s=t.selectedGrid,l=t.copying,c=t.dialogOpen,d=t.shiftSelecting,h=this.props,u=h.scale,p=h.tileset,m=p.tileWidth,g=p.tileHeight;console.log(p);var f={left:n?n*u>=r?6:(r-n*u)/2+6:6,top:a?a*u>=o?6:(o-a*u)/2+6:6};return i.a.createElement("div",{className:"painter-display",ref:"painterBox",onClick:this.handleUnselectGrid},i.a.createElement(kt.Scrollbars,{ref:"scrollbar",style:{width:"100%",height:"100%",backgroundColor:"lightgray",paddingBottom:6},renderThumbHorizontal:function(e){return i.a.createElement("div",Object.assign({},e,{className:"thumb"}))},renderThumbVertical:function(e){return i.a.createElement("div",Object.assign({},e,{className:"thumb"}))}},i.a.createElement("div",{className:"display "+this.getSelectedTools(),id:"display",onMouseDown:this.handleToolStart,onMouseMove:this.handleToolMove,onMouseLeave:function(t){return e.handleToolEnd(t,"out")},onClick:function(t){return e.handleToolEnd(t,"click")},style:f},i.a.createElement("canvas",{ref:"canvas",width:n,height:a,className:"draw-canvas"},"Your Browser Does Not Support Canvas"),i.a.createElement(jn,{selectedGrid:s,width:m,height:g,parent:this,childRef:function(t){return e.selectedBoxes=t},copying:l,shiftSelecting:d}))),i.a.createElement(U,{header:"Attention",open:c,fullWidth:!0,maxWidth:"xs",actions:[i.a.createElement(Z.a,{key:"f",onClick:function(t){return e.setState({dialogOpen:!1})}},"OK")],content:i.a.createElement("p",null,"You Must Select A Grid To Copy or To Paste")}))}}]),t}(i.a.Component),Dn=Object(m.b)((function(e){return{selectedTool:e.toolbar.selected,socket:e.backend.socket}}),(function(e){return{}}))(In),Nn=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={name:""},n.handleOnChange=function(e){n.setState({name:e.target.value})},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.name,t=this.props,n=t.save,a=t.start,r=t.duplicate,o=t.parent,s=t.confirmSave,l=t.publish,c=t.saved,d=t.saveErrorMsg;return i.a.createElement(i.a.Fragment,null,void 0===n?null:i.a.createElement(U,{header:"Save Tileset",open:n,actions:[i.a.createElement(Z.a,{key:"1",onClick:o.handleSave},"Yes"),i.a.createElement(Z.a,{key:"2",onClick:o.handleSaveDialogClose},"Cancel")],content:[i.a.createElement("h3",{key:"q"},"Are You Sure to Save In Delit Database?"),i.a.createElement("h3",{key:"w"},"Old Version will be overwriten")]}),void 0===a?null:i.a.createElement(U,{header:"Attention!",open:a,actions:[i.a.createElement(Z.a,{key:"1",onClick:o.handleGoBack},"Leave(to dashboard)"),i.a.createElement(Z.a,{key:"2",onClick:o.handleDuplicateDialogOpen},"Make a Copy"),i.a.createElement(Z.a,{key:"3",onClick:o.handleStartDialogClose},"Continue")],content:[i.a.createElement("h4",{key:"q"},"You are not in team of this tileset"),i.a.createElement("h4",{key:"w"},"You operation will not be saved"),i.a.createElement("strong",{key:"e"},"But you can still own and change it by making a copy of this tileset")]}),void 0===r?null:i.a.createElement(U,{header:"Make a Copy of This Tileset",open:r,actions:[i.a.createElement(Z.a,{key:"1",onClick:o.handleDuplicate.bind(this,e)},"Yes"),i.a.createElement(Z.a,{key:"2",onClick:o.handleDuplicateDialogClose},"Cancel")],content:[i.a.createElement("h4",{key:"q"},"Are You Sure to duplicate this tileset?"),i.a.createElement("h4",{key:"w"},"You will be the owner of the new tileset"),i.a.createElement("h4",{key:"e"},"Current Change Will be saved to Your new tilest"),i.a.createElement(S.a,{key:"r",className:"duplicate-input",label:"Enter Name for your new tileset",variant:"outlined",size:"small",value:e,onChange:this.handleOnChange})]}),void 0===s?null:i.a.createElement(U,{header:"Saving Tileset",open:s,actions:[i.a.createElement(Z.a,{key:"1",onClick:o.handleGoBack,disabled:!c},"Leave(to dashboard)"),i.a.createElement(Z.a,{key:"2",onClick:o.handleConfirmSaveDialogClose},"Cancel")],content:[c?i.a.createElement("h3",{key:"q"},"Your Tileset is save successfully"):i.a.createElement("h3",{key:"q"},"Your Tileset is being saved"),""===d?null:i.a.createElement("h3",{key:"w"},"saveErrorMsg"),""===d?c?i.a.createElement("i",{key:"e",className:"fas fa-check-circle dialog-saved-icon"}):i.a.createElement(M.a,{key:"e",className:"wait-saving"}):i.a.createElement("i",{key:"e",class:"fas fa-times-circle dialog-saved-error"})]}),void 0===l?null:i.a.createElement(V.a,{mutation:ye.PUBLISH_TILESET,onCompleted:function(){o.handleRefreshAfterPublished()}},(function(e,t){return i.a.createElement(U,{header:"Saving Tileset",open:l,actions:[i.a.createElement(Z.a,{key:"1",onClick:function(){e({variables:{id:o.display.getTilesetId()}})}},"Confirm"),i.a.createElement(Z.a,{key:"2",onClick:o.handlePublishDialogClose},"Cancel")],content:[i.a.createElement("h3",{key:"1"},"Are You Sure to Publish This Tileset"),i.a.createElement("h3",{key:"2"},"By Publishing it, you will be able to use it in your map"),i.a.createElement("h3",{key:"3"},"But You wont be able to edit this one again")]})})))}}]),t}(i.a.Component),Ln=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={inputText:"",chatHistory:[],position:{x:100,y:100},size:{width:320,height:480}},n.handleSubmit=function(){""!==n.state.inputText&&(n.props.socket.emit("chat",{username:n.props.username,userPicture:n.props.userPicture,msg:n.state.inputText,room:n.props.room}),n.setState({inputText:""}))},n.handleChange=function(e){n.setState({inputText:e.target.value})},n.handleStopResize=function(e,t,a,i,r){n.setState({size:{width:parseInt(a.style.width),height:parseInt(a.style.height)},position:{x:parseInt(r.x),y:parseInt(r.y)}})},n.handleOnDragStop=function(e,t){n.setState({position:{x:t.x,y:t.y}})},n.handleResetWindow=function(){n.setState({position:{x:100,y:100},size:{width:320,height:480}})},n.handleMaxWindow=function(){var e=document.body.getBoundingClientRect(),t=e.width,a=e.height;n.setState({position:{x:0,y:0},size:{width:t,height:a}})},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"UNSAFE_componentWillMount",value:function(){var e=this;this.props.socket.on("chat-back",(function(t){var n=e.state.chatHistory.map((function(e){return Object(Se.a)({},e)}));n.push(t),e.setState({chatHistory:n})}))}},{key:"render",value:function(){var e=this.props.open,t=this.state,n=t.inputText,a=t.chatHistory,r=t.size,o=t.position,s=this.props.username;return i.a.createElement(i.a.Fragment,null,e?i.a.createElement(ht.a,{size:r,position:o,className:"chat-box ",onResizeStop:this.handleStopResize,onDragStop:this.handleOnDragStop},i.a.createElement(At,{title:"Property Window",handleClose:this.props.handleClose,handleResetWindow:this.handleResetWindow,handleMaxWindow:this.handleMaxWindow}),i.a.createElement("h3",{style:{textAlign:"center"}},"chat"),i.a.createElement("div",{className:"chat-history"},a.map((function(e,t){var n=e.username,a=e.userPicture,r=e.msg;return i.a.createElement("div",{key:t,className:"chat-history-item-box"},i.a.createElement("img",{src:a,alt:"",className:s===n?"chat-history-item-picture-right":"chat-history-item-picture"}),i.a.createElement("div",{className:s===n?"chat-history-item-username-right":"chat-history-item-username"},n),i.a.createElement("div",{className:s===n?"chat-history-item-msg-right":"chat-history-item-msg"},r))}))),i.a.createElement(S.a,{id:"outlined-basic",className:"chat-input",label:"Enter Message",variant:"outlined",size:"small",value:n,onMouseDown:function(e){return e.stopPropagation()},onChange:this.handleChange}),i.a.createElement(Z.a,{className:"chat-input-btn",size:"sm",onClick:this.handleSubmit},"\u27a4")):null)}}]),t}(i.a.Component),Pn=function(e){function t(){var e,a;Object(s.a)(this,t);for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return(a=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={sliderValue:1,borderColor:{r:0,g:0,b:0,a:1},fillColor:{r:255,g:255,b:255,a:1},scale:1,saveOpen:!1,duplicaOpen:!1,startAuthOpen:!1,confirmSaveOpen:!1,publishOpen:!1,saved:!1,username:null,userPicture:"",saveErrorMsg:"",showChatBox:!1},a.transactions=new pn,a.display=i.a.createRef(),a.handleChat=function(){var e=a.state.showChatBox;a.setState({showChatBox:!e})},a.handleChatClose=function(){a.setState({showChatBox:!1})},a.handleExportJson=function(){var e=a.display.getTilesetJson();n(103)(e,"tilesetJson@DELIT.json","json")},a.handleSaveDialogOpen=function(){a.display.userIsTeammember()?a.setState({saveOpen:!0}):a.setState({startAuthOpen:!0})},a.handleSaveDialogClose=function(){a.setState({saveOpen:!1})},a.handleConfirmSaveDialogOpen=function(){a.setState({saved:!1,confirmSaveOpen:!0,saveOpen:!1,saveErrorMsg:""})},a.handleConfirmSaveDialogClose=function(){a.setState({saved:!1,confirmSaveOpen:!1,saveErrorMsg:""})},a.handleStartDialogOpen=function(){a.setState({startAuthOpen:!0})},a.handleStartDialogClose=function(){a.setState({startAuthOpen:!1})},a.handlePublishDialogOpen=function(){a.setState({publishOpen:!0})},a.handlePublishDialogClose=function(){a.setState({publishOpen:!1})},a.handleDuplicateDialogOpen=function(){a.setState({duplicaOpen:!0})},a.handleDuplicateDialogClose=function(){a.setState({duplicaOpen:!1})},a.handleRefreshAfterPublished=function(){var e=a.props.match.params.key;a.props.socket.emit("leave-room","draw/".concat(e)),a.props.history.push("/tilesetviewer/".concat(e))},a.handleDuplicate=function(e){var t=a.display.handleGetImageNoGrid(),n=a.display.getTileset(),i=a.state.userId;a.props.socket.emit("duplicate-image",{name:e,data:t,tileset:n,userId:i}),a.handleDuplicateDialogClose()},a.handleZoomEffect=function(e){e.stopPropagation();var t=a.props.selectedTool;if(t===Nt.a.ZOOM_IN||t===Nt.a.ZOOM_OUT){var n=a.state.scale,i=t===Nt.a.ZOOM_IN?1.25:t===Nt.a.ZOOM_OUT?.8:1,r=n*i;a.setState({scale:r});var o=document.getElementById("display"),s=o.getBoundingClientRect(),l=e.clientX,c=e.clientY,d=l-s.left,h=c-s.top,u=h*i-h,p=d*i-d;o.style.transform="scale("+r+")";var m=a.display.refs.scrollbar.getScrollLeft(),g=a.display.refs.scrollbar.getScrollTop();r>=1&&(a.display.refs.scrollbar.scrollLeft(p+m),a.display.refs.scrollbar.scrollTop(u+g))}},a.sliderOnChange=function(e,t){a.setState({sliderValue:t})},a.borderColorOnChange=function(e){a.setState({borderColor:e.rgb})},a.fillColorOnChange=function(e){a.setState({fillColor:e.rgb})},a.doTransaction=function(){a.display.doTransaction()},a.undoTransaction=function(){a.display.undoTransaction()},a.handleUnselect=function(){a.props.handleUnselect()},a.handleClearNoneToolOperation=function(){a.display.handleUnselectGrid(),a.display.handleStopCopying()},a.handleHorizontalFlip=function(e){e.stopPropagation(),a.display.handleHorizontalFlip(),a.props.handleUnselect()},a.handleVerticalFlip=function(e){e.stopPropagation(),a.display.handleVerticalFlip(),a.props.handleUnselect()},a.handleClear=function(){a.display.handleClear()},a.handleImport=function(e){var t=a.display.getImageDataWithGrid();a.display.handleDrawImgToGrid(e.base64,(function(){var e=a.display.getImageDataWithGrid();a.display.addNewTransaction(t,e),a.display.sendSocketNewOperation()}))},a.handleExport=function(){a.display.handleExport()},a.handleSave=function(){var e=a.display.handleGetImageNoGrid();a.props.socket.emit("draw-save",{tilesetId:a.props.match.params.key,data:e}),a.handleConfirmSaveDialogOpen(),a.handleClearNoneToolOperation()},a.handleCopy=function(){a.display.handleCopy()},a.handlePaste=function(){a.display.pasteCopiedGrid()},a.handleGoBack=function(){var e=a.props.match.params.key;a.props.socket.emit("leave-room","draw/".concat(e)),a.props.history.push("/dashboard")},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.key;b.a.get("/auth/current").then((function(n){var a=n.data,i=a.username,r=a._id,o=a.picture;i&&r&&o?e.setState({username:i,userId:r,userPicture:o}):(e.props.socket.emit("leave-room","draw/".concat(t)),e.props.history.push("/"))}))}},{key:"UNSAFE_componentWillMount",value:function(){var e=this;this.props.socket.on("duplicate-image-back",(function(t){var n=e.props.match.params.key;e.props.socket.emit("leave-room","draw/".concat(n)),e.props.history.push("/tileseteditor/".concat(t))})),this.props.socket.on("draw-save-back",(function(t){var n=t.err,a=t.msg;n?e.setState({saveErrorMsg:a}):e.setState({saved:!0})}))}},{key:"render",value:function(){var e=this,t=this.props.match.params.key,n=this.props,a=n.history,r=n.socket,o=this.state,s=o.sliderValue,l=o.saved,c=o.borderColor,d=o.fillColor,h=o.scale,u=o.saveOpen,p=o.startAuthOpen,m=o.duplicaOpen,g=o.username,f=o.userPicture,y=o.confirmSaveOpen,b=o.saveErrorMsg,v=o.publishOpen,E=o.showChatBox;return i.a.createElement("div",{onClick:this.handleUnselect},i.a.createElement(_,{site:"tileset",history:a,handleSave:this.handleSaveDialogOpen,handleExportJson:this.handleExportJson,handleImport:this.handleImport,handleExport:this.handleExport,handleDuplicate:this.handleDuplicateDialogOpen,handleDoTransaction:this.doTransaction,handleUndoTransaction:this.undoTransaction,handleCopy:this.handleCopy,handlePaste:this.handlePaste}),i.a.createElement(Z.a,{className:"publish-btn",size:"sm",onClick:this.handlePublishDialogOpen},"Publish"),i.a.createElement(Z.a,{className:"chat-btn",size:"sm",onClick:this.handleChat},"Chat"),i.a.createElement(Ln,{open:E,socket:r,username:g,userPicture:f,room:"draw/".concat(t),handleClose:this.handleChatClose}),i.a.createElement("div",{className:"painter-wrapper"},i.a.createElement(cn,{selectCallback:this.handleClearNoneToolOperation,className:"map-toolbar",content:[{name:Nt.a.UNDO,item:i.a.createElement("i",{className:"fas fa-undo",style:{fontSize:"24px"},onClick:this.undoTransaction})},{name:Nt.a.REDO,item:i.a.createElement("i",{className:"fas fa-redo",style:{fontSize:"24px"},onClick:this.doTransaction})},{name:Nt.a.UPLOAD,item:i.a.createElement(P.a,{fileTypes:[".jpeg"],ref:"fileUploader",handleFiles:this.handleImport,base64:!0},i.a.createElement("i",{className:"fas fa-upload",style:{fontSize:"24px"}}))},{name:Nt.a.DOWNLOAD,item:i.a.createElement("i",{className:"fas fa-download",style:{fontSize:"24px"},onClick:this.handleExport})},{name:Nt.a.SAVE,item:i.a.createElement("i",{className:"fas fa-save",style:{fontSize:"24px"},onClick:this.handleSaveDialogOpen})},{name:Nt.a.EXPORT_JSON,item:i.a.createElement("i",{className:"fas fa-box",style:{fontSize:"24px"},onClick:this.handleExportJson})},{name:Nt.a.COPY,item:i.a.createElement("i",{className:"fas fa-copy",style:{fontSize:"24px"},onClick:this.handleCopy})},{name:Nt.a.PASTE,item:i.a.createElement("i",{className:"fas fa-paste",style:{fontSize:"24px"},onClick:this.handlePaste})}],secondaryContent:[{name:Nt.a.PENCIL,item:i.a.createElement("i",{className:"fas fa-pencil-alt",style:{fontSize:"24px"}})},{name:Nt.a.LINE,item:i.a.createElement("i",{className:"fas fa-slash",style:{fontSize:"24px"}})},{name:Nt.a.SQUARE,item:i.a.createElement("i",{className:"far fa-square",style:{fontSize:"24px"}})},{name:Nt.a.CIRCLE,item:i.a.createElement("i",{className:"far fa-circle",style:{fontSize:"24px"}})},{name:Nt.a.ERASER,item:i.a.createElement("i",{className:"fas fa-eraser",style:{fontSize:"24px"}})},{name:Nt.a.FILL,item:i.a.createElement("i",{className:"fas fa-fill",style:{fontSize:"24px"}})},{name:Nt.a.CROP,item:i.a.createElement("i",{className:"fas fa-crop-alt",style:{fontSize:"24px"}})}],rightContent:[{name:Nt.a.ZOOM_OUT,item:i.a.createElement("i",{className:"fas fa-search-minus",style:{fontSize:"24px"}})},{name:Nt.a.ZOOM_IN,item:i.a.createElement("i",{className:"fas fa-search-plus",style:{fontSize:"24px"}})}]}),i.a.createElement(Sn,{sliderValue:s,sliderOnChange:this.sliderOnChange,borderColor:c,borderColorOnChange:this.borderColorOnChange,fillColor:d,fillColorOnChange:this.fillColorOnChange,handleHorizontalFlip:this.handleHorizontalFlip,handleVerticalFlip:this.handleVerticalFlip,handleClear:this.handleClear}),i.a.createElement(V.b,{query:He.GET_TILESET,variables:{id:t},fetchPolicy:"network-only"},(function(t){var n=t.loading,a=t.error,r=t.data;if(n)return"loading";if(a)return"error";if(!r)return"error";var o=r.tileset;return i.a.createElement(Dn,{tileset:o,childRef:function(t){return e.display=t},borderThic:s,fillColor:d,borderColor:c,transactions:e.transactions,handleZoomEffect:e.handleZoomEffect,scale:h,username:g,handleStartDialogOpen:e.handleStartDialogOpen})}))),i.a.createElement(Nn,{parent:this,save:u,start:p,duplicate:m,confirmSave:y,publish:v,saved:l,saveErrorMsg:b}))}}]),t}(i.a.Component),Rn=Object(m.b)((function(e,t){return{selectedTool:e.toolbar.selected,socket:e.backend.socket}}),(function(e){return{handleUnselect:function(){return e((function(e,t){e({type:"TOOLBAR_UNSELECT"})}))}}}))(Pn),_n=function(e){function t(){var e,a;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(a=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={canvasWidth:0,canvasHeight:0,DisplayBoxWidth:0,DisplayBoxHeight:0},a.handleDrawImgToGrid=function(e,t){var n=a.GridController.getGridPositions();a.ImageController.drawToGrid(e,n,t)},a.handleGetImageNoGrid=function(){var e=a.props.tileset,t=e.width,n=e.height,i=a.GridController.getGridPositions(),r={width:t,height:n};return a.ImageController.getImageFromGrid(i,r)},a.getTileset=function(){return a.props.tileset},a.getSelectedTools=function(){var e=a.props.selectedTool;return e===Nt.a.ZOOM_IN?"display-zoom-in":e===Nt.a.ZOOM_OUT?"display-zoom-out":e===Nt.a.PENCIL?"display-pencil":e===Nt.a.ERASER?"display-eraser":e===Nt.a.FILL?"display-fill":e?"display-cross-cursor":""},a.handleExport=function(){var e=a.props.tileset.name,t=a.handleGetImageNoGrid();n(103)(t,"".concat(e,".jpeg"),"image/jpeg")},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;if(this.refs.canvas){var t=this.props.tileset,n=t.width,a=t.height,i=t.tileWidth,r=t.tileHeight;this.ctx=this.refs.canvas.getContext("2d"),this.GridController=new kn(this.ctx,n,a,i,r);var o=this.GridController.getCanvasDimension(),s=o.width,l=o.height,c=this.refs.painterBox.getBoundingClientRect(),d=c.width,h=c.height;this.ImageController=new A(this.ctx,s,l,i,r,n,a),this.props.childRef(this),this.setState({canvasWidth:s,canvasHeight:l,DisplayBoxWidth:d,DisplayBoxHeight:h},(function(){e.GridController.getPositionsForNoGridsImage(),e.GridController.drawGrid();var t=e.props.tileset.imageId;""!==t&&b.a.get("/data/image?imageId=".concat(t)).then((function(t){var n=t.data,a=n.err,i=n.msg,r=n.data;if(a)console.log(i);else{if(!r)return;var o=W(r.data);e.handleDrawImgToGrid("data:image/jpeg;base64,"+o)}}))})),window.onresize=function(){var t=e.refs.painterBox.getBoundingClientRect(),n=t.width,a=t.height;e.setState({DisplayBoxWidth:n,DisplayBoxHeight:a})}}}},{key:"render",value:function(){var e=this.state,t=e.canvasHeight,n=e.canvasWidth,a=e.DisplayBoxWidth,r=e.DisplayBoxHeight,o=this.props.scale,s={left:n?n*o>=a?6:(a-n*o)/2+6:6,top:t?t*o>=r?6:(r-t*o)/2+6:6};return i.a.createElement("div",{className:"viewer-display",ref:"painterBox"},i.a.createElement(kt.Scrollbars,{ref:"scrollbar",style:{width:"100%",height:"100%",backgroundColor:"lightgray",paddingBottom:6},renderThumbHorizontal:function(e){return i.a.createElement("div",Object.assign({},e,{className:"thumb"}))},renderThumbVertical:function(e){return i.a.createElement("div",Object.assign({},e,{className:"thumb"}))}},i.a.createElement("div",{className:"display "+this.getSelectedTools(),id:"display",onClick:this.props.handleZoomEffect,style:s},i.a.createElement("canvas",{ref:"canvas",width:n,height:t,className:"draw-canvas"},"Your Browser Does Not Support Canvas"))))}}]),t}(i.a.Component),Gn=Object(m.b)((function(e){return{selectedTool:e.toolbar.selected,socket:e.backend.socket}}),(function(e){return{}}))(_n),Mn=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={scale:1,open:!1,name:""},n.display=i.a.createRef(),n.handleDialogOpen=function(){n.setState({open:!0})},n.handleDialogClose=function(){n.setState({open:!1})},n.handleOnChange=function(e){n.setState({name:e.target.value})},n.handleDuplicate=function(){var e=n.display.handleGetImageNoGrid(),t=n.display.getTileset(),a=n.state,i=a.userId,r={name:a.name,data:e,tileset:t,userId:i};n.props.socket.emit("duplicate-image",r),n.handleDialogClose()},n.handleZoomEffect=function(e){e.stopPropagation();var t=n.props.selectedTool;if(t===Nt.a.ZOOM_IN||t===Nt.a.ZOOM_OUT){var a=n.state.scale,i=t===Nt.a.ZOOM_IN?1.25:t===Nt.a.ZOOM_OUT?.8:1,r=a*i;n.setState({scale:r});var o=document.getElementById("display"),s=o.getBoundingClientRect(),l=e.clientX,c=e.clientY,d=l-s.left,h=c-s.top,u=h*i-h,p=d*i-d;o.style.transform="scale("+r+")";var m=n.display.refs.scrollbar.getScrollLeft(),g=n.display.refs.scrollbar.getScrollTop();r>=1&&(n.display.refs.scrollbar.scrollLeft(p+m),n.display.refs.scrollbar.scrollTop(u+g))}},n.handleUnselect=function(){n.props.handleUnselect()},n.handleExport=function(){n.display.handleExport()},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"UNSAFE_componentWillMount",value:function(){var e=this;this.props.socket.on("duplicate-image-back",(function(t){e.props.history.push("/tileseteditor/".concat(t))}))}},{key:"componentDidMount",value:function(){var e=this;b.a.get("/auth/current").then((function(t){var n=t.data,a=n.username,i=n._id;a&&i?e.setState({username:a,userId:i}):e.props.history.push("/")}))}},{key:"render",value:function(){var e=this,t=this.props.match.params.key,n=this.props.history,a=this.state,r=a.scale,o=a.open,s=a.name;return i.a.createElement("div",{onClick:this.handleUnselect},i.a.createElement(_,{site:"test",history:n}),i.a.createElement("div",{className:"painter-wrapper"},i.a.createElement(cn,{className:"map-toolbar",content:[{name:Nt.a.DOWNLOAD,item:i.a.createElement("i",{className:"fas fa-download",style:{fontSize:"24px"},onClick:this.handleExport})},{name:Nt.a.SAVE,item:i.a.createElement("i",{className:"fas fa-save",style:{fontSize:"24px"},onClick:this.handleDialogOpen})}],rightContent:[{name:Nt.a.ZOOM_OUT,item:i.a.createElement("i",{className:"fas fa-search-minus",style:{fontSize:"24px"}})},{name:Nt.a.ZOOM_IN,item:i.a.createElement("i",{className:"fas fa-search-plus",style:{fontSize:"24px"}})}]}),i.a.createElement(V.b,{query:He.GET_TILESET,variables:{id:t},fetchPolicy:"network-only"},(function(t){var n=t.loading,a=t.error,o=t.data;if(n)return"loading";if(a)return"error";if(!o)return"error";var s=o.tileset;return i.a.createElement(Gn,{tileset:s,handleZoomEffect:e.handleZoomEffect,scale:r,childRef:function(t){return e.display=t}})}))),i.a.createElement(U,{header:"Saving Tileset",open:o,actions:[i.a.createElement(Z.a,{key:"1",onClick:this.handleDuplicate},"Confirm"),i.a.createElement(Z.a,{key:"2",onClick:this.handleDialogClose},"Cancel")],content:[i.a.createElement("h3",{key:"1"},"This is a published Tileset, You cannot change it"),i.a.createElement("h3",{key:"2"},"But you can own it By making a duplicate of it"),i.a.createElement("h3",{key:"3"},"After Duplication You will have to publish it to use it"),i.a.createElement(S.a,{key:"r",className:"duplicate-input",label:"Enter Name for your new tileset",variant:"outlined",size:"small",value:s,onChange:this.handleOnChange})]}))}}]),t}(i.a.Component),An=Object(m.b)((function(e,t){return{selectedTool:e.toolbar.selected,socket:e.backend.socket}}),(function(e){return{handleUnselect:function(){return e((function(e,t){e({type:"TOOLBAR_UNSELECT"})}))}}}))(Mn),Wn=(n(616),function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleAddProject=function(e){n.props.dataToAdd.forEach((function(t){e({variables:{name:t.name,owner:t.owner,editors:t.editors,imageId:t.imageId,mapId:t.mapId,tilesetId:t.tilesetId,tilesetFirstgid:t.tilesetFirstgid,layerId:t.layerId}})}))},n.handleClear=function(e){e()},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t={query:He.GET_PROJECTS};return i.a.createElement(V.b,{query:He.GET_PROJECTS},(function(n){if(n.loading)return"loading";if(n.error)return"error";var a=n.data.projects;return i.a.createElement(V.a,{mutation:ye.ADD_PROJECT,refetchQueries:[t]},(function(n,r){return i.a.createElement(V.a,{mutation:ye.CLEAR_PROJECTS,refetchQueries:[t]},(function(t,r){return i.a.createElement("div",{className:"test-manager-wrapper"},"projects",i.a.createElement("div",{className:"test-btn-box"},i.a.createElement(Z.a,{className:"test-btn",onClick:function(){return e.handleAddProject(n)}},"ADD"),i.a.createElement(Z.a,{className:"test-btn",onClick:function(){return e.handleClear(t)}},"CLEAR")),a.map((function(e){return i.a.createElement("div",{key:Object(D.a)(),className:"test-context"},JSON.stringify(e))})))}))}))}))}}]),t}(i.a.Component)),zn=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleAddProject=function(e){n.props.dataToAdd.forEach((function(t){e({variables:{id:t._id,name:t.name,owner:t.owner,editors:t.editors,imageId:t.imageId,tileWidth:t.tileWidth,tileHeight:t.tileHeight,width:t.width,height:t.height,columns:t.columns,margin:t.margin,spacing:t.spacing,tilecount:t.tilecount,published:t.published}})}))},n.handleClear=function(e){e()},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t={query:He.GET_ALL_TILESETS};return i.a.createElement(V.b,{query:He.GET_ALL_TILESETS},(function(n){if(n.loading)return"loading";if(n.error)return"error";var a=n.data.tilesets,r=0!==a.length;return i.a.createElement(V.a,{mutation:ye.ADD_TILESET,refetchQueries:[t]},(function(n,o){return i.a.createElement(V.a,{mutation:ye.CLEAR_TILESETS,refetchQueries:[t]},(function(t,o){return i.a.createElement("div",{className:"test-manager-wrapper"},"tilesets",i.a.createElement("div",{className:"test-btn-box"},i.a.createElement(Z.a,{className:"test-btn",disabled:r,onClick:function(){return e.handleAddProject(n)}},"Add"),i.a.createElement(Z.a,{className:"test-btn",onClick:function(){return e.handleClear(t)}},"CLEAR")),a.map((function(e){return i.a.createElement("div",{key:Object(D.a)(),className:"test-context"},JSON.stringify(e))})))}))}))}))}}]),t}(i.a.Component),$n=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleAddMap=function(e){n.props.dataToAdd.forEach((function(t){e({variables:{id:t._id,width:t.width,height:t.height,infinite:t.infinite,nextlayerid:t.nextlayerid,nextobjectid:t.nextobjectid,orientation:t.orientation,renderorder:t.renderorder,tiledversion:t.tiledversion,tileHeight:t.tileHeight,tileWidth:t.tileWidth,type:t.type,version:t.version}})}))},n.handleClear=function(e){e()},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t={query:He.GET_ALL_MAPS};return i.a.createElement(V.b,{query:He.GET_ALL_MAPS},(function(n){if(n.loading)return"loading";if(n.error)return"error";var a=n.data.maps,r=0!==a.length;return i.a.createElement(V.a,{mutation:ye.ADD_MAP,refetchQueries:[t]},(function(n,o){return i.a.createElement(V.a,{mutation:ye.CLEAR_MAPS,refetchQueries:[t]},(function(t,o){return i.a.createElement("div",{className:"test-manager-wrapper"},"maps",i.a.createElement("div",{className:"test-btn-box"},i.a.createElement(Z.a,{className:"test-btn",disabled:r,onClick:function(){return e.handleAddMap(n)}},"ADD"),i.a.createElement(Z.a,{className:"test-btn",onClick:function(){return e.handleClear(t)}},"CLEAR")),a.map((function(e){return i.a.createElement("div",{key:Object(D.a)(),className:"test-context"},JSON.stringify(e))})))}))}))}))}}]),t}(i.a.Component),Hn=n(118),Bn=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleAddMap=function(e){n.props.dataToAdd.forEach((function(t){e({variables:{_id:t._id,data:t.data,height:t.height,width:t.width,name:t.name,opacity:t.opacity,type:t.type,visible:t.visible,x:t.x,y:t.y}})}))},n.handleClear=function(e){e()},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t={query:He.GET_ALL_LAYERS};return i.a.createElement(V.b,{query:He.GET_ALL_LAYERS},(function(n){if(n.loading)return"loading";if(n.error)return"error";var a=n.data.layers,r=0!==a.length;return i.a.createElement(V.a,{mutation:ye.ADD_LAYER,refetchQueries:[t]},(function(n,o){return i.a.createElement(V.a,{mutation:ye.CLEAR_LAYERS,refetchQueries:[t]},(function(t,o){return i.a.createElement("div",{className:"test-manager-wrapper"},"layers",i.a.createElement("div",{className:"test-btn-box"},i.a.createElement(Z.a,{className:"test-btn",disabled:r,onClick:function(){return e.handleAddMap(n)}},"ADD"),i.a.createElement(Z.a,{className:"test-btn",onClick:function(){return e.handleClear(t)}},"CLEAR")),a.map((function(e){return i.a.createElement("div",{key:Object(D.a)(),className:"test-context"},JSON.stringify(e))})))}))}))}))}}]),t}(i.a.Component),Fn=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"UNSAFE_componentWillMount",value:function(){var e=Hn.projects,t=Hn.maps,n=Hn.tilesets,a=Hn.layers;this.projectToDisplay={projectsInJson:e,mapsInJson:t,tilesetsInJson:n,layersInJson:a},this.projectToReduer={projects:e,maps:t,tilesets:n,layers:a}}},{key:"render",value:function(){var e=this.props.history;return i.a.createElement(i.a.Fragment,null,i.a.createElement(_,{side:"test",history:e}),i.a.createElement("div",{className:"test-wrapper"},i.a.createElement("div",{className:"test-title"},"Controll of mongoDB"),i.a.createElement(Wn,{dataToAdd:this.projectToReduer.projects}),i.a.createElement(zn,{dataToAdd:this.projectToReduer.tilesets}),i.a.createElement($n,{dataToAdd:this.projectToReduer.maps}),i.a.createElement(Bn,{dataToAdd:this.projectToReduer.layers})))}}]),t}(i.a.Component),Yn=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"UNSAFE_componentWillMount",value:function(){this.props.createSocket()}},{key:"render",value:function(){return i.a.createElement(u.a,null,i.a.createElement("div",{className:"App"},i.a.createElement(p.c,null,i.a.createElement(p.a,{exact:!0,path:"/",component:C}),i.a.createElement(p.a,{path:"/register",component:T}),i.a.createElement(p.a,{path:"/dashboard",component:ct}),i.a.createElement(p.a,{path:"/project/:key",component:bn}),i.a.createElement(p.a,{path:"/tileseteditor/:key",component:Rn}),i.a.createElement(p.a,{path:"/tilesetviewer/:key",component:An}),i.a.createElement(p.a,{path:"/test",component:Fn}),i.a.createElement(p.a,{path:"/:any",component:C}))))}}]),t}(a.Component),Un=Object(m.b)(null,(function(e){return{createSocket:function(){return e((function(e,t){e({type:"CREATE_SOCKET"})}))}}}))(Yn),Zn=n(285),Vn={user:null,errmsg:null},Xn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vn,t=arguments.length>1?arguments[1]:void 0;return"LOGIN_ERROR"===t.type?{user:null,errmsg:t.errmsg}:"LOGIN_SUCCESS"===t.type?{user:t.user,errmsg:null}:e},Jn=n(286),qn=n.n(Jn),Kn={},Qn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kn,t=arguments.length>1?arguments[1]:void 0;if("CREATE_SOCKET"===t.type){var n=qn()(f);return n.on("connect",(function(){})),{socket:n}}return e},ea={imgs:{},loaded:!1,selectedGrids:[],selectedItem:null},ta=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ea,t=arguments.length>1?arguments[1]:void 0;if("FORMAT_PROJECT"===t.type){for(var n=t.project,a=n.tilesetsInfo,i=n.tilesetFirstgid,r=0;r<a.length;r++)a[r].firstgid=i[r];return Object(Se.a)({},e,{tilesets:a})}if("TILESET_UNSELECT"===t.type)return Object(Se.a)({},e,{selected:null});if("TILESET_LOADED"===t.type)return Object(Se.a)({},e,{loaded:!0});if("TILESET_ID_APPLIER"===t.type){for(var o=t.id,s=t.index,l=[],c=0;c<e.tilesets.length;c++)c===s?l.push(Object(Se.a)({},e.tilesets[c],{canvasId:o})):l.push(e.tilesets[c]);return Object(Se.a)({},e,{tilesets:l})}if("SELECT_TILESET_GRIDS"===t.type)return Object(Se.a)({},e,{selectedGrids:t.selectedGrids});if("TILESET_SELECT"===t.type)return Object(Se.a)({},e,{selected:t.value});if("TILESET_IMG_INI"===t.type){var d=e.imgs;return d[t.name]=t.value,Object(Se.a)({},e,{imgs:d})}if("TILESETS_UPDATE"===t.type){for(var h=[],u=0;u<t.tilesets.length;u++)h.push(t.tilesets[u]);return Object(Se.a)({},e,{tilesets:h})}if("PASS_SELECTED_TILESET"===t.type)return Object(Se.a)({},e,{selectedItem:t.selectedItem});if("TILESET_DELETE"===t.type){var p=e.tilesets.filter((function(e){return e._id!==t.id}));return Object(Se.a)({},e,{selectedItem:null,tilesets:p})}if("TILESET_RESTORE"===t.type){var m=t.tilesets.map((function(e){return e}));return m?Object(Se.a)({},e,{tilesets:m}):Object(Se.a)({},e)}return e},na=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:aa,t=arguments.length>1?arguments[1]:void 0;if("FORMAT_PROJECT"===t.type){var n=t.project,a=n.mapInfo,i=n.tilesetsInfo,r=n.layersInfo,o=n.customPropertyName,s=n.customPropertyValue,l=ia(a),c=ra(i),d=oa(r),h=sa(o,s);return Object(Se.a)({},e,{map:l,tilesets:c,layers:d,custom:h,display:l})}if("ADD_LAYER"===t.type){var u=[];for(var p in e.layers)u.push(Object(Se.a)({},e.layers[p]));return u.push({name:t.layer.name,visible:t.layer.visible+"",opacity:t.layer.opacity}),Object(Se.a)({},e,{layers:u})}if("LAYER_RENAME"===t.type){for(var m=[],g=0;g<e.layers.length;g++)g===t.id?m.push(Object(Se.a)({},e.layers[g],{name:t.name})):m.push(Object(Se.a)({},e.layers[g]));return Object(Se.a)({},e,{layers:m,display:m[t.id]})}if("LAYER_VISIBILITY_TOGGLE"===t.type){for(var f=[],y=0;y<e.layers.length;y++)f.push(Object(Se.a)({},e.layers[y],{visible:y===t.id?!e.layers[y].visible:e.layers[y].visible}));return Object(Se.a)({},e,{layers:f,display:f[t.id]})}if("LAYER_RESTORE"===t.type){var b=t.layerList.map((function(e){return e}));return b?Object(Se.a)({},e,{layers:b}):Object(Se.a)({},e)}if("LAYER_SELECT"===t.type)return Object(Se.a)({},e,{selectedLayer:t.id});if("LAYER_DELETE"===t.type){for(var v=e.layers.map((function(e){return e})),E=0;E<v.length;E++)if(E===t.id){v.splice(E,1);break}return Object(Se.a)({},e,{layers:v,selected:null})}if("SELECT_PROPERTY_WINDOW"===t.type){var O=e.map;return"layers"!==t.window&&"map  "!==t.window||(O=e[t.window][t.index]),Object(Se.a)({},e,{display:O})}if("SELECT_PROPERTY_TILE"===t.type){var C=Object(Se.a)({},e[t.window][t.index]);return C.id=t.id,Object(Se.a)({},e,{display:C})}if("PROPERTY_SELECT"===t.type)return Object(Se.a)({},e,{selected:{window:t.window,index:t.index}});if("PROPERTY_UNSELECT"===t.type)return Object(Se.a)({},e,{selected:null});if("PROPERTY_CHANGE"===t.type){for(var S=[],w=0;w<e.custom.length;w++)S.push(Object(Se.a)({},e.custom[w],Object(k.a)({},t.name,w===t.index?t.value:e.custom[w][t.name])));return Object(Se.a)({},e,{custom:S})}if("PROPERTY_DELETE"===t.type){var T;if(!e.selected)return Object(Se.a)({},e);var x=e.selected,j=x.window,I=x.index,D=e[j];return D.splice(I,1),Object(Se.a)({},e,(T={},Object(k.a)(T,j,D),Object(k.a)(T,"selected",null),T))}if("ADD_PROPERTY"===t.type){var N=[];for(var L in e.custom)N.push(Object(Se.a)({},e.custom[L]));return N.push({name:"Click To Enter",type:"String",value:"Click To Enter"}),Object(Se.a)({},e,{custom:N})}if("RESTORE_CUSTOM_PROPERTY"===t.type){var P=[];for(var R in t.custom)P.push(Object(Se.a)({},t.custom[R]));return Object(Se.a)({},e,{custom:P})}return e},aa={map:[],layer:[],tilesets:[],custom:[]},ia=function(e){return{width:e.width,height:e.height,tileWidth:e.tileWidth,tileHeight:e.tileHeight}},ra=function(e){for(var t=[],n=0;n<e.length;n++){var a=e[n],i=a.width,r=a.height,o=a.tileWidth,s=a.tileHeight;t.push({width:i,height:r,tileWidth:o,tileHeight:s})}return t},oa=function(e){for(var t=[],n=0;n<e.length;n++){var a=e[n],i=a.opacity,r=a.visible,o=a.name;t.push({opacity:i,visible:r+"",name:o})}return t},sa=function(e,t){for(var n=[],a=0;a<e.length;a++)n.push({name:e[a],type:"String",value:t[a]});return n},la=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ca,t=arguments.length>1?arguments[1]:void 0;if("FORMAT_PROJECT"===t.type){var n=t.project.mapInfo;return Object(Se.a)({},e,{map:n})}if("SELECT_TOOL"===t.type)return Object(Se.a)({},e,{selectedTool:t.tool});if("ADD_LAYER"===t.type){var a=Object(Se.a)({},e.map,{nextlayerid:e.map.nextlayerid+1});return Object(Se.a)({},e,{map:a})}return e},ca={},da=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ha,t=arguments.length>1?arguments[1]:void 0;if("FORMAT_PROJECT"===t.type){var n=t.project.layersInfo.map((function(e){return e.locked=!1,e})),a=Object(Se.a)({},t.project.mapInfo);return Object(Se.a)({},e,{layerList:n,layerFormat:a})}if("LAYER_SELECT"===t.type)return Object(Se.a)({},e,{selected:t.id});if("LAYER_UNSELECT"===t.type)return Object(Se.a)({},e,{selected:null});if("LAYER_RENAME"===t.type){for(var i=e.layerList,r=0;r<i.length;r++)if(r===t.id){i[r].name=t.name;break}return Object(Se.a)({},e,{layerList:i})}if("LAYER_DELETE"===t.type){for(var o=e.layerList.map((function(e){return e})),s=0;s<o.length;s++)if(s===t.id){o.splice(s,1);break}return Object(Se.a)({},e,{layerList:o,selected:null})}if("LAYER_MOVE_UP"===t.type){for(var l=e.layerList.map((function(e){return e})),c=0;c<l.length;c++)if(l[c]._id===t.id){if(0===c)break;var d=l[c];l[c]=l[c-1],l[c-1]=d;break}return Object(Se.a)({},e,{layerList:l})}if("LAYER_MOVE_DOWN"===t.type){for(var h=e.layerList.map((function(e){return e})),u=0;u<h.length-1;u++)if(h[u]._id===t.id){var p=h[u];h[u]=h[u+1],h[u+1]=p;break}return Object(Se.a)({},e,{layerList:h})}if("LAYER_VISIBILITY_TOGGLE"===t.type){for(var m=[],g=0;g<e.layerList.length;g++)m.push(Object(Se.a)({},e.layerList[g],{visible:g===t.id?!e.layerList[g].visible:e.layerList[g].visible}));return Object(Se.a)({},e,{layerList:m})}if("LAYER_LOCK_TOGGLE"===t.type){var f=[];for(var y in e.layerList)f.push(Object(Se.a)({},e.layerList[y],{locked:e.layerList[y]._id===t.id?!e.layerList[y].locked:e.layerList[y].locked}));return Object(Se.a)({},e,{layerList:f})}if("LAYER_PASS_OPACITY"===t.type){var b=[];for(var v in e.layerList)b.push(Object(Se.a)({},e.layerList[v],{opacity:e.layerList[v]._id===e.selected?t.value/100:e.layerList[v].opacity}));return Object(Se.a)({},e,{layerList:b})}if("ADD_LAYER"===t.type){var E=[];for(var O in e.layerList)E.push(Object(Se.a)({},e.layerList[O]));return E.push(Object(Se.a)({},t.layer)),Object(Se.a)({},e,{layerList:E})}if("MAP_STAMP_CLICK"===t.type){if(!t.data)return Object(Se.a)({},e);var C=[];for(var S in e.layerList)C.push(Object(Se.a)({},e.layerList[S],{data:e.layerList[S]._id===e.selected?ua(e.layerList[S].data,t.data):e.layerList[S].data}));return Object(Se.a)({},e,{layerList:C})}if("MAP_FILL_CLICK"===t.type){if(!t.data)return Object(Se.a)({},e);var w=[];for(var T in e.layerList)w.push(Object(Se.a)({},e.layerList[T],{data:e.layerList[T]._id===e.selected?t.data:e.layerList[T].locked}));return Object(Se.a)({},e,{layerList:w})}if("LAYER_RESTORE"===t.type){var k=t.layerList.map((function(e){return e}));return k?Object(Se.a)({},e,{layerList:k}):Object(Se.a)({},e)}return e},ha={layerList:[],selected:null},ua=function(e,t){var n=[];for(var a in e)0!==t[a]?n.push(t[a]):n.push(e[a]);return n},pa={selected:null},ma=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pa,t=arguments.length>1?arguments[1]:void 0;return"TOOLBAR_SELECT"===t.type?Object(Se.a)({},e,{selected:t.name}):"TOOLBAR_UNSELECT"===t.type?Object(Se.a)({},e,{selected:null}):e},ga={loaded:!1},fa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ga,t=arguments.length>1?arguments[1]:void 0;if("FORMAT_PROJECT"===t.type){var n=t.project;return Object(Se.a)({},e,{},n,{loaded:!0})}return e},ya=Object(un.c)({auth:Xn,backend:Qn,tileset:ta,property:na,map:la,layer:da,toolbar:ma,project:fa}),ba=n(287),va=n(31),Ea=Object(un.e)(ya,Object(un.a)(Zn.a)),Oa=new ba.a({uri:"".concat(f,"/graphql")});o.a.render(i.a.createElement(m.a,{store:Ea},i.a.createElement(va.a,{client:Oa},i.a.createElement(Un,null))),document.getElementById("root"))}},[[301,1,2]]]);
//# sourceMappingURL=main.f21a8c53.chunk.js.map